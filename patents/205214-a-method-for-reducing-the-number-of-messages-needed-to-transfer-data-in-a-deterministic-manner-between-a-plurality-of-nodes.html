<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from www.allindianpatents.com/patents/205214-a-method-for-reducing-the-number-of-messages-needed-to-transfer-data-in-a-deterministic-manner-between-a-plurality-of-nodes by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Apr 2024 08:02:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Patents. 205214:A METHOD FOR REDUCING THE NUMBER OF MESSAGES NEEDED TO TRANSFER DATA IN A DETERMINISTIC MANNER BETWEEN A PLURALITY OF NODES</title>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="cYcP52B8zyTWKbLwby2YPh9z/gvY/RLjWOwY4YXkiXg=" name="csrf-token" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js" type="text/javascript"></script>
    <![endif]-->

    <link href="../assets/application-e80cf34975c5b1730c80b2f7170e7d26.css" media="all" rel="stylesheet" type="text/css" />

  </head>
  <body>

    <div class="navbar navbar-fluid-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">Indian Patents</a>
          <div class="container-fluid nav-collapse">
            <ul class="nav">
              <li><a href="../recently-granted.html">Recently Granted Patents</a></li>
              <li><a href="../recently-published.html">Recently Published Patents</a></li>
            </ul>
            <form id="gform" class="navbar-search pull-right" action="https://www.google.com/search" method="get" target="_blank" onsubmit="document.getElementById('gform').q.value='site:http://www.allindianpatents.com '+document.getElementById('gform').q.value">
                <input type="text" name="q" id="q" class="search-query" placeholder="Search" onclick="this.value=''" autocomplete="off">
            </form>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span12">

          <style>
          .allindianpatents-top { width: 320px; height: 50px; }
          @media(min-width: 500px) { .allindianpatents-top { width: 468px; height: 60px; } }
          @media(min-width: 800px) { .allindianpatents-top { width: 728px; height: 90px; } }
          </style>
          <center>
          </center>
          
          <div class="row-fluid">
	<div class="span8">

		<table class="table">
			<tr>
				<th>Title of Invention</th>
				<td><h1 style="font-size:large;">A METHOD FOR REDUCING THE NUMBER OF MESSAGES NEEDED TO TRANSFER DATA IN A DETERMINISTIC MANNER BETWEEN A PLURALITY OF NODES</h1></td>
			</tr>
			<tr>
				<th>Abstract</th>
				<td>An apparatus and method for deterministically communicating data between multiple nodes (500) in a fashion that is consistent with the Controller Area Network (&quot;CAN&quot;) communications protocol. The system applies to multiple nodes that functional blocks within an operating system environment and to multiple nodes that are each connected to a serial bus (501). The system utilizes standard CAN error checking, bus arbitration and message formatting and therefore uses standard CAN controllers and transceivers. One node on the bus is selected as the master node. The master node issues a periodic synchronization signal (401,411) which defines time divisions (TDn) within which the operations of each node and communications over the CAN bus are organized. Data, particularly real-time data, is transmitted between nodes on the CAN bus during a known time division. Standard CAN bus arbitration is used to ensure that real-time data is transmitted over the CAN bus prior to the transmission of non-real-time data. This ensures that real-time data is,if appropriate, transmitted during each time division.</td>
			</tr>
		</table>

					<style>
					.allindianpatents-post-abstract { width: 320px; height: 50px; }
					@media(min-width: 880px) { .allindianpatents-post-abstract { width: 468px; height: 60px; } }
					@media(min-width: 1267px) { .allindianpatents-post-abstract { width: 728px; height: 90px; } }
					</style>
					<center>
					<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- AllIndianPatents-post-abstract -->
					<ins class="adsbygoogle allindianpatents-post-abstract"
					     style="display:inline-block"
					     data-ad-client="ca-pub-7914358224572760"
					     data-ad-slot="9152759240"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>					
					</center>

		<table class="table">
			<tr>
				<th>Full Text</th>
				<td> <br><br>
DETERMINISTIC SERIAL BUS COMMUNICATION SYSTEM<br>
FIELD OF THE INVENTION<br>
The present invention generally relates to the field of serial bus communication systems. Specifically, the present invention relates to the field of serial bus communication systems using the Controller Area Network ("CAN") protocol and in particular to a method for adapting the CAN protocol to provide deterministic communication of real time data between nodes on a communication bus and between functional blocks within a node.<br>
STATEMENT OF THE PROBLEM<br>
Data bus communication systems are used in countless applications. The control and manipulation of industrial processes, commonly referred to as the process control industry, is exemplary of applications where the transmission of data between multiple nodes is required. The process control industry requires the communication of data between multiple sensors, e.g. flowmeters, and multiple control elements, e.g. valves. Sensors and controls elements are referred to herein collectively as instruments or instrumentation. Continuous processes are typically monitored and controlled by measuring certain characteristics of a material being processed, inferring a state or condition of the process from the measured characteristics, and generating control signals which operate to control devices such as pumps, conveyer belts and valves to keep the process within a specified range of operation. The quality of a finished product, as well as the safety of the process plant, is determined by the extent to which a process is properly controlled.<br>
Some instrumentation in a process control plant produces data which is transmitted to a centra! control system. The control system processes the data from the various instruments and transmits control signals to control elements. A control element might be a valve, for example, which is opened and closed in response to a control signal produced by the control system. All of the instrumentation and control systems in a given process plant are interconnected over some type of communications bus to allow the necessary processing of the measurement data and transmission of the control signals.<br>
There are different types of data communicated over data busses. "Non-real-time" data is data that is not rendered less valuable if the data is not received<br><br>
as of a certain deadline. An example of non-real-time data is a request from a central control system to a pressure transmitter requesting the serial number of the pressure transmitter. Proper control of the system is not dependant on knowing with certainty the time at which the request was generated. "Real-time" data has a specific deadline by which the data must be received or the data is lost or rendered useless. An example of real-time data is a mass flow rate signal transmitted from a mass flow instrument to a control system. The control system might, for example, use the mass flow rate signal to generate a control signal to a valve to maintain the mass flow rate through the system to within .5% of a target value. In this case it is important that a continuous and predictable stream of mass flow data be delivered to the control system and from the control system to the control valve.<br>
Since the current status of a process, as measured by its respective instrumentation, is processed and fed bacl
It is sometimes the case that a single piece of instrumentation generates multiple data signals for purposes of local control or transmission to a control system. For example, a Coriolis mass flowmeter might be used to measure the amount of fluid flowing into a tank. After a predetermined mass of the fluid has flowed into the tank, a valve is to turn off thereby stopping the flow of fluid into the tank. The data necessary to determine when the predetermined mass has been<br><br>
reached includes the mass flow rate of the fluid and the total mass of the fluid flowed into the tank. Both of these values are provided by a Coriolis mass flowmeter. Rather than communicating a mass flow rate value and a total mass value from the Coriolis mass flowmeter to a control system for development of the valve control signal, it is desirable to process the mass flow rate and total mass data and produce the valve control signal locally in the Coriolis mass flowmeter. In addition to the mass data, there are various non-real-time data signals processed within a Coriolis flowmeter. These signals include, but are not limited to, changes to the configuration data and tag information. These non-real-time signals are of a lower priority than the real-time signals because a delay in processing them does not degrade the accuracy or performance of the flowmeter or the tank batching control. A data bus is sometimes necessary to coordinate the transmission of the various real-time and non-real-time data signals within a single instrument.<br>
Whether one considers an enterprise-wide communication bus across a process plant or an intra-instrument bus within a single instrument computer, there are two primary types of communication protocols from which to choose. In Carrier-Sense Multiple Access ("CSMA") protocols, each node on the bus senses traffic and waits for traffic to clear before sending a message. When two nodes try to send messages at the same time, both nodes step back and try to transmit again at a later time. Another category of communication protocols is known by the heading Time Division Multiple Access ("TDMA"). In TDMA-type protocols, each node on the bus is allotted a slot of time in which to transmit and receive messages. TDMA protocols typically are, among other things, deterministic. A deterministic communications protocol is one which provides ensured schedulability of the actions in a real-time system.<br>
The Controller Area Network ("CAN") protocol is one protocol in the group of protocols known generally under the heading of CSMA. The CAN protocol has been adopted by the automotive industry as one of the standards for internal, operational data communications for automobiles. Typically, multiple sensors are located throughout the vehicle at various locations. A two-wire serial bus is used to provide the communications between the multiple sensors and the microprocessor(s).   For example, there may be sensors necessary for engine<br><br>
 near each wheel. Output from these sensors is communicated over the two-wire bus to microprocessor(s) for use in determining the proper control of the vehicle. CAN provides, among other features, a means for arbitrating between the various sensors to avoid conflicts between their respective signals. The arbitration includes a way to prioritize the signals so that more important signals are processed before less important signals. This allows the microprocessor to process a "brakes applied" signal before an "air-conditioning on" signal when both signals are initiated at the same time. CAN also provides a defined message format and an error checking scheme for confirming the soundness of the communicated messages. CAN does not. however, provide a means to ensure that messages of a certain type or class, such as real-time messages, are communicated on a regular, deterministic basis.<br>
Due to the adoption of the CAN protocol by the automotive industry, microprocessors and peripherals specifically designed for implementing CAN-based systems are readily available. Their wide use and relative low cost makes these CAN processors an attractive choice for designers of communication buses.<br>
There exists a need for a communication bus which provides the advantages of CSMA communication protocols such as arbitration, error checking and defined message formats as well as the determinism provided by TDMA-like communication protocols, in particular, there exists a need for a deterministic CAN-based protocol which allows the designer to utilize the relatively inexpensive advantages of the CAN protocol and readily available hardware in a deterministic communications environment.<br>
STATEMENT OF THE SOLUTION<br>
The above identified problems, and others, are solved and a technical advance is achieved, in the field by the deterministic serial bus communication system of the present invention. The present invention provides a method and apparatus by which standard CAN processors and related hardware are used in a real-time, deterministic processing system. The advantages of the CAN protocol including inexpensive processors, message collision resolution, error handling and<br><br>
message definition are combined with a time synchronization approach which provides ensured schedulability of the actions in a real-time system.<br>
Generally, the present invention utilizes a synchronization signal transmitted over a serial bus to multiple nodes. The synchronization signal defines the start of a time division for each of the nodes that are connected to the bus system. In one embodiment of the present invention, each node represents one or more sensors attached to a bus. For example, each piece of instrumentation in a chemical processing plant might be a node on the serial bus. In another embodiment of the present invention, each node represents one or more processing modules. For example, a Coriolis flowmeter transmitter contains a mass flow processing module at one node and a density processing module at a second node. Both nodes are connected to the bus. In a third embodiment of the present invention, a node may contain multiple function blocks. For example, a Coriolis flowmeter transmitter contains a node which produces a batch control signal. The batch node contains one function block that determines the totalized mass flow and a second function block that produces the batch control signal in response to the totalized mass flow amount. The intra-nodal communication of data between the function blocks within a node are conducted so as to be easily coordinated with the CAN protocol of the present invention. The CAN protocol of the present invention represents a hybrid of the standard CAN protocol with the determinism of TDMA-based protocols. The communications protocol of the present invention is referred to herein as CAN with Determinism ("CAN-D").<br>
In an embodiment of the present invention, each time division is comprised of three periods. During a first segment or period of the time division, a synchronization signal ("sync signal") notifies all the nodes on the bus of the start of a new time division. Also during this period, each of the nodes on the bus generating real-time data queues up the appropriate data for transmission. During a second segment or period of the time division, each of the nodes generating realtime data transmits that data to the bus. During a third segment or period of the time division, any node can request and transmit non-real-time data over the bus. The result is that the real-time data is schedulably transmitted to the bus during every time division.  This ensured schedulability, or determinism, of the present<br><br>
because of the start of a new time division is transmitted in subsequent time divisions until it is successfully transmits in its entirety over the bus.<br>
The present invention allows an instrumentation or plant designer to use the proven and inexpensive CAN protocol and CAN processors and to do so for the processing of real-time data using a deterministic serial communications bus. The present invention also allows the modular design of instrumentation using standard CAN processors. The various processing modules of an instrument according to the present invention utilize the CAN-D protocol to communicate among one another. The present invention is also used to control intra-node communications between functional blocks within a node.<br>
Accordingly the present invention provides a method for reducing the number of messages needed to transfer data in a deterministic manner between a plurality of nodes communicatively connected by a bus using the Controller Area Network ("CAN") serial communications protocol, characterized in that said method comprising the steps of: (i) broadcasting a synchronization message having a high priority over said bus to said plurality of nodes wherein said synchronization message includes a synchronization signal that indicates a common time division (TDn) for transmitting messages that includes sufficient time for transmitting a plurality of high priority messages and at least one low priority message; (ii)<br>
performing arbitration between said plurality of nodes to transmit a one of said plurality of high priority messages from one of said plurality of    nodes; (iii)<br>
transmitting said one of said plurality of high priority messages from said one of said plurality of nodes responsive to one of said plurality of nodes winning said<br><br>
arbitration; (iv) repeating steps 2 and 3 responsive to at least one of said high priority messages remains to be transmitted; (v) determining whether said common time division has time remaining; (vi) performing arbitration between said plurality of nodes for said at least one low priority messages responsive to said common time division having time remaining; (vii) transmitting a low priority message from a one of said plurality of nodes winning said arbitration; (viii) determining whether low priority messages remain to be transmitted; and (ix) repeating steps v-viii responsive to low priority messages remaining.<br>
Accordingly the present invention also provides an apparatus for reducing the number of messages needed to provide deterministic communication between multiple nodes connected by a communication bus using the Controller Area Network ("CAN")   serial   communications  protocol,   characterized   in  that  said  apparatus<br>
comprises;<br>
one of said plurality of nodes that is a master node having a CAN controller that generates a synchronization message of high priority and transmits said synchronization message over said bus to start a common time division (TDn);<br>
means in each remaining node for receiving said synchronization message ;<br>
means in said each remaining node for arbitrating for control of a bus and transmitting high priority messages in response to a reception of said synchronization message; and<br>
means in each said remaining node for arbitrating to transmit low priority messages responsive to a completion of transmission of said high priority messages. BRIEF DESCRIPTION OF THE DRAWINGS<br><br>
\.    1<br>
FIG. 1 is a block diagram of a communications bus implementing the CAN protocol;<br>
FIG. 2 is a timeline illustrating bus message activity in a communications system<br>
according to the present invention;<br>
FIG. 3 is a family of timelines illustrating bus message activity as well as node<br>
message generation activity according to the present invention;<br>
FIG. 4 is a timeline illustrating a further embodiment of the communications system<br>
of the present invention;<br>
FIG. 5 depicts a single node in greater detail;<br>
FIG. 6 is a flowchart illustrating the processing steps related to communication of<br>
messages relative to a sync signal.<br>
DETAILED DESCRIPTION<br>
Controller Area Network (CAN) Protocol and Network -FIG. 1<br>
FIG. 1 illustrates a network 100 including nodes 101-103. Each of nodes 101-103 is<br>
connected to two-wire bus 104. FIG. 1 shows only a section of bus 104 which extends<br>
in both, directions.<br>
Network 100 is typical of the networks of nodes in which the CAN protocol is<br>
utilized. An exemplary application is in the automotive industry where node 101 is an<br>
engine management control device, node 102 is a anti-lock brake sensor and node 103<br>
is an anti-lock brake control device. Each node contains a CAN controller which is<br>
either embedded in a microprocessor or is a stand-alone controller. An<br><br>
 transmission ot sync pulse 201 over bus 104. Time division TD, ends and time division TDn+i begins with the transmission of sync pulse 202 over bus 104. Time division TDn+1 ends and time division TD^^2 begins with the transmission of sync pulse 203 over bus 104. The sync pulses occur periodically to produce equal time divisions. Any node on the network can be configured to nenerate the sync pulses. One node is simply designated as the "master node" by assigning the master node the lowest address used in the network, e.g. zero. A node address of zero means messages from the master node have the highest priority. In a preferred embodiment of the present invention, a sync pulse is transmitted over bus 104 every 10.0 milliseconds producing 100 time divisions per second. Those skilled in the art recognize that the time division of a bus system can be tuned depending on the configuration of the system. The 10.0 millisecond time division of the preferred embodiment of the present invention is merely suitable for a particular bus system configuration. Each of messages 205-215 is a message transmitted over bus 104. The format and bit designation of each message is discussed above with respect to FIG. 1 and existing CAN systems. For simplicity each message in FIG. 2 is represented as a single box along timeline 100 rather than showing the more detailed bit by bit representation. An industrial process control example is provided to further explain the CAN-D system. Node 101 in FIG. 1 includes a mass flow sensor (not shown). Node 101 is configured to produce, during each time division, a message containing the current mass flow rate in grams per second of a fluid flowing through the mass flow sensor. Messages produced by Node A are real-time messages. Message 205 is transmitted by Node 101 during time division TD^, message 209 is transmitted by Node 101 during time division TDn+2 and message 213 is transmitted by Node 101 during time division TDn+2 Node 102 includes a pressure sensor. Node 102 is configured to produce,during each time division, a message containing the current drop in fluid pressure across the mass flow sensor in pounds per square inch. Messages produced by Node 102 are real-time messages. Message 206 is transmitted by Node 102 during time division TDn, message 210 is transmitted by Node 102 during time division TDn+1 and message 214 is transmitted by Node 102 during time division TDn+2-   The length of the periodic time divisions, the total<br><br>
number of nodes, the number of real-time nodes, and the length of each message are controlled by the system design to ensure that there is enough time during each time division for the necessary communications to occur.<br>
During each time division, the mass flow rate message from node 101 and the pressure drop message from node 102 are read by node 103 and processed by microprocessor 116. Microprocessor 116 combines the data from nodes 101-102 in a known way to produce a value representative of the viscosity of the measured fluid. The deterministic characteristic of the CAN-D system ensures that microprocessor 116 calculates viscosity using mass flow rate data and pressure data generated at or about the same time. In the case of the embodiment where the time divisions are 10.0 milliseconds long, one knows that the mass flow rate data and the pressure data were generated within 10.0 milliseconds of one another.<br>
Viscosity data produced by microprocessor 116 may be used in any of several different ways. For example, viscosity data may be presented on a display (not shown) for viewing by a user. Alternatively, viscosity data may be transmitted over bus 104 to another node on bus 104.<br>
Non-real-time messages are transmitted over bus 104 whenever they are available and priority arbitration permits their transmission. Messages 207, 208, 211, 212 and 215 are additional messages transmitted over bus 104. These messages may be real-time or non-real-time messages.<br>
Non-real-time messages are not necessarily low priority as compared to realtime messages. Using the above example, an additional node (not shown) includes a level sensor producing a level alarm. The level sensor is mounted in a tank into which is flowing the fluid whose viscosity is being measured. When the fluid reaches a certain level in the tank, the level sensor produces a level alarm which is transmitted as a message over bus 104. The level alarm message is not a realtime message but it is.assigned a relatively high priority since failure to respond to the level alarm could cause an overflow of the tank.<br>
The CAN-D bus communication system described with respect to FIG. 2 utilizes the message formatting, priority arbitration and error checking described with respect to the CAN protocol and FIG. 1. In addition, CAN-D makes use of commercially available CAN controller and transceiver chips. The sync message<br><br>
used to create a system time in CAN-D imbues the standard CAN protocol with a TDMA-like determinism. Thus, CAN-D is particularly well suited to real-time process control applications or any other application requiring the transmission of real-time data.<br>
The above example where Node 101 is a mass flowmeter and Node 102 is a pressure transducer is an example of the CAN-D system applied to a communications bus 104 between separate instruments in a process plant. One skilled in the art recognizes that the same principles of the CAN-D system are applicable to communications between two nodes of any type. CAN-D Node Activitv - FIG. 3<br>
FIG. 3 is a family of timing diagrams 200,300 and 301 illustrating, in general, the operation of the present invention including message-generation activity within nodes 101-102. Timeline 200 is identical to timeline 200 of FIG. 2 and indicates bus activity (CAN messages) over bus 104. Timelines 300 and 301 illustrate activity within nodes 101-102, respectively, during each time division. Whereas each box along timeline 200 denotes a CAN message over bus 104, each triangle along timelines 300 and 301 denotes the generation of a message content within nodes 101 -102, respectively. FIG. 3 illustrates the timing relationships between the generation of message information within nodes and the transmission of those messages over bus 104.<br>
Timeline 300 represents activity within node 101 of FIG. 1. Likewise, timeline 301 represents activity within node 102 of FIG. 1. For purposes of describing the overall operation of the CAN-D system it is not necessary to explain or understand the processing occurring within each node. It is only necessary to understand that standard CAN formatting and control logic is used at each node to make available messages for transmission over bus 104. For example, a node may be configured such that each sync pulse 201-204 causes the node to initiate the generation of a new message. Alternatively, a node may be configured such that every third synch pulse causes the node to initiate the generation of a new message. It is not necessary that each node, real-time or non-real-time, produce a message during each time division. Also, a single node might produce more than one message during a single time division. Each sync pulse is transmitted to every<br><br>
node on a CAN-D network thereby providing a common sense of time to every node.<br>
CAN message 209 transmitted over bus 104 during time division TDn+1 contains message content 302. Message content 302, illustrated on timeline 300, is generated by microprocessor 107 during time division TDn. The generation of message content 302 occurs because node 101 is configured to produce a realtime message during every time division. Alternatively, message content 302 can be generated in response to a "publication demand" requesting the generation of the message. A publication demand instructs a node to prepare a message for transmission over the bus. Publication demands can originate from a node over bus 104 as a system message or can originate within each node. Message content 302 is queued within node 101 until sync pulse 202. Message content 304 is generated within node 102 during time division TDn and is queued within node 102 until sync pulse 202.<br>
After each sync pulse 201-204 occurs, the messages queued at the nodes are transmitted over bus 104 and new messages are generated and queued at the nodes. For example, after synch pulse 202, the messages queued at nodes 101-102 are transmitted over bus 104 and new messages are generated and queued at nodes 101-102. Message content 302, generated and queued within node 101 during time division TDn, is transmitted over bus 104 as message 209 after sync pulse 202 during time division TDn+i. Message content 304, generated and queued within node 102 during time division TDn, is transmitted over bus 104 as message 210 after sync pulse 202 during time division 70n+1. Messages from node 101 have a higher CAN priority than messages from node 102 therefore message 209 is transmitted over bus 104 before message 210 is transmitted over bus 104.<br>
Message content 303 is generated within node 101 and message content 305 is generated within node 102 during time division TDN+1. Both messages are queued within their respective nodes until the next sync pulse 203. As occurs during each time division, queued messages are transmitted over bus 104 after each synch pulse. After sync pulse 203, message content 303 is transmitted over bus 104 as message 213 and message content 305 is transmitted over bus 104 as message 214. It does not matter when during a time division a certain message<br><br>
content is generated. It only matters that a real-time message is generated during each time division, if the node is so configured. Standard CAN priority arbitration will ensure the proper order of transmission of messages over bus 104.<br>
Messages 205 and 206 transmitted over bus 104 during time division TDn were generated during a previous time division TDN+1 (not shown). Sync pulse 201 initiated their transmission from nodes 101-102, respectively, over bus 104. The above discussion of FIG. 3 relates to real-time messages transmitted over bus 104. A deterministic communications bus requires the ensured schedulability of the actions and messages in a real-time system. The CAN-D system ensures that realtime data will be communicated during known and predictable time divisions. The deterministic quality of the CAN-D system is not important to the transmission of non-real-time messages. During each time division, the real-time messages are transmitted over the CAN bus before the non-real-time messages. This is guaranteed by assigning higher priority CAN addresses to the real-time nodes than are assigned to the non-real-time nodes. After the transmission of all real-time messages, the time remaining in a given time division is available for the transmission of non-real-time messages. If any non-real-time messages are not sent because the time division ends, the remaining non-real-time messages are held over for transmission during the next time division. During the next time division, transmission of the held-over non-real-time messages again must wait until the real-time messages are sent. CAN-D Segmented Time Divisions - FIG. 4<br>
Various implementations of CAN-D are possible that all result in a deterministic, CAN communications environment. FIG. 4 illustrates a timing diagram of one embodiment of the present invention where each time division is segmented into three segments and the sync signal performs multiple functions in addition to signaling the start of a new time division.<br>
Timeline 400 illustrates message activity over bus 104 during two time divisions. Time division TDn, which is representative of each time segment, is broken into three segments 401-403. Segment 401 is the "sync segment", segment 102 is the "real-time segment" and segment 403 is the "non-real-time segment", rime division TDn is initiated by the transmission of sync message 407.   Sync<br><br>
V	message 407 is a high priority system message that is transmitted for the duration of sync period 401. Sync message 407 is, like the sync pulse of FIGS. 2-3, a CAN message having the highest priority. Transmission of sync message 407 accomplishes several objectives. One objective accomplished by the transmission of sync message 407 is the initiation of a new time division. Another objective accomplished by the transmission of sync message 407 is that the transmission of all other messages are held off the bus due to the high priority of the sync message. A further effect of the sync message is as a signal or interrupt to each node to build its real-time messages. Messages are prepared at each node during synch period 401 and their transmission over bus 104 awaits standard CAN arbitration during segments 402-403. The duration of the sync message is the same length of time during each time division. In one embodiment using 10.0 millisecond time divisions, for example, the sync message lasts for 1 millisecond.<br>
During segment 401, which corresponds to transmission of sync message 407, the various real-time producing nodes generate and queue their respective real-time messages. Segment 402 of TDn begins when sync message 407 is complete. Standard CAN priority arbitration then automatically sorts the queued real-time messages and allows them to be sent out over bus 104 during segment 402. The real-time and non-real-time messages are prioritized such that all the real-time messages, but only the real-time messages, are transmitted during the real-time segment of each time division.<br>
Segment 403 of TDn begins when all the real-time messages have been transmitted over bus 104. The number of real-time nodes connected to bus 104 must be selected such that each one can transmit a message during each real-time segment and still leave a long enough non-real-time segment for a sufficient amount of non-real-time messages. Any non-real-time messages for which there is not enough time to transmit during a given time division are held off the bus until the non-real-time segment of the next time division.<br>
Time division TDn+i is segmented into sync segment 404, real-time segment 405 and non-real-time segment 406. CAN messages are formed and transmitted during time division TDn+i, and other time divisions (not shown), as described with respect to time division TDn.<br><br>
intra-Nodal Communications -FIG. 5<br>
The communications protocol of the present invention is also applicable to communications between functional blocks within a single node. FIG. 5 illustrates a node 500 connected to a CAN-D bus 501. Node 500 includes the major components discussed with respect to FIGS. 1-4 namely, CAN transceiver 502, CAN controller 504 and microprocessor 506. CAN transceiver 502 controls the physical interface between node 500 and CAN-D bus 501. CAN transceiver 502 communicates over path 503 to CAN controller 504 which implements the standard CAN protocol features such as priority arbitration and error checking. CAN controller 504 communicates over path 505 to microprocessor 506. Microprocessor 506 is shown in greater detail than the microprocessors of FIG. 1. Programmed instructions for the operations performed by node 500 are executable on Central Processing Unit ("CPU") 507. CPU 507 stores and/or retrieves the programmed instructions and/or data from memory devices that include, but are not limited to, Random Access Memory (RAM) 509 and Read Only Memory (ROM) 510 by way of memory bus 508. Another accessible memory device includes non-volatile memory device 512 by way of local bus 511. Programmed instructions for implementing multiple applications 513-515 are stored on non-volatile memory device 512. Software router 516 directs the intra-nodal operation of node 500, as described below. Various input and output devices (not shown) are connected to local bus 511 to allow a user to interact with the functionality of node 500.<br>
Software router 516 is an application executed by CPU 507. Software router 516 is programmed by a user to direct the operation of other applications or functional blocks within node 500. For example, in one embodiment of node 500, a measurement of viscosity is delivered by node 500 to CAN-D bus 501 every other time division. Software router 516, as executed by CPU 507. responds to each sync signal to direct operations by applications 513-515. In the current example, application 513 produces a mass flow rate datum, application 514 produces a differential pressure datum and application 515 produces a viscosity datum. Application 515 uses the data from applications 513-514 to produce the viscosity datum. Applications 513-515 produce their respective output when directed to do so by software router 516. Software router 516 directs which of applications 513-<br><br>
515, if any, should produce output subsequent to each sync Signal. For the current example, software router 516 is programmed to 1) request application 513 (mass flow rate) produce output during each time division, 2) request application 514 (differential pressure) produce output during alternating time divisions, and 3) request application 515 (viscosity) produce output during alternating time divisions (the time divisions when application 514 is not producing output). In response to a first sync signal, software router 516 instructs application 513 and 514 to produce output. During a first time division (initiated by the first sync signal), applications 513 and 514 produce output messages to software router 516. In response to a second sync signal, software router 516 directs the output messages from applications 513-514 (generated during the previous time division) to application 515 and directs the mass flow rate output message from application 513 to CAN-D bus 501. Other nodes (not shown) on CAN-D bus 501 utilize the mass flow rate output from node 500. Software router 516 also requests application 515 to produce a viscosity output message. Application 515 processes the mass flow rate and differential pressure messages produced by applications 513 and 514 (generated during the previous time division), respectively, to produce a viscosity message which is sent to software router 516. During a third time division (after a third sync signal), software router 516 directs the viscosity message (received from application 515 during the previous time division) to CAN-D bus 501 for consumption by other nodes (not shown).<br>
The CAN-D protocol and software router allow for flexible implementation and amendment of an overall system architecture. For example, it may be more efficient to have the mass flow rate information generated in a node different and separate from the viscosity-producing node. Application 513 is thus moved from node 500 to a different node (not shown) on CAN-D bus 501. No changes need be made to application 513. it simply resides on another node where that node's software router instructs application 513 when to produce output.<br>
A "software router" is not required according to the communications protocol of the present invention. For example, each functional block within a node could instead be configured to produce the appropriate message(s) during each time division and send the message(s) so they are received during an appropriate time<br><br>
division. The software router simply serves as a convenient scheduling tool which, among other things, queues a message received during one time division and sends the queued message to the appropriate functional block during the next time division. This ensures that messages are communicated in a fashion that preserves the deterministic quality of the communications protocol of the present invention.<br>
In a further embodiment of the present invention, the intra-nodal communication described with respect to FIG. 5 is utilized where a node does not exchange data with a CAN-D bus or any other type of bus. With reference to FIG. 5, only microprocessor 506 is relevant to this embodiment and the remaining elements, e.g. CAN transceiver 502, CAN controller 504 and CAN-D bus 501, either do not exist or are not utilized. Rather than receiving a sync pulse from a master node on a bus, a timer is implemented utilizing operating system methods to produce a periodic event having the equivalent effect as a sync pulse. An operating system is a set of services which provide a means by which 1 or more functional blocks can share a hardware platform. Each timer event marks the start of a new time division during which software router 516 sends request messages to functional blocks 513-515. Functional blocks 513-515 receive the request messages from software router 516 and deliver the requested data back to software router 516. In this embodiment, software router 516 takes advantage of a message queue provided by the operating system to queue the messages from functional blocks 513-515 until the next time division. At the start of the next time division, software router 516 distributes the queued messages to the appropriate ones of functional blocks 513-515 and sends the next set of request messages to functional blocks 513-515. Messages are prioritized in this embodiment according to operating system methods by assigning a high priority to real-time messages and lower priorityto non-real-time messages. This embodimentallowsfordeterministic, real-time processing within a single node even when the node is not connected to a CAN-D bus. Of course, a node operating in this fashion is easily integrated into a CAN-D bus environment, if appropriate.<br><br>
Nodal Processing Steps - FIG, 6<br>
FIG. 6 depicts the steps which occur at each node in response to a sync signal. FIG. 6 is used to describe the operation of the embodiment including multiple nodes on a CAN-D bus as well as the embodiment of a single node not connected to a CAN-D bus but communicating among multiple functional blocks according to a CAN-D-based protocol. During step 600 the sync signal is received at a node. As noted above, the sync signal is transmitted from a master node to the bus or, alternatively, may be generated as a local timer event in the case where a node operates independently from a bus. A common sense of time among all the nodes of the bus and/or all the functional blocks within a node is achieved by each node resetting a new time division with each sync signal. A new time division begins with each sync signal and processing continues to step 601.<br>
During step 601 any real-time messages that were queued during the previous time division are appropriately communicated. In the case of multiple nodes connected to a CAN-D bus, the real-time messages are put on the CAN-D bus. In the case of a signal node, the real-time messages are distributed to the appropriate functional blocks.   Processing then continues to step 602.<br>
During step 602 real-time data for the current time division is generated. Depending on the configuration of the node (and/or of the software router in the node) some real-time data may be sent during the time division in which the realtime data is generated. Non-real-time data is typically sent whenever there is time available during a time division. This may be after all the real-time data has been sent or during a period when real-time data is being generated and the bus is idle. Processing continues from step 602 to decision block 603 where, if more time is available in the current time division, processing is passed to step 604. During step 604 non-real-time data is sent. Real-time data may also be sent during this step. Steps 603-604 are repeated until another sync signal is generated indicating the start of a new time division.<br>
Processing steps 600-604 operate to transmit real-time data first during each time division. The remaining time is used for the transmission of non-real-time data.<br><br>
Summary<br>
The serial bus communication system of the present invention combines the simplicity and availability of low-cost CAN components and protocol with the attribute of determinism. Thus the deterministic-CAN protocol of the present invention is well-suited for the communication of real-time data as compared to prior CAN implementations.<br><br><br>
WE CLAIM:<br>
1.	A method of deterministically communicating data between multiple<br>
nodes (500) consistent with the Controller Area Network ("CAN") serial<br>
communications protocol, comprising the steps of:<br>
providing a communication means (501) between said multiple nodes wherein each of said multiple nodes is available to said communications means;<br>
generating a periodic event (401) recognized over said communication means by said multiple nodes;<br>
initiating, responsive to said periodic event, common time divisions (TDn) at said multiple nodes; and<br>
transmitting said data between two nodes of said multiple nodes over said communication means wherein said data is transmitted during a known one of said time divisions.<br>
2.	The method of claim 1 wherein said providing step includes:<br>
providing a communication means wherein said communication means is a<br>
data bus to which all of said multiple nodes are connected.<br>
3.	The method of claim 2 wherein said generating step includes:<br>
generating a periodic event wherein said periodic event is a periodic<br>
synchronization signal; and<br>
issuing said periodic synchronization signal from one of said multiple nodes over said data bus to said multiple nodes.<br>
4.	The method of claim 2 wherein said providing step includes:<br>
translating messages generated by each of said nodes to messages<br>
consistent with said CAN protocol.<br>
5.	The method of claim 2 wherein said step of providing said data bus<br>
includes:<br>
connecting each of said multiple nodes to said data bus wherein each of said nodes includes an independent instrument.<br><br>
D.	The method of claim 5 wherein said connecting step includes:<br>
translating messages generated at each of said nodes with a CAN controller<br>
to provide messages from each of said nodes that are consistent with said CAN<br>
protocol.<br>
7.	The method of claim 2 wherein said step of providing said data bus<br>
includes:<br>
connecting each of said multiple nodes to said data bus wherein each of said nodes includes a block of functionality for a single instrument.<br>
8.	The method of claim 7 wherein said connecting step includes:<br>
translating messages generated at each of said nodes with a CAN controller<br>
to provide messages from each of said nodes that are consistent with said CAN protocol.<br>
9.	The method of claim 3 wherein said issuing step includes:<br>
generating at a master node which is one of said nodes a high priority CAN<br>
message as said synchronization signal; and<br>
issuing said synchronization signal periodically over said data bus to each of said nodes.<br>
10.	The method of claim 9 wherein said generating step includes:<br>
generating at said master node a synchronization signal comprised of<br>
multiple, successive high priority CAN messages; and<br>
issuing said synchronization signal periodically over said data bus to each of said nodes.<br>
11.	The method of claim 3 wherein said issuing step includes:<br>
receiving said periodic synchronization signal at said multiple nodes; and<br>
resetting a local time division at each of said nodes such that each of said<br>
nodes operates according to said common time divisions.<br><br>
12.	The method of claim 11 wherein said issuing step further includes:<br>
forming, responsive to said resetting step, a CAN message for transmission<br>
over said data bus.<br>
13.	The method of claim 12 wherein said forming step includes:<br>
forming, responsive to said resetting step, a CAN message containing real<br>
time data for transmission over said data bus.<br>
14.	The method of claim 11 wherein said issuing step further includes:<br>
segmenting each of said time divisions into segments during which different<br>
classes of said data are transmitted over said data bus.<br>
15.	The method of claim 1 wherein said providing step includes:<br>
providing a communication means between said multiple nodes wherein<br>
each of said multiple nodes is a block of functionality within a single instrument.<br>
16.	The method of claim 15 wherein said providing step includes:<br>
providing a communication means between said multiple nodes wherein said<br>
communication means is an operating system of said instrument.<br>
17.	The method of claim 16 wherein said generating step includes:<br>
generating a periodic event wherein said periodic event is a timer output of<br>
said operating system; and<br>
passing said timer output from said operating system to said multiple nodes.<br>
18.	An apparatus for deterministically communicating data between<br>
multiple nodes (500) according to the Controller Area Network ("CAN") serial<br>
communications protocol, comprising:<br>
a data bus (501) to which is connected each of said multiple nodes; a  master node which  is one of said  nodes for issuing a  periodic synchronization signal (401,411) over said data bus to said multiple nodes;<br></td>
			</tr>
		</table>	
		<br>
		<h3>Documents:</h3>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1hYnN0cmFjdC5wZGY=" target="_blank" style="word-wrap:break-word;">1118-mas-1998-abstract.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1jbGFpbXMgZHVwbGljYXRlLnBkZg==" target="_blank" style="word-wrap:break-word;">1118-mas-1998-claims duplicate.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1jbGFpbXMgb3JpZ2luYWwucGRm" target="_blank" style="word-wrap:break-word;">1118-mas-1998-claims original.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1jb3JyZXNwb25kYW5jZSBvdGhlcnMucGRm" target="_blank" style="word-wrap:break-word;">1118-mas-1998-correspondance others.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1jb3JyZXNwb25kYW5jZSBwby5wZGY=" target="_blank" style="word-wrap:break-word;">1118-mas-1998-correspondance po.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1kZXNjcmlwdGlvbiBjb21wbGV0ZSBkdXBsaWNhdGUucGRm" target="_blank" style="word-wrap:break-word;">1118-mas-1998-description complete duplicate.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1kZXNjcmlwdGlvbiBjb21wbGV0ZSBvcmlnaW5hbC5wZGY=" target="_blank" style="word-wrap:break-word;">1118-mas-1998-description complete original.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1kcmF3aW5ncy5wZGY=" target="_blank" style="word-wrap:break-word;">1118-mas-1998-drawings.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1mb3JtIDEucGRm" target="_blank" style="word-wrap:break-word;">1118-mas-1998-form 1.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1mb3JtIDI2LnBkZg==" target="_blank" style="word-wrap:break-word;">1118-mas-1998-form 26.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1mb3JtIDMucGRm" target="_blank" style="word-wrap:break-word;">1118-mas-1998-form 3.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTExOC1tYXMtMTk5OC1mb3JtIDQucGRm" target="_blank" style="word-wrap:break-word;">1118-mas-1998-form 4.pdf</a></p>
		<br>
		<div class="pull-left">
			<a href="205213-a-process-for-the-preparation-of-2-hydroxymethyl-4-3-methoxypropoxy-3-methylpyridine-hydrochloride.html">&laquo; Previous Patent</a>
		</div>
		<div class="pull-right">
			<a href="205215-improving-the-flow-field-in-the-inlet-plenum-of-a-fluidised-bed.html">Next Patent &raquo;</a>
		</div>			
	</div><!-- /span8 -->
	<div class="span4">
		<div class="well infobox">
			<table class="table table-condensed">
				<tr>
					<th>Patent Number</th>
					<td>205214</td>
				</tr>
				<tr>
					<th>Indian Patent Application Number</th>
					<td>1118/MAS/1998</td>
				</tr>
				<tr>
					<th>PG Journal Number</th>
					<td>26/2007</td>
				</tr>
				<tr>
					<th>Publication Date</th>
					<td>29-Jun-2007</td>
				</tr>
				<tr>
					<th>Grant Date</th>
					<td>22-Mar-2007</td>
				</tr>
				<tr>
					<th>Date of Filing</th>
					<td>26-May-1998</td>
				</tr>
				<tr>
					<th>Name of Patentee</th>
					<td>MICRO MOTION,INC</td>
				</tr>
				<tr>
					<th>Applicant Address</th>
					<td>7070 WINCHESTER CIRCLE, BOULDER,,COLORADO 80301</td>
				</tr>
				<tr>
					<td colspan=2>
								<h5>Inventors:</h5>
								<table class="table">
									<tr>
										<th>#</th>
										<th>Inventor's Name</th>
										<th>Inventor's Address</th>
									</tr>

										<tr>
											<td>1</td>
											<td>THOMAS C GREEN</td>
											<td>4709 HARWICH STREET,BOULDER,COLORADO 80301</td>
										</tr>
										<tr>
											<td>2</td>
											<td>PAUL J HAYS,</td>
											<td>386 EAST RAINTREE COURT,LOUISVILLE,COLORADO 80027</td>
										</tr>
										<tr>
											<td>3</td>
											<td>ALLAN L SAMSON,</td>
											<td>1001 MAUREEN,BERTHOUD,COLORADO 80513</td>
										</tr>
										<tr>
											<td>4</td>
											<td>JEFFREY S WALKER,</td>
											<td>861 ST. ANDREWS LANE,LOUISVILLE,COLORADO 80027</td>
										</tr>
										<tr>
											<td>5</td>
											<td>MICHAEL J ZOLOCK,</td>
											<td>1425 MISSOURI AVENUE,LONGMONT,KCOLORADO 80501</td>
										</tr>
								</table>
					</td>
				</tr>
				<tr>
					<th>PCT International Classification Number</th>
					<td>H04L12/413</td>
				</tr>
				<tr>
					<th>PCT International Application Number</th>
					<td>N/A</td>
				</tr>
				<tr>
					<th>PCT International Filing date</th>
					<td></td>
				</tr>
				<tr>
					<td colspan=2>
						<h5>PCT Conventions:</h5>
						<table class="table">
							<tr>
								<th>#</th>
								<th>PCT Application Number</th>
								<th>Date of Convention</th>
								<th>Priority Country</th>
							</tr>

								<tr>
									<td>1</td>
									<td>08/863,531</td>
									<td>1997-05-27</td>
								    <td>U.S.A.</td>
								</tr>

						</table>
					</td>
				</tr>
			</table>
		</div><!-- /well -->
	</div><!-- /span4 -->
</div><!-- /row-fluid -->

        </div>

      </div><!--/row-->

      <footer class="footer">

        <style>
        .allindianpatents-footer { width: 320px; height: 50px; }
        @media(min-width: 500px) { .allindianpatents-footer { width: 468px; height: 60px; } }
        @media(min-width: 800px) { .allindianpatents-footer { width: 728px; height: 90px; } }
        </style>
        <center>
        </center>

        <p>&copy; All Indian Patents, 2013-2021.</p>
        <p>Patent data available in the public domain from Indian Patents Office, Department of Industrial Policy and Promotions, Ministry of Commerce and Industry, Government of India.</p>
      </footer>

    </div> <!-- /container -->

    <!-- Javascripts
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/application-95f297ff0d8d2015987f04b30593c800.js" type="text/javascript"></script>

    <!-- Start of StatCounter Code for Default Guide -->
    <script type="text/javascript">
    var sc_project=8902313; 
    var sc_invisible=1; 
    var sc_security="3c1f8147"; 
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write("<sc"+"ript type='text/javascript' src='" +
    scJsHost+
    "statcounter.com/counter/counter.js'></"+"script>");
    </script>
    <noscript><div class="statcounter"><a title="web stats"
    href="http://statcounter.com/free-web-stats/"
    target="_blank"><img class="statcounter"
    src="http://c.statcounter.com/8902313/0/3c1f8147/1/"
    alt="web stats"></a></div></noscript>
    <!-- End of StatCounter Code for Default Guide -->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-244143-31', 'allindianpatents.com');
      ga('send', 'pageview');

    </script>

  </body>

<!-- Mirrored from www.allindianpatents.com/patents/205214-a-method-for-reducing-the-number-of-messages-needed-to-transfer-data-in-a-deterministic-manner-between-a-plurality-of-nodes by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Apr 2024 08:02:42 GMT -->
</html>
