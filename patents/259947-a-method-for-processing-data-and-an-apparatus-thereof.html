<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from www.allindianpatents.com/patents/259947-a-method-for-processing-data-and-an-apparatus-thereof by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 04 Apr 2024 23:31:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Patents. 259947:&quot;A METHOD FOR PROCESSING DATA AND AN APPARATUS THEREOF&quot;</title>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="cYcP52B8zyTWKbLwby2YPh9z/gvY/RLjWOwY4YXkiXg=" name="csrf-token" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js" type="text/javascript"></script>
    <![endif]-->

    <link href="../assets/application-e80cf34975c5b1730c80b2f7170e7d26.css" media="all" rel="stylesheet" type="text/css" />

  </head>
  <body>

    <div class="navbar navbar-fluid-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">Indian Patents</a>
          <div class="container-fluid nav-collapse">
            <ul class="nav">
              <li><a href="../recently-granted.html">Recently Granted Patents</a></li>
              <li><a href="../recently-published.html">Recently Published Patents</a></li>
            </ul>
            <form id="gform" class="navbar-search pull-right" action="https://www.google.com/search" method="get" target="_blank" onsubmit="document.getElementById('gform').q.value='site:http://www.allindianpatents.com '+document.getElementById('gform').q.value">
                <input type="text" name="q" id="q" class="search-query" placeholder="Search" onclick="this.value=''" autocomplete="off">
            </form>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span12">

          <style>
          .allindianpatents-top { width: 320px; height: 50px; }
          @media(min-width: 500px) { .allindianpatents-top { width: 468px; height: 60px; } }
          @media(min-width: 800px) { .allindianpatents-top { width: 728px; height: 90px; } }
          </style>
          <center>
          </center>
          
          <div class="row-fluid">
	<div class="span8">

		<table class="table">
			<tr>
				<th>Title of Invention</th>
				<td><h1 style="font-size:large;">&quot;A METHOD FOR PROCESSING DATA AND AN APPARATUS THEREOF&quot;</h1></td>
			</tr>
			<tr>
				<th>Abstract</th>
				<td>A method for processing data, comprising: receiving a scrambled program and encrypted data comprising a payload, wherein a user does not initially have access rights to access the payload by means (2016, 2018); provisionally storing the encrypted data with the scrambled program by means (2100); and when the user obtains access rights to access the payload: decrypting the encrypted data by means (2004, 2062), extracting the payload from the encrypted data to obtain an extracted payload by means (2004), wherein the payload comprises at least one control word used to descramble the scrambled program, and subsequently replacing the provisionally stored encrypted data with the extracted payload by means (2004), so that the extracted payload and the scrambled program are stored after the user obtains access rights to access the payload.</td>
			</tr>
		</table>

					<style>
					.allindianpatents-post-abstract { width: 320px; height: 50px; }
					@media(min-width: 880px) { .allindianpatents-post-abstract { width: 468px; height: 60px; } }
					@media(min-width: 1267px) { .allindianpatents-post-abstract { width: 728px; height: 90px; } }
					</style>
					<center>
					<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- AllIndianPatents-post-abstract -->
					<ins class="adsbygoogle allindianpatents-post-abstract"
					     style="display:inline-block"
					     data-ad-client="ca-pub-7914358224572760"
					     data-ad-slot="9152759240"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>					
					</center>

		<table class="table">
			<tr>
				<th>Full Text</th>
				<td>The present invention relates to a a method for processing data and an apparatus thereof.<br>
The invention relates to'a virtual smartcard, a virtual smartcard manager, apparatus for processing data, a conditional access system, a receiver/decoder, a broadcast system, a method of processing data, a method of generating a cryptographic key, a method of storing a cryptographic key value, a computer program product, a computer readable medium and a signal. The invention finds particular application in relation to conditional access systems for receiver/decoders.<br>
Digital television systems transmit television channels to the viewer in digital, rather than analogue, form. The digital channels are encoded into a digital data stream at the transmitter end, and are decoded at the receiver end using a digital receiver/decoder. To allow interactivity, an uplink may be provided, either via the same medium that delivers the television channels, or else via a different medium such as a telephone link. Further types of data, such as digital audio, software and interactive data can be or are also broadcast. As used herein, the term "digital television system" includes for example any satellite, terrestrial, cable and other system.<br>
The term "receiver/decoder" as used herein may connote a receiver for receiving either encoded or non-encoded signals, for example television and/or radio signals, preferably in MPEG format, which may be broadcast or transmitted by some other means. The term may also connote a decoder for decoding received signals. Embodiments of such receiver/decoders may include a decoder integral with the receiver for decoding the received signals, for example, in a "set-top box", such as a decoder functioning in combination with a physically separate receiver, or such a decoder including additional functions, such as a web browser, a video recorder, or a television.<br>
The term MPEG refers to the data transmission standards developed by the International Standards Organisation working group "Motion Pictures Expert Group" and in particular but not exclusively the MPEG-2 standard developed for digital television applications and set out in the documents ISO 13818-1, ISO 13818-2, ISO 13818-3 andlSO 13818-4, and<br>
the MPEG-4 and other contemplated MPEG standards. In the context of the present patent application, the term includes all variants, modifications or developments of MPEG formats applicable to the field of digital data transmission.<br>
In known receiver/decoders, a releasably connectable smartcard provides secure storage of cryptographic 'secrets' (such as the master and other exploitation keys required to decode conditional access data), and also performs critical cryptographic operations in respect of the cryptographic 'secrets'. Typically, a dedicated smartcard reader is also used, providing a standard (if inflexible) interface to other software and hardware components of the receiver/decoder which require use of the smartcard.<br>
In other developments, systems have been proposed for receiver/decoders to allow the storage (and later playback) of received audiovisual content on mass storage devices attached to or contained within the receiver/decoders. Many such systems store the audiovisual content in scrambled form for security reasons, and-principally for security reasons - use smartcards, such as those described above, to descramble the content during playback (in a similar way to the way in which the smartcards are used during live viewing of content).<br>
The present invention seeks to address problems identified in the above prior art.<br>
Accordingly, in a first aspect of the invention, there is provided a virtual smartcard.<br>
The term "smartcard" as used herein preferably connotes any conventional chip-based portable card type devices possessing, for example, microprocessor and/or memory storage, particularly forperforming cryptographic operations. This may include PCMCIA cards, SIM cards, and so on. In particular, the term "smartcard" is intended to imply more a portability and/or cryptographic processing ability than it is intended to imply a particular shape or size, and consequently chip devices having alternative physical forms, for example key-shaped devices such as are often used in TV decoder systems are also included in this term.<br>
Preferably the smartcard is provided at least in part in software, and may be provided at least in part in hardware, in any suitable combination. For example, a random number generator, used pervasively in cryptographic schemes, could be implemented in hardware, with more managerial functions being implemented in software.<br>
By providing a virtual smartcard, a degree of flexibility can be afforded to systems which otherwise require the presence of a real, physical smartcard.<br>
This important feature is also provided in the form of apparatus for processing data, comprising a virtual smartcard. The term "data" as used herein preferably connotes information generally, in both stored form and in the form of a signal (electrical or otherwise). Preferably the data is processed by the virtual smartcard.<br>
This feature is further provided in the form of apparatus for processing data, comprising means (such as a processor and associated memory) for emulating a smartcard, so as to provide a virtual smartcard.<br>
The means for emulating a smartcard preferably comprises means (such as the same or d further processor) for performing a cryptographic operation and means (such as the same or a further memory) for storing cryptographic data. The means for performing a cryptographic operation is preferably chosen to be faster than the corresponding means in a real smartcard equivalent to tire virtual smartcard, which can yield an improved performance with respect to the real smartcard; similarly, the means for storing cryptographic data is preferably faster and/or has a greater capacity than the corresponding means in a real smartcard, which can yield a yet further improved performance. The means for performing a ciyptographic operation could be a receiver/decoder host processor, for example, and the means for storing cryptographic data could be the RAM associated with the host processor, for example.<br>
Tins can allow a wide range of cryptographic tasks to be emulated in the virtual smartcard. Furthermore, this can allow functionality of the virtual smartcard beyond that of a conventional smartcard, such as allowing the successful real-time descrambling of<br>
content during a fast-forward playback mode (which conventional smartcards can fail to achieve, given the length of time they take to decrypt control words and the further amount of time spent on other time-consuming operations, such as general rights management).<br>
In a related aspect of the invention, there is provided a virtual smartcard manager, which can allow more efficient operation of the virtual smartcard. In particular, the virtual smartcard manager may provide an abstraction layer to the implementation of the functionality of the virtual smartcard. The term "manager" as used herein preferably connotes an entity having at least one of control, interface, and data routing and/or processing functions.<br>
This important feature is also provided independently in the form of apparatus for processing data, comprising a virtual smartcard manager.<br>
The apparatus preferably further comprises means for interfacing with the virtual smartcard, simplifying the management of the virtual smartcard.<br>
This important feature is also provided independently. Accordingly, in a related aspect of the invention, there is provided apparatus for processing data, comprising means for interfacing with a virtual smartcard. Again, the data is preferably processed by the virtual<br>
smartcard.<br>
The above apparatus preferably further comprises means for exchanging cryptographic data with the virtual smartcard. Such means for exchanging cryptographic data may comprise either means for sending cryptographic data to the virtual smartcard, or means for receiving cryptographic data from the virtual smartcard, or both. The means for sending and receiving cryptographic data could be events and function calls, for example, such as those between the virtual smartcard manager and virtual smartcard described below.<br>
Thus the management of the virtual smartcard may be further facilitated.<br>
]f the apparatus further comprises means for determining the presence of a real smartcard equivalent to the virtual smartcard, the apparatus preferably further comprises means for exchanging cryptographic data with the real equivalent of the smartcard. The virtual smartcard may implement only a subset of the features provided by the real equivalent of the virtual smartcard, and vice versa. By determining the presence of a real smartcard equivalent to the virtual smartcard and optionally exchanging cryptographic data with it, further options can be provided for the processing of data.<br>
The apparatus may comprise means for selecting a smartcard. The selection of an appropriate smartcard can add a degree of flexibility to the system.<br>
In particular, the apparatus may further comprise means for decoding data using the selected smartcard, the means for selecting a smartcard being adapted to select the smartcard in dependence on a characteristic of the data. The characteristic may be, for example, the commercial importance of the data, the duration (preferably as a measure time) of the data, the size of the data, or the extent to which the data has been distributed. Thus yet more flexibility can be provided.<br>
The data may comprise audio/visual or other content, such as an electronic book, software, games, and so on. The term "audio/visual" as used herein preferably connotes either audio or visual matter, or a combination of the two. In the context of a broadcast signal received by a receiver/decoder, the term may encompass subtitle, teletext, synchronisation and other data transmitted in close relation to audio and video components making up a television programme.<br>
The apparatus may further comprise means for selecting one of a payload and encrypted data containing the payload, means for storing the selected payload or encrypted data, and means for replacing the stored encrypted data with the payload. This may, for example, correspond to the process of first storing in a Content Management Message (CMM) cryptographic keys (typically control words for the cryptoperiod in question), when available, or otherwise storing encrypted data containing the cryptographic keys (typically the relevant Entitlement Control Message), and then subsequently replacing the encrypted<br>
data with the corresponding key when the key is available (as described later).<br>
By providing the above means, the requirement can be avoided of having to decrypt the payload at the time of storage (if, for example, a particular data unit which will ultimately contain the payload is being constructed at that time).<br>
This important feature is also provided independently.<br>
Accordingly, in a related aspect of the invention, there is provided apparatus for processing data, comprising means for selecting one of a payload and encrypted data containing the payload, means for storing the selected payload or encrypted data, and means for replacing the stored encrypted data with the payload.<br>
As mentioned above, the encrypted data could be an Entitlement Control Message (ECM), having a payload of the control word or words necessary to descramble a given section of content. Consequently, the means for selecting is preferably adapted to select one of at least one control word and an Entitlement Control Message.<br>
In more detail, the apparatus preferably further comprises means for sending the encrypted data to a smartcard, and means for receiving from the smartcard either the payload contained in the encrypted data or a response indicating that the payload can not be decrypted. Preferably the means for selecting one of a payload and the encrypted data is adapted to select the payload if it is available, and the encrypted data containing the payload otherwise. This can provide further flexibility.<br>
in addition, the apparatus preferably further comprises means for at least one of storing and reproducing data, the payload being related to the data. For example, the data could be audio/visual content, and the payload could be an Entitlement Control Message (ECM) containing the control words for a particular portion of the content. This can usefully integrate the storing or reproducing of the content with the descrambling of the content (or other operations requiring the use of a smartcard).<br>
Preferably the apparatus further comprises means for encapsulating an encrypted data object in a further encrypted data object. This can further increase the security of the encrypted data object, and may further simplify exchanges with client processes by allowing a single interface and/or suitable abstraction to be provided. Furthermore, the apparatus preferably further comprises means for encapsulating an Entitlement Control Message in a Content Management Message, with the benefits outlined earlier.<br>
Preferably the apparatus further comprises means for encrypting the stored payload or encrypted data with an encryption key. Furthermore the apparatus preferably further comprises means for authenticating the stored payload or encrypted data -with an authentication key. In both cases, this can afford greater security.<br>
Furthermore, the apparatus preferably further comprises means for encrypting communication between the apparatus and a smartcard with a communication encryption key, and preferably further comprises means for authenticating communication between the apparatus and a smartcard with a communication authentication key. This can afford<br>
yet further security.<br>
The above-mentioned encryption and authentication keys may consist of public and private key pairs for use with public-key cryptography, for example. Furthermore, for convenience, the communication encryption key may be identical to or derived from the encryption key, and similarly the communication authentication key may be identical to or derived from the authentication key.<br>
The apparatus may further comprise means for establishing at least one session, and means for associating with the or each session a respective session identifier. This can further assist in the management of the smartcard or cards.<br>
The apparatus may further comprise means for utilising a master session key to generate an encryption/authentication key, preferably a key as aforesaid. The means for utilising preferably comprises a diversifying function accepting as an input the original master session key and a diversifying value (preferably an integer) and producing as an output<br>
a further ciyptographic key. Furthermore, the diversifying function is preferably chosen such that its outputs for a range of diversifying inputs are preferably substantially all cryptographically strong keys. For public/private cryptographic systems, the diversifying functions preferably employ various properties of prime numbers to ensure the ciyptographic strength of the outputs.<br>
This can simplify the generation of such an encryption/authentication key, particularly where a plurality of keys are to be generated.<br>
This important feature is also provided independently. Accordingly, in a related aspect of the invention, there is provided apparatus for processing data, comprising means for storing a cryptographic key, and means for utilising a master session key to generate one of an encryption and authentication key for encrypting and authenticating the stored ciyptographic key respectively.<br>
Furthermore, the encryption/authentication key may relate to a given session, in which case the means for utilising may be adapted to diversify the master session key with the corresponding session identifier. This can provide a systematic and simple way to generate any number of keys.<br>
The apparatus may further comprise means for using the encryption/authentication key to encrypt/authenticate a further session. For example, the same key or keys can be used to encrypt and/or authenticate a session between the HDVR and CMPS, and the CMPS and the virtual smartcard (all described below). This can reduce the computational burden by reducing the number of keys which need to be generated.<br>
The apparatus preferably further comprises means for generating the encryption/authentication key in dependence on non-cryptographic data in a receiver/decoder. The non-cryptographic data is preferably unique to the receiver/decoder, or otherwise different to corcesponding non-cryptographic data elsewhere. Preferably also the non-cryptographic data has a further use than to generate a cryptographic key, and is preferably stochastic in nature (that is, unpredictable to some<br>
extent).<br>
This can allow the faster generation of such an encryption/authentication key.<br>
This important feature is also provided independently. Accordingly, in a related aspect, there is provided apparatus for processing data, comprising means for generating a cryptographic key in dependence on non-cryptographic data in a receiver/decoder.<br>
Preferably the apparatus further comprises a random number generator, means for seeding the random number generator with the non-cryptographic data, and means for generating the key in dependence on the output of the random number generator. This can provide a useful way to generate a key using a known random number generator.     '<br>
The apparatus preferably further comprises means for measuring at least one property, which property i s at least one of random, unpredictable, time-varying and geographically-varying, and means for generating the key in dependence on the or each property. Preferably at least 3, 5, 10, 20 or 50 properties, preferably of a receiver/decoder, are measured. This can aid the randomness of the resulting key.<br>
In particular, the means for generating the key may be adapted to generate the key in dependence on at least one of aproperty of a bit stream received by the receiver/decoder, a property of the hardware environment within the receiver/decoder, a property of a software environment within the receiver/decoder, and a measurable property of the environment outside the receiver/decoder. Such properties could include, for example, a bit error rate (BER) of a tuner, a signal level, the number of accesses to a particular part of the receiver/decoder software, the output of a detuned radio frequency (RF) receiver, and so on.<br>
The means for generating the key may be adapted to generate the key before the key is required, and preferably in response to an initialisation or reinitialisation of the receiver/decoder (such as after a reboot, for example). Alternatively or additionally, the apparatus may further comprise means for generating the key in response to the<br>
invocation of a command to perform an operation which operation requires the provision of the key. These features, in combination or independently, can provide more flexibility in the generation of keys.<br>
The term "command" as used herein preferably connotes a physical manifestation of a software routine programmed to carry out a specified function, preferably in the form of electrical impulses in a memory or in a more permanent form, such as a recording of the routine on a suitable data carrier, for example. Preferably the manifestation of the routine is immediately executable by a processor, being stored as object code, for example. The term may also be extended to cover the actual invocation of such a routine, either in the form of a physically-embodied instruction to execute the routine, or as an actual signal such as a remote procedure call (RPC) - designed to cause the routine to execute.<br>
The apparatus may further comprise means for storing an encryption/authentication key, preferably a key as aforesaid. This can improve the efficiency of the system by avoiding Ihe need to recreate such a key. Furthermore, the apparatus may further comprise means for determining whether or not to store the key, for example if the key is deemed too valuable for the level of security which is available. This can improve the security of the system.<br>
The apparatus preferably further comprises means for storing in a respective plurality of locations data by which the key can be constituted. The cryptographic key may comprise more than just a cryptographic key value, and may, for example, comprise any of a master key, key generation algorithm and key diversifier (such as a session ID, for example). Also, the plurality of locations are preferably distinct and non-contiguous (at least in pari), and may be present in any number of devices, such as a broadcast centre, subscriber data centre, smartcard, receiver/decoder, and so on. Furthermore, the plurality of locations may comprise any of an EEPROM, RAM, flash RAM, hard disc and smartcard within a receiver/decoder. The data may advantageously also be stored at least in part in the apparatus itself, which can reduce the exposure of the data. Furthermore, by data by winch the key can be constituted in plurality of iocaions, rather than a single location, for example, the security of the system can be improved.<br><br>
This important feature is also provided independently. Accordingly, in a related aspect of the invention, there is provided apparatus for processing data, comprising means for storing in a respective plurality of locations data by which the key can be constituted.<br>
The apparatus may comprise means for dividing the key into a plurality of portions, and means for storing in a respective plurality of locations the plurality of portions. The means for dividing may be adapted to divide a sequence of data bits representing the cryptographic key into a plurality of portions each composed of a smaller number of data bits, and the means for storing the plurality of portions may be adapted to store the portions at different addresses in a particular storage medium. Preferably the portions are composed of a multiple of 1, 2, 4, 8, 16, 32 or more bits. Preferably at least two, and preferably all, of the portions have the same size.<br>
By creating smaller (and therefore harder to notice) portions with respect to the comparatively large size of keys, the key data can be more easily hidden from view.<br>
Consequently, the means for storing may be adapted to store at least in part in a receiver/decoder. This can simplify the storage and reduce the dependence on external storage sources.<br>
Preferably the apparatus comprises means for selecting the plurality of locations such that the plurality of locations are pseudorandomly distributed throughout the receiver/decoder. This can again assist in concealing the relevant key. Preferably also the means for storing is adapted to store in a plurality of physical devices, as noted above, with the same advantage.<br>
The apparatus may also comprise means for creating a region of substantially random numbers in which at least one of the plurality of locations is located. Since cryptographic keys can sometimes be identified by their apparent randomness, storing the key components in a region of substantially random values can more effectively hide the key.<br>
The apparatus preferably further comprises means for reading a plurality of key portions<br>
from a respective plurality of locations, and means for combining the key portions to form a cryptographic key. Preferably the means for combining the key portions is adapted to perform a reversible transformation on the plurality of key portions (such as a matrix inversion in the case of a linear algebraic transformation). This can facilitate the reproduction of stored cryptographic keys.<br>
In a related aspect, there is provided apparatus for processing data, comprising a processor and associated memory, the processor being adapted to emulate a smartcard so as to provide a virtual smartcard.<br>
Preferably the apparatus further comprises a virtual smartcard. The processor may also be adapted to perform a cryptographic operation, and the memory may be adapted to store cryptographic data.<br>
In a further related aspect, there is provided apparatus for processing data, comprising a processor and associated memory, the processor being adapted to interface with a virtual smartcard.<br>
The processor may be adapted to exchange cryptographic data with trie virtual smartcard, and may also or alternatively be adapted to determine the presence of a real smartcard equivalent to the virtual smartcard. Preferably the processor is further adapted to exchange ciyptographic data with the real equivalent of the smartcard.<br>
The processor may be further adapted to select a smartcard, and is preferably adapted to decode data using the selected smartcard, and select the smartcard in dependence on a characteristic of the data. Preferably the processor is further adapted to select one of a payload and encrypted data containing the payload, store the selected payload or encrypted data, and replace the stored encrypted data with the payload.<br>
In a related aspect of the invention there is also provided apparatus for processing data, comprising a processor and associated memory, the processor being adapted to select one of a payload and encrypted data containing the payload, store the selected payload or<br>
encrypted data, and replace the stored encrypted data with the payload.<br>
The processor may be adapted to select one of at least one control word and an Entitlement Control Message. Furthermore, the processor may be adapted to send the encrypted data to a smartcard, and receive from the smartcard either the payload contained in the encrypted data or a response indicating that the payload can not be decrypted. Preferably the processor is adapted to select the payload if it is available, and tire encrypted data containing the payload otherwise.<br>
The processor may be adapted to store or reproduce data, the payload being related to the data. The processor may be adapted to encapsulate an encrypted data object in a further encrypted data object, and furthermore may be adapted to encapsulate an Entitlement Control Message in a Content Management Message.<br>
Preferably the processor is adapted to encrypt the stored payload or encrypted data with an encryption key, and may be adapted to authenticate the stored payload or encrypted data with an authentication key. Also preferably the processor is adapted to encrypt communication between the apparatus and a smartcard with a communication encryption key, and may be adapted to authenticate communication between the apparatus and a smartcard with a communication authentication key.<br>
The processor may be adapted to establish at least one session, and associate with the or each session a respective session identifier. The processor is preferably adapted to utilise a master session key to generate an encryption/authentication key.<br>
In a related aspect, there is provided apparatus for processing data, comprising a processor and associated memory, the processor being adapted to store (preferably in the associated memory) a cryptographic key, and utilise a master session key to generate one of an encryption and authentication key for encrypting and authenticating the stored cryptographic key respectively.<br>
Preferably the processor is adapted to generate both the encryption key and authentication<br>
key from the master session key. More preferably the processor is adapted to diversify the master session key with the corresponding session identifier, and may be adapted to use the encryption/authentication key to encrypt/authenticate a further session.<br>
The processor is preferably adapted to generate the encryption/authentication key in dependence on non-cryptographic data in a receiver/decoder.<br>
In a further aspect of the invention, there is provided apparatus for processing data, comprising a processor and associated memory, the processor being adapted to generate a cryptographic key in dependence on non-cryptographic data in a receiver/decoder.<br>
The apparatus preferably further comprises a random number generator, the processor being adapted to seed the random number generator with the non-cryptographic data, and generate the key in dependence on the output of the random number generator.<br>
Preferably the apparatus further comprises a detector for measuring at least one property, which property is at least one of random, unpredictable, time-varying and geographically-varying, the processor being adapted to generate the key in dependence on the or each property. Furthermore, the processor may be adapted to generate the key in dependence on at least one of a property of a bit stream received by the receiver/decoder, a property of the hardware environment within the receiver/decoder, a property of a software environment within the receiver/decoder, and a measurable property of the environment outside the receiver/decoder.<br>
The processor may be adapted to generate the key before the key is required; alternatively or additionally, the processor may be adapted to generate the key in response to the invocation of a command to perform an operation which operation requires the provision<br>
of the key.<br>
The processor may be adapted to store an encryption/authentication key, and is preferably adapted to determine whether or not to store the key. The processor may further be adapted to store in a respective plurality of locations data by which the key can be<br>
constituted.<br>
In another aspect of the invention, there is provided apparatus for processing data, comprising a processor and associated memory, the processor being adapted to store in a respective plurality of locations data by which a cryptographic key value can be<br>
constituted.<br>
The processor is preferably adapted to divide the key into a plurality of portions, and store in a respective plurality of locations the plurality of portions. The processor is preferably further adapted to store at least in part in a receiver/decoder. Furthermore, the processor may be adapted to select the plurality of locations such that the plurality of locations are pseudorandomly distributed throughout the receiver/decoder.<br>
The processor is preferably adapted to store in a plurality of physical devices, and may be adapted to create a region of substantially random numbers in which at least one of the plurality of locations is located. The processor may further be adapted to read data from a respective plurality of locations, and combine the data to form a cryptographic key.<br>
In a yet further aspect of the invention, there is provided a receiver/decoder, comprising apparatus as aforesaid.<br>
In a further aspect of the invention, there is provided a conditional access system, comprising apparatus as aforesaid.<br>
In another aspect of the invention, there is provided a broadcast system comprising a broadcast centre and a receiver/decoder as aforesaid.<br>
In a yet further aspect of the invention, there is provided a broadcast system comprising apparatus as aforesaid.<br>
In another aspect of the invention, there is provided a method of processing data, comprising emulating a smartcard so as to provide a virtual smartcard.<br>
Preferably the method further comprises providing a virtual smartcard. The step of emulating a smartcard preferably comprises performing a cryptographic operation, and storing cryptographic data.<br>
In a further aspect of the invention, there is provided a method of processing data, comprising interfacing with a virtual smartcard.<br>
The method preferably comprises exchanging ciyptographic data with the virtual smartcard, and may also or alternatively comprise determining the presence of a real smartcard equivalent to the virtual smartcard. Preferably the method further comprises exchanging cryptographic data with the real equivalent of the smartcard.<br>
The method may further comprise selecting a smartcard, and preferably comprises decoding data using the selected smartcard, and selecting the smartcard in dependence on a characteristic of the data. Preferably the method further comprises selecting one of a payload and encrypted data containing the payload, storing the selected payload or encrypted data, and replacing the stored encrypted data with the payload.<br>
In a further aspect of the invention, there is provided a method of processing data, comprising selecting one of a payload and encrypted data containing the payload, storing the selected payload or encrypted data, and replacing the stored encrypted data with the<br>
payload.<br>
The step of selecting may comprise selecting one of at least one control word and an Entitlement Control Message. Furthermore, the method may further comprise sending (he encrypted data to a smartcard, and receiving from the smartcard either the payload contained in the enciypted data or a response indicating that the payload can not be decrypted. Preferably the method comprises selecting the payload if it is available, and the encrypted data containing the payload otherwise.<br>
The method may comprise storing or reproducing data, the payload being related to the<br>
clata. The method may further comprise encapsulating an encrypted data object in a further encrypted data object, which step may further comprise encapsulating an Entitlement Control Message in a Content Management Message.<br>
Preferably the method further comprises encrypting the stored payload or encrypted data with an encryption key, and may comprise authenticating the stored payload or encrypted data with an authentication key. Also preferably tire method comprises encrypting communication between an apparatus and a smartcard with a communication encryption key, and may comprise authenticating communication between the apparatus and a smartcard with a communication authentication key.<br>
The method may comprise establishing at least one session, and associating with the or each session a respective session identifier. The method preferably comprises utilising a master session key to generate an encryption/authentication key.<br>
In a related aspect, there is provided a method of processing data, comprising storing a cryptographic key, and utilising a master session key to generate one of an encryption and authentication key for encrypting and authenticating the stored cryptographic key<br>
respectively.<br>
Preferably the method comprises generating both the encryption key and authentication key from the master session key. More preferably the method may comprise diversifying the master session key with the corresponding session identifier, and may comprise using the enciypti on/authentication key to encrypt/authenticate a further session.<br>
The method preferably comprises generating the encryption/authentication key in dependence on non-cryptographic data in a receiver/decoder.<br>
In a yet further aspect of the invention, there is provided a method of generating a cryptographic key, comprising generating tire key in dependence on non-cryptographic data in a receiver/decoder.<br>
The method preferably further comprises seeding a random number generator with the non-cryptographic data, obtaining an output from the random number generator, and generating the key in dependence on the output of the random number generator.<br>
Preferably the method further comprises measuring at least one property, which property is at least one of random, unpredictable, time-varying and geographically-varying, the method further comprising generating the key in dependence on the or each property. Furthermore, the method may comprise generating the key in dependence on at least one of a property of a bit stream received by the receiver/decoder, a property of the hardware environment within the receiver/decoder, aproperty of a software environment within the receiver/decoder, and a measurable property of the environment outside the receiver/decoder.<br>
The method may comprise generating the key before the key is required; alternatively or additionally, the method may comprise generating the key in response to the invocation of a command to perform an operation which operation requires the provision of the key.<br>
The method may comprise storing an encryption/authentication key, and preferably further comprises determining whether or not to store the key. The method may further comprise storing in a respective plurality of locations data by which the key can be<br>
constituted.<br>
In a related aspect of the invention, there is provided a method of storing a cryptographic key value, comprising storing in a respective plurality of locations data by which the cryptographic key value can be constituted.<br>
The method preferably further comprises dividing the key into a plurality of portions, and storing in a respective plurality of locations the plurality of portions. The method preferably further comprises storing at least in part in a receiver/decoder. Furthermore, the method may comprise selecting the plurality of locations such that the plurality of locations are pseudorandomly distributed throughout the receiver/decoder.<br>
The method preferably further comprises storing in a plurality of physical devices, and may comprise creating a region of substantially random numbers in which at least one of the plurality of locations is located. The method may comprise reading data from a respective plurality of locations, and combining the data to form a cryptographic key.<br>
In a further aspect of the invention, there is provided a computer program product, adapted to perform a method as aforesaid.<br>
In a yet further aspect of the invention, there is provided a computer program product, comprising a virtual smartcard.<br>
In a further aspect of the invention, there is provided a computer program product, comprising means for emulating a smartcard so as to provide a virtual smartcard.<br>
The means for emulating a smartcard preferably comprises means for performing a cryptographic operation and means for storing cryptographic data.<br>
In another aspect of the invention, there is provided a computer program product, comprising a virtual smartcard manager.<br>
In a further aspect of the invention, there is provided a computer program product, comprising means for interfacing with a virtual smartcard.    .<br>
The computer program product preferably further comprises means for exchanging cryptographic data with the virtual smartcard, and may further comprise means for determining the presence of a real smartcard equivalent to the virtual smartcard. The computer program product may further comprise means for exchanging cryptographic data with the real equivalent of the smartcard.<br>
The computer program product preferably further comprises means for selecting a smartcard. The computerprogramproductmay further comprise means for decoding data using tire selected smartcard, the means for selecting a smartcard being adapted to select<br>
the smartcard in dependence on a characteristic of the data.<br>
Preferably the computer program product further comprises means for selecting one of a payload and encrypted data containing the payload, means for storing the selected payload or encrypted data, and means for replacing the stored encrypted data with the payload.<br>
In a yet further aspect of the invention, there is provided computer program product, comprising means for selecting one of a payload and encrypted data containing the payload, means for storing the selected payload or encrypted data, and means for replacing the stored encrypted data with the payload.<br>
The means for selecting may be adapted to select one of at least one control word and an Entitlement Control Message. The computer program product preferably further comprises means for sending the encrypted data to a smartcard, and means for receiving from the smartcard either the payload contained in the encrypted data or a response indicating that the payload can not be decrypted.<br>
Preferably the means for selecting one of a payload and the encrypted data is adapted to select the payload if it is available, and the encrypted data containing the payload otherwise. The computer program product may further comprise means for at least one of storing and reproducing data, the payload being related to the data.<br>
The computer program product preferably further comprises means for encapsulating an encrypted data object in a further encrypted data object, and preferably further comprises means for encapsulating an Entitlement Control Message in a Content Management<br>
Message.<br>
The computer program product preferably further comprises means for encrypting the stored payload or encrypted data with an encryption key, and may comprise means for authenticating the stored payload or encrypted data with an authentication key.<br>
The computer program product preferably also further comprises means for encrypting communication between an apparatus and a smartcard with a communication encryption key, and may comprise means for authenticating communication between the apparatus and a smartcard with a communication authentication key.<br>
Preferably the computer program product preferably further comprises means for establishing at least one session, and means for associating with the or each session a respective session identifier. Furthermore, the computer program product ma}' further comprise means for utilising a master session key to generate an encryption/authentication key.<br>
In a further aspect of the invention, there is provided a computer program product, comprising means for storing a cryptographic key, and means for diversifying a master session key to generate one of an encryption and authentication key for encrypting and authenticating the stored cryptographic key respectively.<br>
The means for utilising a master session key may be adapted to generate both the encryption key mid authentication key from the master session key. The means for utilising is preferably adapted to diversify the master session key with the corresponding session identifier. The computer program product preferably further comprises means for using the encryption/authentication key to encrypt/authenticate a further session, and may further comprise means for generating the enciyption/authentieation key in dependence on non-cryptographic data in a receiver/decoder.<br>
In another aspect of the invention, there is provided a computer program product, comprising means for generating a cryptographic key in dependence on non-cryptographic data in a receiver/decoder.<br>
The computer program product may further comprise a random number generator, means for seeding the random number generator with the non-cryptographic data, and means for generating the key in dependence on the output of the random number generator.<br>
Furthermore, the computer program product may further comprise means for measuring at least one property, which property is at least one of random, unpredictable, time-varying and geographically-varying, and means for generating the key in dependence on the or each property. In particular, the means for generating the key may be adapted to generate the key in dependence on at least one of a property of a bit stream received by the receiver/decoder, a property of the hardware environment within the receiver/decoder, a property of a software environment within the receiver/decoder, and a measurable property of the environment outside the receiver/decoder.<br>
The means for generating the key is preferably adapted to generate the key before the key is required, but alternatively or additionally the computer program product may further comprise means for generating the key in response to the invocation of a command to perform an operation which operation requires the provision of the key.<br>
The computer program product preferably further comprises means for storing an encryption/authentication key, and may comprise means for determining whether or not to store the key. Furthermore, the computer program product may further comprise means for storing in a respective plurality of locations data by which the key can be constituted.<br>
In a yet further aspect of the invention, there is provided computer program product, comprising means for storing in a respective plurality of locations data by which a cryptographic key value can be constituted.<br>
The computer program product preferably further comprises means for dividing the key into a plurality of portions, and means for storing in a respective plurality of locations the plurality of portions. The means for storing may be adapted to store at least in part in a receiver/decoder. Preferably the computer program product further comprises means for selecting the plurality of locations such that the plurality of locations are pseudorandomly distributed throughout the receiver/decoder.<br>
The means for storing is preferably adapted to store in a plurality of physical devices. The<br>
computer program product preferably further comprises means for creating a region of substantially random numbers in which at least one of the plurality of locations is located, and may comprise means for reading data from a respective plurality of locations, and means for combining the data to form a cryptographic key.<br>
In a further aspect of the invention, there is provided a computer readable medium, comprising a computer program product as aforesaid.<br>
In a yet further aspect of the invention, there is provided a signal, tangibly embodying a computer program product as aforesaid.<br>
In another aspect of the invention, there is provided a receiver/decoder containing or attached to a mass storage device, said receiver/decoder comprising means for selecting as a function of access rights, one of a conditional access data payload and encrypted conditional access data containing said conditional access data payload, means for storing on the mass storage device a scrambled content and the selected conditional access data payload or encrypted conditional access data.<br>
Preferably said conditional access data payload is at least one control word and said encrypted conditional access data is at least one Entitlement Control Message. Further preferably the receiver/decoder is characterised in that said at least one control word is produced by a smartcard from an Entitlement Control Message.<br>
The terms "scrambled" and "encrypted" and "control word" and "key" have been used here in a number of ways for the purpose of clarity of language. However, it will be understood that no fundamental distinction is to be made between "scrambled data" and "encrypted data" or between a "control word" and a "key".<br>
The invention also provides a computer program and a computer program product for carrying out any of the methods described herein and/or for embodying any of the apparatus features described herein, and a computer readable medium having stored thereon a program for carrying out any of the methods described herein and/or for<br>
embodying any of the apparatus features described herein.<br>
The invention also provides a signal embodying a computer program for carrying out any of the methods described herein and/or for embodying any of the apparatus features described herein, a method of transmitting such a signal, and a computer product having an operating system which supports a computer program for carrying out any of the methods described herein and/or for embodying any of the apparatus features described herein.<br>
The invention extends to methods and/or apparatus substantially as herein described with reference to the accompanying drawings.<br>
Any feature in one aspect of the invention may be applied to other aspects of the invention, in any appropriate combination. In particular, method aspects may be applied to apparatus aspects, and vice versa.<br>
Furthermore, features implemented in hardware may generally be implemented in software, and vice versa. Any reference to software and hardware features herein should be construed accordingly.<br>
Preferred features of the present invention -will now be described, purely by way of example, with reference to the accompanying drawings, in which:-<br>
Figuie 1 is an overview of a satellite digital television system; Figure 2 is an overview of a cable digital television system; Figure 3 is an overall system view, with the head-end shown in more detail; Figure 4 is a schematic of the component architecture of the receiver/decoder; Figure 5 is a diagram of the software architecture of the receiver/decoder; Figure 6 is a diagram showing the top half of Figure 5 in more detail; Figure 7 is a diagram showing the bottom half of Figure 5 in more detail; Figure S is a diagram showing an alternative embodiment of the bottom half of Figure 5;<br>
Figure 9 is an overview of a content management and protection system;<br>
Figure 10 is an overview of a distribution system using the content management and protection system;<br>
Figure 11 is a schematic of an implementation of the content management and protection system in a receiver/decoder, arranged to record data;<br>
Figure 12 is a schematic of the implementation of the content management and protection system in a receiver/decoder, arranged to play back data;<br>
Fi gure 13 is an illustration of the recording of data using the content management and protection system;<br>
Figure 14 is an illustration of the playing back of data using the content management and protection system;<br>
Figure 15 is an illustration of the relationship between the content management and protection system and a hard disk video recorder;<br>
Figure ] 6 is a schematic in more detail of the content management and protection system;<br>
Figure 17 is an illustration of the flow of commands between different components of the content management and protection system;<br>
Figure 18 is a further illustration of the flow of commands between different components of the content management and protection system;<br>
Figure 19 is a schematic of a system for generating an encryption key using a random number generator;<br>
Figure 20 is a schematic of a system for generating an encryption key using a key diversifier;<br>
Figure 21 is a schematic of a system for storing and retrieving encryption keys;<br>
Figure 22 is an illustration of the process of storing an encryption key in accordance with the above system;<br>
Figure 23 is a further illustration of the process of storing an encryption key; and<br>
Figure 24 is an illustration of the encapsulation of an Entitlement Control Message (ECM) in a Content Management Message (CMM).<br>
System overview<br>
An overview of a digital television system 500 is shown in Figure 1. As will be discussed below, the system 500 comprises a broadcast centre 1000, a receiver/decoder 2000, a software/hardware architecture 3000 of the receiver/decoder, an interactive system 4000, and a conditional access system 5000, as will all be discussed below.<br>
The system 500 includes a mostly conventional digital television system 502 that uses the known MPEG-2 compression system to transmit compressed digital signals. In more detail, MPEG-2 compressor 1010 in a broadcast centre 1000 receives a digital signal stream (typically a stream of video signals). The compressor 1010 is connected by linkage 1020 to a multiplexer and scrambler 1030.<br>
The multiplexer 103 0 receives a plurality of further input signals, assembles the transport stream and transmits compressed digital signals to a transmitter 510 of the broadcast centre via linkage 1022, which can of course take a wide variety of forms including telecommunications links. The transmitter 510 transmits electromagnetic signals via uplinls: 514 towards a satellite transponder 520, where they are electronically processed and broadcast via notional downlink 516 to earth receiver 512, conventionally in the form of a dish owned or rented by the end user. Other transport channels for transmission of the data are of course possible, such as terrestrial broadcast, cable transmission, combined satellite/cable links, telephone networks etc.<br>
The signals received by receiver 512 are transmitted to an integrated receiver/decoder 2000 owned or rented by the end user and connected to the end user's television set 10000. The receiver/decoder 2000 decodes the compressed MPEG-2 signal into a television signal for the television set 10000. Although a separate receiver/decoder is shown in Figure 1, the receiver/decoder may also be part of an integrated digital television. As used herein, the term "receiver/decoder" includes a separate receiver/decoder, such as a set-top box, and a television having a receiver/decoder integrated therewith.<br>
In the receiver/decoder 2000 a hard disk 2100 is provided, on which audiovisual and other<br>
data can be stored. This allows advanced recording and playback facilities for programmes received by the receiver/decoder, and also allows large amounts of other types of data, such as electronic programme guide data, to be stored in the receiver/decoder.<br>
A content management and protection system (CMPS) 2300 (not shown) in the receiver/decoder provides the ability securely and flexibly to control the recording and playback of data on the hard disk 2100 (or other storage device).<br>
In a multichannel system, the multiplexer 1030 handles audio and video information received from a number of parallel sources and interacts with the transmitter 510 to broadcast the information along a corresponding number of channels. In addition to audiovisual information, messages or applications or any other sort of digital data may be introduced in some or all of these channels interlaced with the transmitted digital audio and video information.<br>
An interactive system 4000 is connected to the multiplexer 1030 and the receiver/decoder 2000, and is located partly in the broadcast centre and partly in the receiver/decoder. It enables the end user to interact with various applications via a back channel 570. The back channel may be, for example a Public Switched Telephone Network (PSTN) channel (for example, a modemmed back channel) or an Out of Band (OOB) channel.<br>
A conditional access system 5000, also connected to the multiplexer 1030 and the receiver/decoder 2000 and again located partly in the broadcast centre and partly in the receiver/decoder, enables the end user to access digital television broadcasts from one or more broadcast suppliers. A smartcard, capable of deciphering messages relating to commercial offers (that is, one or several television programmes sold by the broadcast supplier), can be inserted into the receiver/decoder 2000. Using the receiver/decoder 2000 and smartcard, the end user may purchase commercial offers in either a subscription mode or a pay-per-view mode. Typically this is achieved using the back channel 570 which is used by the interactive system 4000,<br>
As mentioned above, programmes transmitted by the system are scrambled at the multiplexer 1030, the conditions and encryption keys applied to a given transmission being determined by the access control system 5000. Transmission of scrambled data in this way is well blown in the field of pay TV systems. Typically, scrambled data is transmitted together with a control word for descrambling of the data, the control word itself being encrypted by a so-called exploitation key and transmitted in encrypted form.<br>
The scrambled data and enciypted control word are then received by the receiver/decoder 2000 having access to an equivalent to the exploitation key stored on a smartcard inserted in the receiver/decoder to deciypt the enciypted control word and thereafter descramble the transmitted data. A paid-up subscriber will receive, for example, in a broadcast monthly EMM (Entitlement Management Message) the exploitation key necessary to decrypt the enciypted control word so as to permit viewing of the transmission.<br>
Figure 2 illustrates an alternative embodiment of a digital television system 504, utilising a cable network as the broadcast medium for the compressed digital signals. In this figure, like parts are indicated with like numerals.<br>
The satellite transponder and transmitting and receiving stations are replaced by a cable network 550. Additionally, in this particular embodiment, the modemmed back channel between the receiver/decoder 2000 and the interactive system 4000 and conditional access system 5000 is removed, replaced by linkages 554, 556 between the cable network 550 and the conditional access system 5000 and interactive system 4000 respectively. The receiver/decoder 2000 thus communicates with the other systems via the cable network 550, utilising a cable modem or other means to allow it to send and receive data via the same link as it receives data from the broadcast centre.<br>
The cable network 550 may be any form of wide area network (WAN), such as a dedicated connection, the internet, local cable distribution network, wireless connection, or any combination of the above. In the present embodiment, the hybrid fibre coax (HFC) network is used. It is appreciated that the various means of communication between the receiver/decoder 2000 and the other components of the television system are<br>
interchangeable.<br>
Conditional access system<br>
With reference to Figure 3, in overview the conditional access system 5000 includes a Subscriber Authorization System (SAS) 5200. The SAS 5200 is connected to one or more Subscriber Management Systems (SMS) 1100, one SMS for each broadcast supplier, by a link 1044, which may be a TCP-IP link or other type of link. Alternatively, one SMS could be shared between two commercial operators, or one operator could use two SMSs, and so on.<br>
First encrypting units in the form of ciphering units 5100 utilising "mother" smartcards 5110 are connected to the SAS by linkage 1042. Second encrypting units again in the form of ciphering units 5102 utilising mother smartcards 5112 are connected to the multiplexer 1030 by linkage 1040. The receiver/decoder 2000 receives a "daughter" smartcard 5500. The receiver/decoder is connected directly to the SAS 5200 via communications servers 1200 and the modemmed back channel 570. The SAS sends amongst other things subscription rights to the daughter smartcard on request.<br>
In valiants of the preferred embodiment, internet or cable connections either complement or replace the PSTN 570 and communications servers 1200.<br>
The smartcards contain confidential information from one or more commercial operators. The "mother" smartcard enciypts different kinds of messages and the "daughter" smartcards decrypt the messages, if they have the rights to do so.<br>
With reference to Figure 3, in the broadcast centre, the digital video signal is first compressed (or bit rate reduced), using the MPEG-2 compressor 1010. This compressed signal is then transmitted to the multiplexer and scrambler 1030 in order to be multiplexed with other data, such as other compressed data.<br>
The scrambler generates a control word used in the scrambling process and included in the MPEG-2 stream in the multiplexer 1030. The control word is generated internally<br><br>
and enables the end user's integrated receiver/decoder 2000 to descramble the programme.<br>
Access criteria, indicating how the programme is commercialised, are also added to the MPEG-2 stream. The programme may be commercialised in either one of a number of "subscription" modes and/or one of a number of "Pay Per View" (PPV) modes or events. In the subscription mode, the end user subscribes to one or more commercial offers, or "bouquets", thus getting the rights to watch every channel inside those bouquets. In the Pay Per View mode, the end user is provided with the capability to purchase events as he wishes.<br>
Both the control word and the access criteria are used to build an Entitlement Control Message (ECM); this is a message sent in relation with one scrambled program; the message contains a control word (which allows for the descrambling of the program) and the access criteria of the broadcast program. The access criteria and control word are transmitted to the second encrypting unit 5102 via the linkage 1040. In this unit, an ECM is generated, encrypted and transmitted on to the multiplexer and scrambler 1030.<br>
Each service broadcast by a broadcast supplier in a data stream comprises a number of distinct components; for example a television programme includes a video component, an audio component, a sub-title component and so on. Each of these components of a service is individually scrambled and encrypted for subsequent broadcast. In respect of each scrambled component of the service, a separate ECM is required.<br>
The multiplexer 1030 receives electrical signals comprising encrypted EMMs from the SAS 5200, encrypted ECMs from the second encrypting unit 5102 and compressed programmes from the compressor 1010. The multiplexer 1030 scrambles the programmes and transmits the scrambled programmes, the enciypted EMMs and the encrypted ECMs as electric signals to broadcast system 600, which may be for example a satellite system as shown in Figure 1, or other broadcast system. The receiver/decoder 2000 demultiplexes the signals to obtain scrambled programmes with enciypted EMMs and enciypted ECMs.<br>
Tbe receiver/decoder receives the broadcast signal and extracts the MPEG-2 data stream. Tf a programme is scrambled, the receiver/decoder 2000 extracts the corresponding ECM from the MPEG-2 stream and passes the ECM to the "daughter" smartcard 5500 of the end user. This slots into a housing in the receiver/decoder 2000. The daughter smartcard 5500 controls whether the end user has the right to decrypt the ECM and to access the programme. If not, a negative status is passed to the receiver/decoder 2000 to indicate that the programme cannot be descrambled. If the end user does have the rights, the ECM is decrypted and the control word extracted. The decoder 2000 can then descramble the programme using this control word. The MPEG-2 stream is decompressed and translated into a video signal for onward transmission to television set 10000.<br>
Tf the programme is not scrambled, no ECM will have been transmitted with the MPEG-2 stream and the receiver/decoder 2000 decompresses the data and transforms the signal into a video signal for transmission to television set 10000.<br>
The subscriber management system (SMS) 1100 includes a database 1150 which manages, amongst others, all of the end user files, commercial offers (such as tariffs and promotions), subscriptions, PPV details, and data regarding end user consumption and authorization. The SMS may be physically remote from the SAS.<br>
The SMS 1100 transmits messages to the SAS 5200 which imply modifications to or creations of Entitlement Management Messages (EMMs) to be transmitted to end users. The SMS 1100 also transmits messages to the SAS 5200 which imply no modifications or creations of EMMs but imply only a change in an end user's state (relating to the authorization granted to the end user when ordering products or to the amount that the end user will be charged). The SAS 5200 also sends messages (typically requesting information such as call-back information or billing information) to the SMS 1100, so that it will be apparent that communication between the two is two-way.<br>
Receiver/decoder<br>
Referring to Figure 4, the various elements of receiver/decoder 2000 will now be described in terms of functional blocks.<br>
The receiver/decoder 2000, which may be, for example, a digital set-top box (DSTB), comprises a central host processor 2002 and a digital TV coprocessor 2004, both having associated memory elements (not shown) and joined by a coprocessor bus 2006. The coprocessor 2004 is adapted to receive input data from a USB interface 2070, a serial interface 2072, a parallel interface (not shown), a modem 2074 (connected to the modem back channel 570 of Fig. 1), and switch contacts on the front panel 2054 of the decoder.<br>
The receiver/decoder is additionally adapted to receive inputs from an infra-red remote control 2080 (and optionally from other wireless peripherals 2082 such as Bluetooth-enabled devices) and also possesses two smartcard readers 2050,2052 adapted to read bank and subscription smartcards 2060, 2062 respectively. The subscription smartcard reader 2052 engages with an inserted subscription card 2062 and with a conditional access unit (not shown) to supply the necessary control word to a demultiplexer/descrambler/remultiplexer unit 2010 to enable the encrypted broadcast signal to be descrambled. The decoder also includes a conventional tuner 2016 and demodulator 2012 to receive and demodulate the satellite transmission before being filtered and demultiplexed by the demodulator/descrambler unit 2010. A second tuner 2018 and second demodulator 2014 are also provided, to allow, amongst other things, a second channel to be received and decoded in parallel with the first.<br>
A hard disk 2100 is also provided, allowing storage of programme and application data received and generated by the receiver/decoder. In conjunction with the two tuners 2016, 2018, two demodulators 2012,2014, the descrambler/demultiplexer/remultiplexer 2010, and the data decoder 2024 and audio decoder 2026, advanced recording and playback features are provided, allowing simultaneous recordings of one or more programmes while a further programme is being viewed, and more general transfers to and from the hard disk to and from the display devices and/or inputs and outputs, all occurring in parallel.<br>
The audio output 203 8 and video output 2040 in the receiver/decoder are fed by the PCM mixer 2030 and audio DAC 2034, and the MPEG video decoder 2028, graphic engine 2032 and PAL/SECAM encoder 2036 respectively.   Alternative or complementary<br>
outputs may of course be provided.<br>
As used in this description, an application is preferably a piece of computer code for controlling high level functions of preferably the receiver/decoder 2000. For example, when the end user positions the focus of remote control 2080 on a button object seen on the screen of the television set (not shown) and presses a validation key, the instruction sequence associated with the button is run. Applications and the associated middleware are executed by the host processor 2002, with remote procedure calls (RPCs) being made to the digital TV coprocessor 2004 across the coprocessor bus 2006 as and when required.<br>
An interactive application proposes menus and executes commands at the request of the end user and provides data related to the puipose of the application. Applications may be either resident applications, that is, stored in the ROM (or FLASH or other non-volatile memory) of the receiver/decoder 2000, or broadcast and downloaded into the RAM, FLASH memory or hard disk of the receiver/decoder 2000.<br>
Applications are stored in memory locations in the receiver/decoder 2000 and represented as resource files. The resource files comprise graphic object description unit files, variables block unit files, instruction sequence files, application files and data files.<br>
The receiver/decoder contains memory (not shown) divided into at least one RAM volume, a FLASH volume and at least one ROM volume, but this physical organization is distinct from the logical organization. The memory may further be divided into memory volumes associated with the various interfaces. From one point of view, the memory can be regarded as part of the hardware; from another point of view, the memoiy can be regarded as supporting or containing the whole of the system shown apart from the hardware.<br>
Architecture of receiver/decoder<br>
With reference to Figure 5, the software/hardware architecture 3000 of the receiver/decoder contains five software layers, organized so that the software can be implemented in any receiver/decoder and with any operating system.   The various<br>
software layers are application layer 3100, application programming interface (API) layer 3300. virtual machine layer 3500, device interface layer 3700 (often abbreviated just to 'device layer) and system software/hardware layer 3900.<br>
The application layer 3100 encompasses applications 3120 that are either resident in or downloaded to the receiver/decoder. They may be interactive applications used by customers, written in, for example, Java, HTML, MHEG-5 or other languages, or they may be applications used by the receiver/decoder for other purposes, for example for running such interactive applications. This layer is based on a set of open Application Programming Interfaces (APIs) provided by the Virtual Machine layer. This system allows applications to be downloaded to the hard disk, flash memory or RAM memory in the receiver/decoder on-the-fly or on demand. The application code can be transmitted in compressed or uncompressed format using protocols such as Data Storage Media Command and Control (DSMCC), Network File Server (NFS) or other protocols.<br>
The API layer 3300 provides high-level utilities for interactive application development. It includes several packages that make up this high-level API. The packages provide all the functionality necessary to run interactive applications. The packages are accessible by the applications.<br>
In a preferred embodiment the API is adapted for applications written in the Java, PanTalk or such similar programming languages. Furthermore, it can facilitate the interpretation of HTML and other formats, such as MHEG-5. Besides these features, it also includes other packages and service modules that are detachable and extensible as requirements dictate.<br>
The virtual machine layer 3 500 is composed of language interpreters and various modules and systems. This layer, managed by a kernel 3650 (not shown), consists of everything necessary to receive and execute interactive applications in the receiver/decoder.<br>
The device interface layer 3700 includes a Device Manager and software devices (generally referred to herein as just 'devices'). Devices are software modules which<br>
consist of the logical resources necessary for management of external events and physical interfaces. The device interface layer, under the control of the Device Manager, manages communication channels between drivers and applications and provides enhanced error exception checking. Some examples of managed (hardware) devices are: card readers 3722 (not shown), modems 3730 (not shown), network 3732 (not shown), PCMCIA (Personal Computer Memory Card International Association), LED display and so on. Programmers do not have to deal with this layer directly, since the API layer controls the devices from above.<br>
The system software/hardware layer 3900 is provided by the manufacturer of the receiver/decoder. Because of the modularity of the system and because services supplied by the higher-level operating system (such as event scheduling and memory management) are part of the virtual machine and kernel, the higher layers are not tied to a particular real-time operating system (RTOS) or to a particular processor.<br>
Typically the virtual machine layer 3500, occasionally in combination with the device interface layer 3700 and/or API 3300, is referred to as the 'middleware' of the receiver/decoder.<br>
With reference to Figure 6 the software architecture of the receiver/decoder 3000 corresponding to the top half of Figure 5 (comprising the application layer 3100, API layer 3300 and virtual machine layer 3500) will now be described in more detail.<br>
1 nteractive applications are applications that the user interacts with, for example, to obtain products and services, such as electronic program guides, telebanking applications and<br>
games.<br>
There are two types of application in the application layer 3100,- plus the Application Manager 3110. There are interactive applications such as a Web Browser 3130 which can be added at any time as long as they conform to the API 3300, and there are resident applications which manage and support the interactive applications. The resident applications are substantially permanent and include the following:<br>
Boot. The Boot application 3142 is the first application launched when the receiver/decoder is powered on. The Boot application first starts the Application Manager 3110, and then starts the "Manager" software modules in the virtual machine 3500, such as the Memory Manager 3544 and the Event Manager 3546.<br>
Application Manager. The Application Manager 3110 manages the interactive applications that are run in the receiver/decoder, that is, it starts, stops, suspends, resumes, handles events and deals with communication between applications. It allows multiple applications to run at once, and thus is involved in the allocation of resources among them. This application is completely transparent to the user.<br>
SetUp. The purpose of the SetUp application 3144 is to configure the receiver/decoder, primarily the first time it is used. It performs actions such as scanning for TV channels, setting the date and time, establishing user preferences, and so on. However, the SetUp application can be used at any time by the user to change the receiver/decoder configuration.<br>
Zapping. The Zapping application 3146 is used to change channels using the Program-up, Program-down and numeric keys. When another form of zapping is used, for example, through a banner (pilot) application, the Zapping application is stopped.<br>
Callback. The Callback application 3148 is used to extract the values of various parameters stored in the receiver/decoder memory and return these values to the commercial operator via modemmed back channel 1070 (not shown), or by other means.<br>
Other applications in the application layer 3100 include a program guide application 3132, a pay-per-view application 3134, a banner (pilot) application 313 6, a home banking application 3138, a software download application 3140 add a PVR (personal video recorder) application 3154 (see below).<br>
As noted above, the Application Programming Interface (API) layer 3300 contains several packages. These include basic system packages 3310, used, for example, to access basic features of the virtual machine, DAVIC packages 3320, and proprietary packages 3330, used to access features of the software architecture unique to the principal software vendor.<br>
Considered in more detail, the virtual machine 3500 includes the following:<br>
Language Interpreters 3510. Different interpreters can be installed to conform<br>
to the type of applications to be read. These include Java interpreters 3512, PanTalk<br>
interpreters 3514, HTML interpreters 3516, MHEG-5 interpreters 3518 and others.<br>
Service Information (SI) Engine.   The SI Engine 3540 loads and monitors<br>
common Digital Video Broadcasting (DVB) or Program System Information Protocol<br>
(PSIP) tables and puts them into a cache. It allows access to these tables by applications<br>
which need the data contained in them.<br>
Scheduler 3542. This module allows for pre-emptive, multithreaded scheduling<br>
with each thread having its own event queue.<br>
	Memory Manager 3544. This module manages the access to memory. It also<br>
automatically compresses data in memory when necessary and performs automatic<br>
garbage collection.<br>
Event Manager 3546. This module allows events to be triggered according to priority. It manages timer and event grabbing and allows applications to send events to each other.<br>
Dynamic Linker 3548. This module allows the resolution of addresses arising from native Java functions, loads native methods from a Java class downloaded into RAM and resolves calls from downloaded native codes towards ROM.<br>
Graphics System 3550. This system is object-orientated and optimized. It includes graphic window and object management as well as a vectorial font engine with mult^-language support.<br>
	Class Manager 3552. This module loads classes and resolves any class<br>
referencing problems.<br>
File System 3554. This module is compact and optimized to manage a hierarchical file system with multiple ROM, flash, RAM and DSMCC volumes. Flash integrity is guaranteed against any incidents.<br>
Security Manager 3556. This module authenticates applications and controls the access of applications to sensitive memory and other zones of the set-top box.<br>
Downloader 3558. This module uses automatic data loading from a remote DSMCC carousel or through the NFS protocol, with downloaded files accessed in the same way as resident ones. Memory clear-up, compression and authentication are also<br>
provided.<br>
Furthermore, the DA VIC resource notification model is supported so that client resources are efficiently managed.<br>
A kernel 3650 manages the various different processes running in the virtual machine 3500 and device interface layer 3700 (not shown). For efficiency and reliability reasons, lhe kernel implements relevant parts of the POSIX standard for operating systems.<br>
Under control of the kernel, the virtual machine (running Java and Pantalk applications) runs in its own thread, separate to other 'server' elements of the operating system, such as the mass storage server 3850 (not shown). Corresponding provisions, such as requiring Thread IDs to be passed as parameters in system calls, are also made in the API layer 3300 to allow the applications 3120 to benefit from the multithreaded environment.<br>
By providing multiple threads, more stability can be achieved. For example, if the virtual machine 3500 ceases to operate for some reason, by suffering a crash or being blocked for a long time by an application tying to access a device, other time-critical parts of the system, such as the hard disk server, can continue to operate.<br>
As well as the virtual machine 3500 and kernel 3650, a hard disk video recorder (HDVR) module 3850 is provided for handling the recording and playback functions of the hard disk 2210 or other attached mass storage component. The server comprises two separate threads 3854.3856 handling recording, one thread 3 85 8 for handling playback, and a file system library 3852 for interfacing with the mass storage components.<br>
An appropriate one of the threads 3854, 3856, 3858 in the hard disk video recorder (HDVR) 3850 receives commands (such as a command to start recording a particular programme) from clients such as the personal video recorder (PVR) application 3154, in response to the user pressing a 'record' button, for example.<br>
In turn, the thread in question then interacts with the service device 3736 (shown in<br>
Figure 7) to set up and synchronise the parts of the receiver/decoder handling the bitstream to be recorded or played back. In parallel, the thread also interacts with the file system library 3852 to coordinate the recording or playback operation at appropriate places on the hard disk 2210 (not shown).<br>
The file system library 3852 then sends commands to the mass storage device 3728 (also shown in Figure 7) which tell the mass storage device 3728 which sub-transport stream (STS) to transfer (via a FIFO buffer), and on which hard disk target the stream should be stored. Allocation of clusters on the hard disk and general file management is carried out by the file system library 3 852, the mass storage device itself being concerned with lower level operations.<br>
The service device 3736 mentioned above is unique amongst the devices in that it does not relate to a physical component of the receiver/decoder. It instead provides a high level interface which groups together in a single 'instance' the various sets of tuner, demultiplexer, remultiplexer and hard disk devices in the receiver/decoder, freeing higher level processes from the difficulties of coordinating the various sub-devices.<br>
Willi reference to Figure 7 the software architecture of the receiver/decoder 3000 corresponding to the bottom half of Figure 5 (comprising the device interface layer 3700 and the system software and hardware layer 3900) will now be described in more detail.<br>
Further devices provided in the device layer include the conditional access device 3720, tuner devices 3724 corresponding to the two (or potentially more) tuners 2016, 2018 of Figure 4, the video device 3734, the I/O port device 3726, and the service device 3736 and mass storage device 3728 mentioned above.<br>
In broad terms, a device can be regarded as defining a logical interface, so that two different devices may be coupled to a common physical port. Certain devices may communicate among themselves, and all devices also operate under the control of the<br>
kernel 3650.<br>
Before using the services of any device, a program (such as an application instruction sequence) has to be declared as a "client", that is, a logical access-way to the device or the device manager 3710. The manager gives the client a client number winch is referred to in all accesses to the device. A device can have several clients, the number of clients for each device being specified depending on the type of device. A client is introduced to the device by a procedure "Device: Open Channel". This procedure assigns a client number lo the client. A client can be taken out of the device manager 3710 client list by a procedure "Device: Close Channel".<br>
The access to devices provided by the device manager 3710 can be either synchronous or asynchronous. For synchronous access, a procedure "Device: Call" is used. This is a means of accessing data which is immediately available or a functionality which does not involve waiting for the desired response. For asynchronous access, a procedure "Device: I/O" is used. This is a means of accessing data which involves waiting for a response, for example scanning tuner frequencies to find a multiplex or getting back a table from the MPEG stream. When the requested result is available, an event is put in the queue of the engine to signal its arrival. A further procedure "Device: Event" provides a means of managing unexpected events.<br>
In a second embodiment of the receiver/decoder, the lower half of the architecture of the receiver/decoder is replaced by the layers shown in Figure 8.<br>
Jn this embodiment, an extended device layer interface (EDLI) 3600 is provided between the virtual machine 3500 (not shown) and the device interface layer 3700, and an abstraction device interface 3800 is provided between the device interface layer 3700 and the system software/hardware layer 3900. Otherwise, like parts are indicated with like reference numerals.<br>
The extended device layer interface (EDLI) 3600 provides a dedicated interface between the virtual machine 3500 and the device interface layer 3700 and generally provides multithreading support to the device interface layer. Functions of the EDLI include routing asynchronous events to the appropriate thread in the middleware (since the device<br>
interface layer need not itself support multithreading) and routing messages between threads.<br>
The abstraction device interface 3800 provides a further interface between the device interface layer 3700 and the device drivers 3910 in the system software/hardware layer 3900. By providing such an interface, the large and complex device layer 3700 can be made hardware independent to a greater degree.<br>
Content management and protection system (CMPS)<br>
With reference to Figure 9, the content management and protection system (CMPS) 23 00 mentioned above is distributed between the broadcast centre 1000 and the receiver/decoder 2000. The receiver/decoder component of the CMPS is provided in the form of a physical smartcard (with an associated smartcard reader) and a virtual smartcard, both under the control of a virtual smartcard manager (as will be described in more detail later), but in variants of the preferred embodiment the receiver/decoder component of the CMPS is implemented solely in software or in hardware, or further permutations of both. The CMPS can ensure that only authorized users can record and playback content, in accordance with predefined usage rules. It may further ensure that other rules defined by the content owner and/or distributor are adhered to, such as copy control and time-shifting constraints.<br>
An important part of the content management and protection system is the special Usage Rules Message (URM) which contains content management information relating to given content (such as a programme or transmission) and is transmitted before such a programme or transmission. In essence, the Usage Rules Messages impose usage constraints on the playback and reproduction of the content, and can be directed only to specific portions of the content, such as separate 'chapters' within a programme, or to the content as a whole. Typical usage rules include restrictions on time-shifting, fast-forwarding, number of times a recording can be pla)'ed back, and available reproduction modes Another important feature, which will be described in more detail below, is that URMs relating to a given programme may be sent independently (from different locations and at different times) from the corresponding content or conditional<br>
access reformation.<br>
A second class of message, the CMPS Entitlement Management Message (CMPS EMM, or CMP_EMM), is provided to transmit access rights to the CMPS. The CMPS EMM is equivalent to the conditional access entitlement management message (EMM, or CAS_EMM) referred to elsewhere, but the transmitted access rights relate to the local storage of programme data rather than broadcast programme data, as with the 'conventional' EMM.<br>
ha the preferred embodiment, shown in Figure 9, the multiplexer and scrambler 1030 receives the CMPS EMMs 5614 and URMs 5612, multiplexes them with the bitstream containing the unscrambled content (programme data) 810 and broadcasts the resulting scrambled content 800 viathe broadcast system 600. The receiver/decoder then receives the scrambled content 800, and removes and passes the CMPS EMMs and URJVIs to the CMPS 2300 and conditional access system 5000 if necessary. In the preferred embodiment, however, the CMPS EMMs and URMs are dealt with internally by the CMPS.<br>
The URMs are encrypted with a URM exploitation key, which in a variant of the preferred embodiment is the same as the ECM exploitation key. An equivalent of the URM exploitation key is maintained in the receiver/decoder CMPS smartcard (not shown) to allow the URMs to be decrypted. In a further variant, the URMs are not encrypted, but cryptographically signed to ensure data integrity. In yet another variant, values contained within the URMs are used as a seeding value to derive, potentially in combination with other information, a cryptographic key. Certain encrypted units such as the CMPEMMs can be encrypted by such a key (or a derivation thereof), meaning that any tampering with the URM will prevent the decryption of the CMP_EMMs, for example.<br>
As mentioned above, usage rights which allow a user to record and/or playback using the receiver/decoder are provided in the form of CMPS Entitlement Management Messages (CMPS EMM or CMP_EMM); CMPS EMMs can have the same structure as<br>
conventional EMMs, but are generally more key-oriented - a CMPJEMM typically embeds a key associated with a content or service. Rights to playback recorded content in general depend on the commercial rules encoded in the URMs and also on the already acquired usage rights. Such rights can be granted in return for one-off payments (impulse purchases) or subscriptions, for example. Various levels of access rights can also be granted in relation to any content, whereby a user could, for example, pay a first fee in exchange for the rights to replay content once, or pay a second, higher, fee in return for unlimited replays. CMP_EMMs are typically stored in the receiver/decoder CMPS smartcard, but may be stored elsewhere, such as in securely encrypted areas on a hard disk, for example.<br>
In the preferred embodiment, rights to replay a recording can either be obtained after the recording is made (the 'pay-per-view' model), or prior to the recording (the 'subscription' model). In the former case, after recording the content, the user instructs the conditional access system that he wishes to obtain the rights to playback the content. If the instruction is authorised by the subscription management system, the appropriate CMPS Entitlement Management Message ("CMP_EMM") is then transmitted to the receiver/decoder via the bidirectional link.<br>
One of the many advantages provided by the CMPS system is that the access rights for recording and playing back programmes are entirely independent of the access rights for simply viewing the programmes, as in conventional systems. Thus, one could have the situation where one could view a programme but not record it and play it back, and conversely one could be unable to view a programme, but one could record it, obtain the necessary rights and then play it back.<br>
In a variant of the preferred embodiment particularly typical of an internet distribution model shown in Figure 10, the scrambled content ("CONTENT*"), CMPS EMM ("CMPJEMM") and URMs ("URM") are all delivered independently to a receiver/decoder 2000, from a first party 700, second party 702 and third party 704. The first, second or third' party may be, for example, a mum' access portal (MAP), and the scrambled content 800, CMPS EMMs 5614 and URMs 5612 may each be delivered via<br>
the broadcast steam, other broadband connection or dial-up connection, for example. Typically, a programme provider (the second party 1202) sends programme content ("CONTENT") to the multiplexer/scrambler, where the scrambled content 1300 (CONTENT*) is generated and then transmitted to the receiver/decoder 2000 in the usual fashion. The independence of information delivery illustrated above and in the preferred embodiment reflects the fact that the various roles of content distribution, commercial offer presentation and usage rights delivery are often played by different actors.<br>
With reference to Figures 11 and 12, the implementation at the receiver/decoder 2000 of recording and playing back content respectively using the CMPS 2300 will now be described.<br>
In Figure 11, which shows the configuration of the CMPS in recording mode, a CMPS server module (core) 2200, comprising an exported client library (API), message supervisor and resource manager, is shown, in addition to a CMPS linked client library 3562, virtual smartcard manager (VSC manager) 2350, MLOAD device 3738 LCARD device 3740 and HDVR module 3850. The device layer interface 3700 is also shown.<br>
The CMPS core 2200 is provided in the receiver/decoder middleware and interfaces with the HDVR module 3850 via the linked client library 3562. The CMPS core 2200 also interfaces with the MLOAD device 3738, the LCARD device 3740 (housing the conditional access smartcard), and the RCARD device 3442 (not shown, which houses an optional CMPS smartcard).<br>
In operation of the CMPS system in record mode, described in more detail later, ECMs 5602 received in the programme data stream are isolated by the MLOAD device and then routed by the CMPS resource manager to the conditional access smartcard. Control words 5600 derived from the ECMs are then routed to the virtual smartcard manager 2350, in addition to corresponding URMs and CMPS EMMs where appropriate (which are preferably also received in the programme data stream, but may be received via other routes).<br>
Tlie virtual smartcard manager 2350 then manages the conversion of the control words and other data into CMMs 5610 using a real or virtual CMPS smartcard 2400 (not shown) as appropriate, and forwards the CMMs back to the CMPS core for further processing. In the preferred embodiment, secure authenticated channels (SACs) are used between the various software and hardware components to transfer the control words and other sensitive data. The virtual smartcard manager 2350 and virtual smartcard 2400 are described later in more detail.<br>
The CMMs are then passed to the HDVR controller 3350 so that they can be stored on disk along with the corresponding content data. In the event that the ECMs cannot be decrypted (typically because the user does not have the appropriate rights), the ECMs themselves are stored in the CMM structure in place of the control words to allow future conversion of the ECMs into control words at a later date when the access rights become available. The above encapsulation of ECMs in CMMs is also described in more detail later.<br>
In a variant of the preferred embodiment, the content may be descrambled and rescrambled at the recording stage, in which case new content keys (equivalent to local control words) are generated and stored in the CMMs. In a further variant, the content is super-scrambled (that is, scrambled further by a typically more powerful encryption method), which requires a second level of CMMs containing the further scrambling/encryption keys. In this case, Triple DES could be used with 168 bit key length as a suitably more powerful encryption method.<br>
In Figure 12, which shows the configuration of the CMPS in playback mode, the CMPS core 2200, comprising the exported client library, message supervisor and resource manager, is shown, in addition to the CMPS linked client library 3562, virtual smartcard manager (VSC manager) 2350, and HDVR module 3850.<br>
In operation of the CMPS system in playback mode, described in more detail below, CM Vis forwarded by the HDVR module 3 8 5 0 are decoded under the control of the virtual smartcard manager 2350 to produce the desired control words, which are then forwarded<br>
back to the HDVR module 3850. If, as mentioned above, the CMM contains encapsulated ECMs rather than decoded control words, the CMPS will again attempt to decrypt the ECM, filling the CMM with the appropriate control words if successful.<br>
The process of recording content to disk will now be described from a more functional perspective, as illustrated in Figure 13. In Figure 13, each ECM 5602 is passed to a decryption stage 5550 in the conditional access smartcard, where it is decrypted using a global exploitation key KQ 5606. The decrypted control word 5600 then passes to an encryption stage 2202 in the CMPS smartcard, where it is combined into a content management message (CMM) with the corresponding URM 5612 and CMPS EMM 5614, and then re-encrypted as a whole using a local exploitation key KL 5608. The unaltered, scrambled content and the resulting plurality of CMMs are then stored in a content portion 2110 and management data portion 2112 respectively within a single file in the hard disk 2100. In a variant of the preferred embodiment, separate files are used to store each portion.<br>
In the reverse process of playing back content from disk, illustrated again in Figure 14, the scrambled content 1300 is read from the content portion 2110 in the file on the hard disk 2100 and fed into the descrambler 2010. In parallel, CMMs are read from the separate management data portion 2112 and fed into a decryption stage 2204 in the CMPS smartcard. The CMMs are decrypted with the local exploitation key 5608 and then split into the URM 5612, CMPS EMM 5614 and control word 5600. If the CMPS module decides that the user is entitled to view the material (on the basis of the URM and CMPS EMM), the control word 5600 is then sent to the descrambler 2010 at the appropriate time to allow the content to be descrambled.<br>
Additionally, the system provides means for generating and storing all of the master and dependent encryption and/or authentication keys required for all of the sessions, whilst retaining as much security and speed as possible. The processes involved in both the generation and storage of these keys will be described later in more detail.<br>
Recording using the HDVR<br>
The process of recording using the HDVR 3850 will now be described in more detail.<br>
At the time of recording a programme, HDVR generates a file whose structure is mainly in two parts: management data (for example, hdvrjile.management_datd) and content itself (for example, hdvrjile. content_data).<br>
The first part of the file corresponds (among other things) to local messages (Content Management Messages - CMMs) generated and handled by the CMPS, which contain the usage rules of the content as well as the associated unscrambling keys (the control words in other words). The first part also comprises an index table comprising indices mapping time offsets in the bitstream to data offsets in the file.<br>
The second part is made up of a partial transport stream (pTS) corresponding to the various components of a given programme (video, audio, subtitles, and so on) and remains scrambled, as broadcast, in the common scrambling format DVB_CS. In variants of the preferred embodiments, the management data and content are stored in at least two separate files. In further variants, the content is either descrambled and rescrambled (preferably with a local key unique to the given receiver/decoder) or super-scrambled with a further, more secure, level of encryption (such as Triple DES with suitably large key lengths).<br>
The CMPS takes charge of synchronisation with its own management and control messages to create the CMM in each encryption period. This CMM is then sent to the HDVR for insertion into the hdvrjile.management_data part. The CMPS also communicates a certain amount of information regarding the management of the content (hdvr_data), such as the start points of chapters or the authorised maximum extent of recording in time-shift mode.<br>
This is illustrated schematically in Figure 15. The URM, the CMP_EMM and the CWs are input to the CMPS. hdvr_data is passed from the CMPS 300 to the HDVR 350.<br>
As mentioned above, the hdvrj\le.management_data part of the file also comprises an<br>
index table comprising indices mapping time offsets in the bitstream to data offsets in the file. Two types of indices are included in the index table, HDVR indices, which are inserted automatically by the HDVR, and User indices, which are inserted upon command of a user.<br>
The HDVR indices are positioned by the HDVR at intervals corresponding to periodic time offsets in the bitstream and are used as play entry points in the recorded file. In preferred embodiments, HDVR indices are generated by an HDVR automatically during the recording of a programme.<br>
The User indices are also play entry points, and are set by a user at the time of recording of a programme or during playback of a recorded programme<br>
The Index table also comprises pointers mapping each HDVR and User index to an appropriate CMM, enabling decryption of the stored bitstream at the points indexed by then HDVR and User indices.<br>
Processing recorded content, for instance searching for points in a file, or a corresponding bitstream, and "trick mode" operations such as fast forwarding, rewinding, and skipping make use of HDVR and User indices stored in the index table.<br>
Playback using the HDVR<br>
The process of playing back content recorded using the HDVR 3850 will now be described in more detail.<br>
At the time of using a recorded content, the CMPS ensures the validity of the associated rights by comparing the usage rules presented in the recorded CMM with the rights acquired by the subscriber and stored either in the CMPS smartcard or in a secure location inside the receiver/decoder (under the control of the virtual smartcard). This mechanism preferably remains clear for the HDVR application, apart from possible error messages (status) describing an invalid action in response to a request. Certain of the messages are preferably in addition relayed to the user using a man-machine-interface application,<br>
notably invalid actions on a remote control (for example, when the "trick'-' mode fast_forward is not autiiorised in a sequence, a warning is displayed on the screen).<br>
To facilitate navigation within the content, it is possible to reload the descrambler with new CWs without being limited by the handling time inherent in the CMPS Smartcard. With this aim the HDVR application is able to ask the server to pre-process a certain number of CMMs before the effective use of the CWs which they contain. To do this, HDVR generates different buffers of the CMMs associated with chapters, index, and encrypting periods either side of the current position. At the request of the CMPS, the HDVR in addition retrieves the updated CMM to be reinserted in the hdvrjile. management jiata part of the video file.<br>
The principal data required by the HDVR is made up of navigation and usage constraint information (CMM.navigation and CMM.hdvr_mles) compared to the content use (labels of the start of chapters, navigation constraints, maximum extent of recording and so on) as well as the state of the CMM buffers submitted for handling at the CMPS server. Certain management information (hdvr_data) may be obtained from the URMs at the time of content recording (typically labels of the start of chapters) in the case where the information is conveyed in clear within the URM. To avoid overloading the hdvrjile _management_data part of the video file, other data, such as information about usage constraints (navigation, moral codes of chapters and so on) may be communicated by the CMPS at the time of playback of the content via the CMM.<br>
The protocols for message exchanges, and in particular the relevant data structures, will now be described.<br>
A certain amount of data taking place within the exchange protocols between the HDVR and CMPS is specified. They concern mainly the CMMjmessage messages transporting the CMM as well as the navigation information and constraints on content usage. The<br>
structure is as follows:<br>
Data Structure	Description<br>
struct CMM_message {<br>
struct CMM.	all of the CMM to be stored<br>
struct CMM.navigation,        data relating to navigation struct CMM.hdvr_rules        data relating to constraints<br>
s<br>
The CMM contains in its turn different structures which are detailed in the following.<br>
The CMM_message is in particular composed of information concerning navigation within the content. Contrary to the CMMs in which navigation and constraint data may be encrypted, these are presented in clear in the CMM_message so as to be interpreted directly by the HDVR. The general structure of the CMM is given (independently of its encoding and signature) below:<br>
Data Structure	Description<br>
struct CMM{<br>
struct CMM.navigation,        data relating to navigation<br>
struct CMM.hdvr_rales,       data relating to constraints<br>
struct CMM.contentJkey,     content keys (encoded)<br>
struct CMM.private_data     private data (usage rules)<br>
i Navigation data within the content refer to headings and are given below:<br>
Data Structure	Description<br>
struct CMM.navigation{<br>
total_chapter_number,	total number of chapters of content<br>
chapter_index	chapter number<br>
j<br>
Data concerned with content usage restrictions in. terms of invalid actions and time-shifting constraints are presented below:<br>
Data Structure	Description<br>
struct CMM.hdvr_rules{<br>
trick_mode_bitmap,	invalid video recorder actions<br>
time_shifting_duration,        maximum recording length<br>
content_rating	moral level (of current chapter)<br>
Internal structure of the CMPS<br>
The CMPS will now be described in more detail with reference to Figure 16. As also shown in Figures 11 and 12, the CMPS comprises a CMPS core 2200 and a linked client library 3562. The CMPS core 2000 itself comprises a CMPS message manager thread 2310 and a CMPS device manager thread 2320.<br>
In overview, the CMPS message managerthread provides an interface to the functionality of the CMPS for applications (for example an HDVR 3850) running on a receiver/decoder, and the CMPS device manager thread 2320 interfaces with the various relevant devices (such as the MLOAD Device, C W Device, CA Device, LCARD Device, and so on).<br>
The linked client library 3562 contains functions required to initialise the CMPS. In particular, the linked client library provides functions for creation of the CMPS message manager 2310 and CMPS device manager 2320 threads.<br>
The CMPS message manager thread 2310 comprises an exported client library 2340 and a message supervisor module 2330.<br>
The exported client library 2340 specifies the application messages which are supported by the CMPS, and the message supervisor module 2330 receives such messages and verifies mat they are valid (returning an error if this is not the case). The message manager thread 2310 supports both synchronous and asynchronous messaging.<br>
The functionality of the device manager thread will now be described in more detail.<br>
As mentioned previously, the CMPS device manager thread 2320 comprises a message router module 2360, a resource manager 2370, a virtual smartcard (VSC) 2400 and a virtual smartcard manager (VSC manager) 2350.   The virtual smartcard and virtual       smartcard manager are described in more detail later.<br>
The message router module 2360 handles the queuing (as appropriate) and routing of messages within the device manager thread 2320. When the message supervisor 2330 of the message manager thread 2310 receives a valid application message, it sends-a     corresponding asynchronous application message to the message router 2360. The message router 2360 then verifies that the received application message is valid (and raises an error if this is not the case) and then passes the message to the resource manager 2370 for further processing. Once such an application message has been processed by the resource manager 2370, a response message is passed back to the appropriate client via the message router 2360, message manager thread 2310.<br>
Communication between the message manager 2310 and device manager 2320 threads, and between the resource manager 2370 and devices, are effected via the EDLI 3600 described above.<br>
As mentioned above, the resource manager 2370 communicates with various devices, including:<br>
	The MLOAD Device 373 8 is used extract the relevant conditional access data (such as ECMs, EMMs, and so on) from the decoded MPEG stream.<br>
	The C A Device 3 720 is used to configure the ECM Manager (in the case of recording under the subscription model) and, if necessary, to change PIDs in the association table (such association table providing a correspondence between the various components making up a programme and the PIDs of their associated ECMs).<br>
	The CW Device 3760 is used to insert control words into the descrambler.<br>
	The LCARD Device 3740 is used to communicate with the conditional access smartcard.<br>
Session management<br>
Communication between the CMPS device manager thread 2320 and clients of the CMPS (such as the HDVR) is aclrieved using sessions. Between the CMPS device manager and a client, two types of session are provided: recorder and player. As described hi more detail below, new sessions are created by the CMPS device manager thread 2320 in response to suitable exchanges of messages.<br>
The recording of content is encapsulated in a recorder session, and the playback of stored content is encapsulated in a player session. As described earlier, Figure 11 illustrates in overview the typical data flow for a recording session, and Figure 12 illustrates in overview the typical data flow for a player session. At any one time, the CMPS can handle one player session and two recorder sessions, although in variants of the preferred embodiment, further sessions of both types are provided in accordance with relevant hardware considerations.<br>
Figure 17 illustrates the creation and management of a new recording session. In this figure, steps 7002 to 7026 correspond to messages exchanged between the elements of the CMPS system and elsewhere, as indicated in the following description.<br>
In step 7002 the client sends a request to open a recording session, which is then duly opened by the device manager thread. An appropriate acknowledgement, containing a unique session identifier ('SessionID'), is returned by the CMPS message manager in step 7004.   All subsequent communications relating to this session contain this session<br>
identifier.<br>
In step 7006 the client sends a request to the CMPS message manager to open a recording sequence within the recording session. In step 7008 the CMPS message manager requests a file identifier ('file ID') from the CMPS device manager. The CMPS device manager then starts a recording session at the VSC Manager, as illustrated by step 7010. In step 7012 the CMPS device manager acknowledges to the CMPS message manager the request to obtain a file ID. Subsequently, in step 7014, an acknowledgement is sent from the CMPS message manager to the client that a recording sequence has been opened.<br>
In step 7016, the client causes the CMPS message manager to obtain from the virtual machine the part of the PMT table of the programme being stored which relates to the ECMs. In step 7018 it is confirmed to the client that this has been carried out successfully.<br>
A request to commence actual recording of content is sent by the client in step 7020. The CMPS message manager then sends (step 7022) a corresponding request to the CMPS device manager. The latter acknowledges this request to the former in step 7024, and in step 7026 the CMPS message manager acknowledges the request made by the client.<br>
The recording proper then begins, with further messages being repeatedly transmitted between the CMPS, HDVR and other systems in the receiver/decoder until the recording proper ends. This recording 'loop' is described later with reference to Figure 18. The further steps following the termination of this loop will first be described, still referring to Figure 17.<br>
At any time during recording the client may send a request to the CMPS message manager to end the recording proper (step 7028). In step 7030 the CMPS message manager notifies the CMPS device manager that recording should be ended, and in step 7032 the CMPS device manager notifies the VSC manager that the recording session should be closed. In step 7034 the CMPS device manager confirms to the CMPS message manager that the request to end recording lias been carried out successfully. In step 7036 this is reported by the CMPS message manager to the client.<br>
In step 7038 the client'requests the CMPS message manager to close the recording sequence, and in step 7040 the latter corifirms to the former that this has been done.<br>
Finally, in step 7042 the client requests the CMPS message manager to close the recording session, and in step 7044 the CMPS message manager confirms to the client that this has been done.<br>
Recording proper will now be described with reference to Figure 18. In particular, steps<br>
7102, 7104 and 7106 show the core of the recording 'loop': instep 7102, the next ECM extracted by the MLOAD device is delivered by the EDLI to the resource manager in the device manager thread 2320. The resource manager then sends the ECM to the LCARD device (providing access to the conditional access smartcard), and receives in return the decoded control words back from the LCARD device (again using the EDLI as intermediary). In step 7104, the control words thus obtained are forwarded to the middleware (via EDLI again) to allow, if appropriate, the live descrambling of the corresponding content (as well as the creation of CMMs as described below). In step 7106, the control words are forwarded to the VSC manager to allow CMMs to be created for other recording sessions as appropriate.<br>
In step 7108 the client sends a request to the CMPS message manager to start recording for the present recording session. A corresponding request is sent, in step 7110, from the CMPS message manager to the CMPS device manager. In step 7112 the CMPS device manager acknowledges the request to the CMPS message manager, which acknowledges in step 7114 the request made by the client to start recording, and confirms that this has been started. Steps 7116,7118 involve, as before, the reception from the MLOAD device of the next ECM (step 7116), the decoding of the ECM by the conditional access smartcard (not shown), and the return of the control words to other interested parties (step 7118). In step 7120 the CMPS device manager notifies the CMPS message manager that a new ECM section has been received from the EDLI. In step 7122 this is reported by the CMPS message manager to the client.<br>
In step 7124 the client sends a request to the CMPS message manager for the new CMM. In step 7126 the CMPS message manager sends this request to the CMPS device manager. Subsequently, in step 7128 a command is sent to the VSC manager to create a CMM (with control words and other relevant information supplied by the resource manager in the device manager thread 2320 with the command), and the CMM is returned to the device manager by the VSC manager (not shown). In step 7130 the CMPS device manager acknowledges to the CMPS message manager that the CMM has been obtained, and this is confirmed to the client in step 7132.<br>
The exchange of messages for a player session follow broadly the same structure as the messages described above, with a series of initial messages to open the player session, a main 'loop' of messages to handle the transfer of CMMs to the CMPS (the control words then being set directly by the virtual smartcard as described elsewhere), and a final exchange of messages to close the session. Accordingly, the messages for the player session will not be described further here.<br>
Virtual smartcard<br>
The virtual smartcard (VSC) 2400 referred to earlier is a software emulation of functions of the CMPS smart card which can be inserted into the RCARD device 3442.<br>
The VSC provides the following functionality:<br>
	Creation of a CMM from an ECM<br>
	Extracting content from a CMM<br>
	Returning control words extracted from CMMs<br>
	Generating session keys<br>
	Encrypting and decrypting messages with the aid of session keys<br>
	Generating control words (where local rescrambling is to be performed)<br>
The VSC emulates in software these basic functions of the CMPS smart card using a cryptographic library located in the middleware of the receiver/decoder. This cryptographic library is provided as a separate module in the virtual machine, but in variants of the preferred embodiment is provided in the VSC manager itself, or in other parts of the receiver/decoder or attached cryptographic smartcard(s). The host processor and associated memory are used to emulate the onboard processor and memory of a real smart card. In the preferred embodiment, the resource manager module 2370 of the CMPS device manager thread 2320 communicates with the VSC manager, which in turn communicates with the VSC. The resource manager 2370 then communicates with the message manager as appropriate to return results to other parts of the system.<br>
The VSC contains three unique keys for encryption, signature verification and session generation respectively. In the preferred embodiment, these keys are generated as andwhen required, in response to the first request to open session. In variants of the preferred embodiment, these keys are created earlier, at the time of the creation of the VSC (on initialisation of the receiver/decoder after a reboot, for example).<br>
When a CMPS smartcard is present, the above keys are obtained from the CMPS smartcard by the CMPS system. Alternatively, as discussed later, the keys are generated using effectively random properties of the receiver/decoder.<br>
The manner in which the VSC 2400 performs the CMM-related functions listed above will now be briefly described.<br>
The VSC creates CMMs from two data components which it receives from the CMPS resource manager thread 2320 via the VSC manager 2350. The first component contains public information; the second contains the control words extracted from the ECMs or the ECM itself (see the description later relating to Figure 24). In a variant of the preferred embodiment, the second component also contains data extracted from the URMs.<br>
The VSC concatenates the two components and then calculates a cryptographic signature with reference to the concatenated components; tins signature is appended to the message (along with a number of bytes of padding, if required, to make the message a uniform length) before the payload (that is the control words and/or ECM, the signature and the padding) is encrypted. In the preferred embodiment, the CBC-MAC cryptographic technique is used to calculate and verify signatures on messages, which signatures are created in dependence on the message itself and a shared symmetric key.<br>
During playback, the VSC 2400 extracts the control words (or ECM) from the CMMs passed to it by a client via the CMPS threads by decrypting the payload, removing the padding and validating the decrypted message (and public information) using the attached signature. The extracted control words are then loaded directly into the descrambler by the VSC using the control word device 3760. In a variant of the preferred embodiment, key handles (key IDs) are returned to clients for the purpose of referencing in ambiguous<br>
situations.<br>
In a variant of the preferred embodiment, the VSC creates and stores tables containing the information transmitted in the form of URMs, instead of storing information from the URMs in the CMMs themselves as described above. This information includes a file identifier, and the rights and restrictions associated with it (extracted from the URMs). When a user wishes to playback a stored programme, the rights and restrictions associated with that programme may be accessed without reading the content data itself from storage device.<br>
Virtual smartcard manager<br>
The VSC manager 2350 encapsulates the functionality of the CMPS smartcard, be it in the form of a virtual smartcard (the VSC) or a real smartcard (as represented by the RCARD device). The VSC manager thus (amongst other things) performs a routing function, but also performs certain managerial functions. The VSC manager also defines the messages which may validly be sent to the VSC.<br>
In accordance with its routing role mentioned above, the VSC manager provides functions for determining whether to use the real smart card or the VSC for a particular task (in the preferred configuration where both a virtual CMPS smartcard and real CMPS smartcard are provided). This decision may be made dependent upon a characteristic or characteristics of the receiver/decoder (including the load upon it) and/or of the content data being processed. For example, the content may be relatively commercially valuable such that it is desirable to benefit from the better security afforded by a real smart card, or it may be such that the more rapid processing afforded by the VSC is required.<br>
High-level functions provided by the VS C manager include a creator function for creating a VSC instance, a destructor for destroying the VSC (releasing the resources allocated to the VSC), and a query function for determining whether the VSC module currently exists. In the preferred embodiment, only one virtual smartcard can exist at any time, but in variants of the preferred embodiment, multiple instances are possible.<br>
Lower-level functions provided by the VSC manager (which are mirrored by the VSC and/or real CMPS smartcard) include functions for creating, copying, destroying, storing, loading and deleting data objects; encryption and decryption functions, and functions for constructing the CMM as described above, including generating and using the signature and adding and removing packing; and functions for generating random numbers and generating and/or deriving keys, as will be described in more detail later.<br>
The VSC manager also provides functions for the creation and destruction or sessions between the device manager thread 2320 and the VSC. Each new session is allocated a unique identifier (a 'SessionCD') at the time of creation, and messages passed to the VSC manager subsequently specify the SessionID of the session to which they relate. These sessions are distinct to (but similar to) the sessions used for communication between the CMPS and a client, described earlier. In contrast to these CMPS-client sessions, a total of three session types are provided: recorder, player and management sessions. Of these, recorder and player sessions are typically only created during the corresponding recorder and player sessions between the CMPS and client.<br>
In more detail, the recorder sessions are used for the creation of messages for local control (that is, CMMs) for storage together with programme data. Player sessions are used during playback of recorded content; the functions used during these sessions include those relating to tire extraction of control words from CMMs sent to the VSC by a client (for example the HDVR) and their insertion into the descrambler via the CW device. In a variant of the preferred embodiment, the control words are forwarded to other entities, such as digital televisions with descrambling capabilities or the HDVR in charge of loading control words, using a secure authenticated channel.<br>
In a management session, the basic functions of the VSC are available: that is, functions such as the creation of pseudo-random number sequences, and so on. The functions concerning the processing of CMMs are not available in a management session.<br>
Communication between the VSC manager and the VSC or real CMPS smart card is required to be secure. A master session key is used for this purpose. As described later<br>
in the section relating to the generation of keys, the master session key may be diversified with a SessionID in order to derive different session keys where more than one is required. This master session key may also be used to establish secure communication with the HDVR, for example, in the embodiment in which control words are passed to the HDVR which is responsible for passing them to the CW device 3760.<br>
It should also be noted that the VSC and the VSC manager have been described and illustrated (in Figure 16) as fonningpart of the CMPS device manager thread; however, they may be provided elsewhere within the CMPS system as appropriate.<br>
Key generation<br>
With reference to Figures 19 and 20, the various means for generating keys will now be described.<br>
As mentioned above, in the preferred embodiment, various keys are generated either by the manipulation of a random number generator, or by diversifying known keys.<br>
Figure 19 shows the former process, in which a new master session key 8100 is created. Various elements 8110 of the receiver/decoder (in this case, the tuner, system clock and operating system) and various measurable properties 8120 of these elements (such as the average bit error rate of the tuner, the signal level of a given signal, the current system time and the number of accesses made to the device layer interface since the last reset) are shown, in addition to a bank of normalising filters 8130, a bank of bit scramblers 8140, an exclusive-or operator (XOR) 8150, and a random number generator 8160.<br>
The properties 8120 of the elements 8110 are chosen, wherever possible, in their capacity as effectively random and/or unpredictable values, preferably varying over time. Where appropriate, each property 8120 is then normalised to the same bit width as the random seed (in other words, to create a 32 bit number for a 32 bit random seed, as is the case in the preferred embodiment) so that no property can dominate.<br>
Subsequently, the normalised value of each property is then scrambled by the bit<br>
scramblers, which effectively swap round different bits of the values for each property, in a way which differs from property to property. If the unpredictability of the measured properties is confined to only a few lower-order bits, for example, the bit scrambling will effectively distribute this unpredictability throughout the 32 bit space.<br>
Finally, the exclusive-or operator combines the first bit-scrambled value with the second, and then combines the result with the third bit-scrambled value and so on.<br>
The random seed thus created is then fed into the random number generator, which then produces the desired encryption key with the desired bit length (by appending any number of fixed length random numbers if required).<br>
In variants of the preferred embodiment, some or all of the normalising, bit scrambling and exclusive-or stages are absent, in some cases replaced with a different method entirely for combining the properties, such as simply summing them, for example.<br>
In Figure 20. a key diversifier 8200 is shown, as well as its inputs of a typical master session key 8210, a session ID 8220, and its output of a derived session key 8230.<br>
Essentially the key diversifier uses a formula which takes advantage of the properties of strong cryptographic keys (that is, typically making use of various properties of prime numbers) to manipulate the master session key 8210 in dependence on the session ID 8220 to create a session key 8230 unique to that session. It follows as a constraint on the key diversifier that substantially all different session ID inputs will generate a unique session key 8230, and the session key 8230 is strong enough that cryptoanalysis of it will not easily yield the master session key 8210.<br>
It is also worth noting that the elements shown in Figures 19 and 20 are illustrative, and do not necessarily correspond to actual physical devices. In fact, in the preferred embodiment, the normalising and bit scrambling functions, exclusive-or operation and random number generation are all carried out by the host processor 2002 mentioned earlier. In variants of the preferred embodiment, at least one further processor carries out<br><br>
certain of these functions in order to reduce the load on the host processor.<br>
Key storage<br>
With reference to Figure 21, the means for securely storing and reproducing encryption keys will now be described.<br>
In Figure 21, a key splitter 8310, storage access device 8320, and key recornbiner 8330 are shown, as well as a data bus 8340 which connects the storage access device 8320 with a conventional RAM element 8350, hard disk unit 2100, EEPROM element 8360 and FLASH RAM element 8370.<br>
To store an encryption key, for example, the key is fed into the key splitter 8310, which chops the key into an appropriate number of portions having a certain number of bits each. In the preferred embodiment, the portions all have the same size of 8 bits (one byte) for convenience, but in variants of the preferred embodiment, the portions have smaller and/or larger sizes, and also may have different sizes with respect to each other. Sizes of less than 8 bits are generally less convenient to manipulate, but can offer improved security.<br>
The portions of the key are then stored by the storage access device 8320. In practice, this device comprises the various software devices which are responsible for communicating with the various storage devices 8350,2100,8360,8370, such as the mass storage device 3728 (for the hard disk), and so on.<br>
In the preferred embodiment, the exact choice of locations (comprising storage device and address in storage device) in which to store the portions is generated by the storage access device in dependence on a key identifier (limited to, for example, 8 bits) which is supplied by the invoicing process. Each location and destination device needs to be unique to a particular key identifier, to avoid the overwriting of portions of different keys. In the preferred embodiment, an appropriately complex formula is used to calculate each storage location on the fly in dependence on the key identifier and portion number. In a variant of the preferred embodiment, various tables (generated when the VSC is<br>
inritialised or reinitialised) are used to keep track of the storage locations, and each separately stored portion of the stored key may also be encrypted as it is stored with a key derived from the key identifier and/or portion number.<br>
The corresponding process of reading the key is initiated by a command from the invoking process specifying the key identifier, which causes the storage access device to first calculate the storage locations (as described above), and then load all of the key portions.<br>
The key portions are then forwarded to the key recombiner 8330, which reassembles the key and outputs it to the invoking process.<br>
A further improvement to the above methods for key storage is the randomisation of memory in which the portions of keys are to be stored (and preferably the randomisation of further memory in which they will not be stored). Since encryption keys may often be detected on account of their apparent randomness, this can reduce the possibility of keys being reassembled by pirates, for example.<br>
Figures 22 and 23 illustrates the operation of the key storage mechanism in more detail.<br>
Figure 22 shows a 48-bit encryption key 8400 (here shown in hexadecimal format), key portions 8410, 8412, 8414, 8416, 8418, and a randomised memory area 8420, and illustrates the splitting of the key 8400 into constituent portions (in this case of unequal sizes), and the storage of these portions in the randomised memory area 8420 in the locations indicated.<br>
Figure 23 illustrates the storage of the same key using more than one device (in contrast to the example shown in Figure 22 winch uses only one memory area).<br>
In Figure 23, a 48-bit encryption key 8500, its constituent portions 8510, 8512, 8514, 8516,8518, and an EEPROM element 8520, hard disc unit 2100 and flash RAM element 8530 are shown. Here, the allocation of different portions 8510,8512,8514,8516,8518<br>
to different devices 8520, 2100, 8530 is illustrated.<br>
Encapsulation of ECMs in CMMs<br>
With reference to Figure 24, the encapsulation of ECMs in CMMs will now be described in more detail.<br>
Figure 24 shows a CMM creation step 8600 and a content playback step 8610, in a first and second case (left side and right side of the dotted line respectively). In the various scenarios, a conditional access system 5000, CMM 5610 and a key field 8620 in the CMM are shown.<br>
In the first step 8600, the user is recording a content (such as a television programme) for which at least one CMM is required. In both cases, the relevant ECM for the given CMM 5610 is requested as per usual.<br>
The first case illustrates the situation where the user has been granted the access rights ' to view the content for which the CMM is required. In this case, the conditional access system 5000 returns to the CMPS system the control words contained in the ECM, and the relevant field 8620 of the CMM is filled with the control words.<br>
In the second case, however, the user does not have the access rights for the content which is being recorded. In response to the DENY signal from the conditional access system 5000, the relevant ECM is stored in the field 8620 usually reserved for the decrypted control words. At this point, the user will not be able to view the content, and for as long as the access rights continue to be denied, the CMM will not function as intended. In order to encapsulate the ECM within the CMM, the Resource Manager 23 70 passes the ECM, rather than control words, to the VSC 2400 via the VSC manager 2350 as a parameter to a request for creation of a CMM during the procedure described above with reference to Figure 11.<br>
In the second step 8610. the user is attempting to play back the content recorded earlier during step 8600. By now, it is assumed where the access rights for the content were<br><br>
previously missing, they have now been properly obtained. In accordance with the normal functioning of the CMP S system, the client (typically the HD VR system) forwards the CMM to the CMPS system for processing.<br>
     In the first case,, the CMPS system extracts the control words from the relevant field 8620 in the CMM 5610 as usual and autonomously feeds the control words to the descrambler (not shown) to allow the content to be viewed.<br>
In the second case, the CMPS system extracts the ECM from the CMM 5610 and      forwards it again to the conditional access system 5000. In the event of a further failure to decrypt, the CMPS system would report a failure and attempt the same during future attempts to play back the content. This time, however, the decryption is successful. The control words are passed to the descrambler 2010, to enable it to descramble the content, and to the VSC, which uses them to generate a new CMM 5610, which is sent to the client for storage as described above.<br>
It should be noted that the system described above can also be applied to other forms of data other than ECMs and control words. Furthermore, whilst the second step 8610 has been described as operating during the play back of the content in question - which has the advantage that the validation of the CMMs is performed on the fly - it can also operate 'in the background' at any other time, for example during the early hours of the morning, or in response to the receipt of an EMM granting the appropriate rights.<br>
Encapsulation of ECMs in CMMs can also provide a degree of independence between the HDVR and the conditional access systems. This is particularly useful if more than one conditional access system is provided in the receiver/decoder, for example. In this case, as before, the CMPS may embed ECMs from the various conditional access systems until one of them receives the appropriate rights, allowing the ECM to be resolved.<br>
The precise details of the implementation of the various functions described above, and their distribution between hardware and software, are a matter of choice for the implementor and will not be described in detail. It is, however, noted that dedicated<br>
integrated circuits capable of performing the operations required in the receiver/decoder are commercially available or can be readily designed, and these can be used as the basis for a hardware accelerator, or more preferably modified to produce a dedicated hardware accelerator, to implement various of the operations required, thereby reducing the processing power required to run the software. However, the operations required may be implemented in software if sufficient processing power is available.<br>
The modules and other components have been described in terms of the features and functions provided by each component, together with optional and preferable features. With the information given and specifications provided, actual implementation of these features and the precise details are left to the implementor. As an example, certain modules could be implemented in software, preferably written in the C programming language and preferably compiled to run on the processor used to run the application; however, some components may be run on a separate processor, and some or all components may be implemented by dedicated hardware.<br>
The above modules and components are merely illustrative, and the invention may be implemented in a variety of ways, and, in particular, some components may be combined with others which perform similar functions, or some may be omitted in simplified implementations. Hardware and software implementations of each of the functions may be freely mixed, both between components and within a single component.<br>
It will be readily understood that the functions performed by the hardware, the computer software, and such like are performed on or using electrical and like signals. Software implementations may be stored in ROM, or may be patched in FLASH.<br>
It will be understood that the present invention has been described above purely by way of example, and modification of detail can be made within the scope of the invention.<br>
Each feature disclosed in the description, and (where appropriate) the claims and drawings may be provided independently or in any appropriate combination.<br><br><br><br><br><br><br><br><br><br><br><br>
The present invention relates to a a method for processing data and an apparatus thereof.<br>
The invention relates to'a virtual smartcard, a virtual smartcard manager, apparatus for processing data, a conditional access system, a receiver/decoder, a broadcast system, a method of processing data, a method of generating a cryptographic key, a method of storing a cryptographic key value, a computer program product, a computer readable medium and a signal. The invention finds particular application in relation to conditional access systems for receiver/decoders.<br>
Digital television systems transmit television channels to the viewer in digital, rather than analogue, form. The digital channels are encoded into a digital data stream at the transmitter end, and are decoded at the receiver end using a digital receiver/decoder. To allow interactivity, an uplink may be provided, either via the same medium that delivers the television channels, or else via a different medium such as a telephone link. Further types of data, such as digital audio, software and interactive data can be or are also broadcast. As used herein, the term "digital television system" includes for example any satellite, terrestrial, cable and other system.<br>
The term "receiver/decoder" as used herein may connote a receiver for receiving either encoded or non-encoded signals, for example television and/or radio signals, preferably in MPEG format, which may be broadcast or transmitted by some other means. The term may also connote a decoder for decoding received signals. Embodiments of such receiver/decoders may include a decoder integral with the receiver for decoding the received signals, for example, in a "set-top box", such as a decoder functioning in combination with a physically separate receiver, or such a decoder including additional functions, such as a web browser, a video recorder, or a television.<br>
The term MPEG refers to the data transmission standards developed by the International Standards Organisation working group "Motion Pictures Expert Group" and in particular but not exclusively the MPEG-2 standard developed for digital television applications and set out in the documents ISO 13818-1, ISO 13818-2, ISO 13818-3 andlSO 13818-4, and</td>
			</tr>
		</table>	
		<br>
		<h3>Documents:</h3>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUFic3RyYWN0LSgyOC0wNy0yMDExKS5wZGY=" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Abstract-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWFic3RyYWN0LnBkZg==" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-abstract.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUFzc2lnbm1lbnQtKDEwLTA4LTIwMTEpLnBkZg==" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Assignment-(10-08-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUNsYWltcy0oMjgtMDctMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Claims-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWNsYWltcy5wZGY=" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-claims.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUNvcnJlc3BvbmRlbmNlIE90aGVycy0oMTAtMDgtMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Correspondence Others-(10-08-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUNvcnJlc3BvbmRlbmNlIE90aGVycy0oMjgtMDctMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Correspondence Others-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWNvcnJlc3BvbmRlbmNlLW90aGVycy5wZGY=" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-correspondence-others.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LURlc2NyaXB0aW9uIChDb21wbGV0ZSktKDI4LTA3LTIwMTEpLnBkZg==" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Description (Complete)-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWRlc2NyaXB0aW9uIChjb21wbGV0ZSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-description (complete).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LURyYXdpbmdzLSgyOC0wNy0yMDExKS5wZGY=" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Drawings-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWRyYXdpbmdzLnBkZg==" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-drawings.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUZvcm0tMS0oMTAtMDgtMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Form-1-(10-08-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUZvcm0tMS0oMjgtMDctMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Form-1-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWZvcm0tMS5wZGY=" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-form-1.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUZvcm0tMTMtKDEwLTA4LTIwMTEpLnBkZg==" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Form-13-(10-08-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWZvcm0tMTMucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-form-13.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWZvcm0tMTgucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-form-18.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUZvcm0tMi0oMjgtMDctMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Form-2-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWZvcm0tMi5wZGY=" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-form-2.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUZvcm0tMy0oMjgtMDctMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Form-3-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LWZvcm0tMy5wZGY=" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-form-3.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUZvcm0tNS0oMjgtMDctMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Form-5-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LUdQQS0oMjgtMDctMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-GPA-(28-07-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LVBldGl0aW9uLTEzNy0oMTAtMDgtMjAxMSktMS5wZGY=" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Petition-137-(10-08-2011)-1.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LVBldGl0aW9uLTEzNy0oMTAtMDgtMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Petition-137-(10-08-2011).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTYxNy1kZWxucC0yMDA0LVBldGl0aW9uLTEzNy0oMjgtMDctMjAxMSkucGRm" target="_blank" style="word-wrap:break-word;">1617-delnp-2004-Petition-137-(28-07-2011).pdf</a></p>
		<br>
		<div class="pull-left">
			<a href="259946-an-apparatus-for-coding-and-decofing-a-presentation-description-of-audio-signals.html">&laquo; Previous Patent</a>
		</div>
		<div class="pull-right">
			<a href="259948-controlling-the-use-of-a-wireless-mobile-communication-device.html">Next Patent &raquo;</a>
		</div>			
	</div><!-- /span8 -->
	<div class="span4">
		<div class="well infobox">
			<table class="table table-condensed">
				<tr>
					<th>Patent Number</th>
					<td>259947</td>
				</tr>
				<tr>
					<th>Indian Patent Application Number</th>
					<td>1617/DELNP/2004</td>
				</tr>
				<tr>
					<th>PG Journal Number</th>
					<td>14/2014</td>
				</tr>
				<tr>
					<th>Publication Date</th>
					<td>04-Apr-2014</td>
				</tr>
				<tr>
					<th>Grant Date</th>
					<td>30-Mar-2014</td>
				</tr>
				<tr>
					<th>Date of Filing</th>
					<td>09-Jun-2004</td>
				</tr>
				<tr>
					<th>Name of Patentee</th>
					<td>THOMSON LICENSING S.A.</td>
				</tr>
				<tr>
					<th>Applicant Address</th>
					<td>46 QUAI A. LE GALLO, F-92100 BOULOGNE-BILLANCOURT, FRANCE</td>
				</tr>
				<tr>
					<td colspan=2>
								<h5>Inventors:</h5>
								<table class="table">
									<tr>
										<th>#</th>
										<th>Inventor's Name</th>
										<th>Inventor's Address</th>
									</tr>

										<tr>
											<td>1</td>
											<td>DAVID LEPORINI</td>
											<td>C/O CANAL + TECHNOLOGIES SOCIETE ANONYME, 34 PLACE RAOUL DAUTRY. F-75906 PARIS, FRANCE</td>
										</tr>
										<tr>
											<td>2</td>
											<td>JEAN-BERNARD BEUQUE</td>
											<td>C/O CANAL + TECHNOLOGIES SOCIETE ANONYME, 34 PLACE RAOUL DAUTRY. F-75906 PARIS, FRANCE</td>
										</tr>
										<tr>
											<td>3</td>
											<td>MICHEL ANGEL</td>
											<td>4 BOULEVARD MORLAND, F-75004 PARIS, FRANCE</td>
										</tr>
								</table>
					</td>
				</tr>
				<tr>
					<th>PCT International Classification Number</th>
					<td>G06F 1/00</td>
				</tr>
				<tr>
					<th>PCT International Application Number</th>
					<td>PCT/IB02/05774</td>
				</tr>
				<tr>
					<th>PCT International Filing date</th>
					<td>2002-12-12</td>
				</tr>
				<tr>
					<td colspan=2>
						<h5>PCT Conventions:</h5>
						<table class="table">
							<tr>
								<th>#</th>
								<th>PCT Application Number</th>
								<th>Date of Convention</th>
								<th>Priority Country</th>
							</tr>

								<tr>
									<td>1</td>
									<td>PCT/IB02/05774</td>
									<td>2002-12-12</td>
								    <td>PCT</td>
								</tr>

						</table>
					</td>
				</tr>
			</table>
		</div><!-- /well -->
	</div><!-- /span4 -->
</div><!-- /row-fluid -->

        </div>

      </div><!--/row-->

      <footer class="footer">

        <style>
        .allindianpatents-footer { width: 320px; height: 50px; }
        @media(min-width: 500px) { .allindianpatents-footer { width: 468px; height: 60px; } }
        @media(min-width: 800px) { .allindianpatents-footer { width: 728px; height: 90px; } }
        </style>
        <center>
        </center>

        <p>&copy; All Indian Patents, 2013-2021.</p>
        <p>Patent data available in the public domain from Indian Patents Office, Department of Industrial Policy and Promotions, Ministry of Commerce and Industry, Government of India.</p>
      </footer>

    </div> <!-- /container -->

    <!-- Javascripts
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/application-95f297ff0d8d2015987f04b30593c800.js" type="text/javascript"></script>

    <!-- Start of StatCounter Code for Default Guide -->
    <script type="text/javascript">
    var sc_project=8902313; 
    var sc_invisible=1; 
    var sc_security="3c1f8147"; 
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write("<sc"+"ript type='text/javascript' src='" +
    scJsHost+
    "statcounter.com/counter/counter.js'></"+"script>");
    </script>
    <noscript><div class="statcounter"><a title="web stats"
    href="http://statcounter.com/free-web-stats/"
    target="_blank"><img class="statcounter"
    src="http://c.statcounter.com/8902313/0/3c1f8147/1/"
    alt="web stats"></a></div></noscript>
    <!-- End of StatCounter Code for Default Guide -->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-244143-31', 'allindianpatents.com');
      ga('send', 'pageview');

    </script>

  </body>

<!-- Mirrored from www.allindianpatents.com/patents/259947-a-method-for-processing-data-and-an-apparatus-thereof by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 04 Apr 2024 23:31:17 GMT -->
</html>
