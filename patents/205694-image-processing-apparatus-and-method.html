<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from www.allindianpatents.com/patents/205694-image-processing-apparatus-and-method by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Apr 2024 06:54:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Patents. 205694:IMAGE PROCESSING APPARATUS AND METHOD</title>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="cYcP52B8zyTWKbLwby2YPh9z/gvY/RLjWOwY4YXkiXg=" name="csrf-token" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js" type="text/javascript"></script>
    <![endif]-->

    <link href="../assets/application-e80cf34975c5b1730c80b2f7170e7d26.css" media="all" rel="stylesheet" type="text/css" />

  </head>
  <body>

    <div class="navbar navbar-fluid-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">Indian Patents</a>
          <div class="container-fluid nav-collapse">
            <ul class="nav">
              <li><a href="../recently-granted.html">Recently Granted Patents</a></li>
              <li><a href="../recently-published.html">Recently Published Patents</a></li>
            </ul>
            <form id="gform" class="navbar-search pull-right" action="https://www.google.com/search" method="get" target="_blank" onsubmit="document.getElementById('gform').q.value='site:http://www.allindianpatents.com '+document.getElementById('gform').q.value">
                <input type="text" name="q" id="q" class="search-query" placeholder="Search" onclick="this.value=''" autocomplete="off">
            </form>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span12">

          <style>
          .allindianpatents-top { width: 320px; height: 50px; }
          @media(min-width: 500px) { .allindianpatents-top { width: 468px; height: 60px; } }
          @media(min-width: 800px) { .allindianpatents-top { width: 728px; height: 90px; } }
          </style>
          <center>
          </center>
          
          <div class="row-fluid">
	<div class="span8">

		<table class="table">
			<tr>
				<th>Title of Invention</th>
				<td><h1 style="font-size:large;">IMAGE PROCESSING APPARATUS AND METHOD</h1></td>
			</tr>
			<tr>
				<th>Abstract</th>
				<td>A color conversion technique which places an importance on a color difference and converts an input color outside a gamut into a color inside the gamut to minimize the color difference is available. However, this technique does not determine whether the input color falls inside or outside a visual limit range. Upon processing image data between image input/output devices, image data is input (S201), it is determined whether the input image data falls outside a predetermined gamut (S204), and image data which is determined to fall outside the gamut is converted into a color on the inframarginal portion of or inside the gamut (S206).</td>
			</tr>
		</table>

					<style>
					.allindianpatents-post-abstract { width: 320px; height: 50px; }
					@media(min-width: 880px) { .allindianpatents-post-abstract { width: 468px; height: 60px; } }
					@media(min-width: 1267px) { .allindianpatents-post-abstract { width: 728px; height: 90px; } }
					</style>
					<center>
					<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- AllIndianPatents-post-abstract -->
					<ins class="adsbygoogle allindianpatents-post-abstract"
					     style="display:inline-block"
					     data-ad-client="ca-pub-7914358224572760"
					     data-ad-slot="9152759240"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>					
					</center>

		<table class="table">
			<tr>
				<th>Full Text</th>
				<td> <br><br>
DESCRIPTION<br>
IMAGE PROCESSING APPARATUS AND METHOD<br>
TECHNICAL FIELD<br>
The present invention relates to an image processing apparatus and method and, for example, to an image process for processing image data between image input/output devices.<br>
BACKGROUND ART<br>
Along with the popularization of personal computers, it has become easy to input an image by an image input device such as a digital camera, color scanner, or the like, to display and confirm that image using an image display device such as a CRT, LCD, or the like, to apply an edit process, modification process, retouching process, and the like to the image in accordance with the intended purpose, and to output the image using an image output device such as a color printer or the like. Also, an image sensed by a digital camera is often directly output from a color printer without being displayed on a color monitor. Of course, when a CG image created on a computer is output by a color printer, no image input device is required.<br>
Image input/output devices such as a digital camera, color scanner, color monitor, color printer, and the like have different color reproduction<br><br>
characteristics and ranges.  In order to match color reproduction between image input/output devices, a standard color space is used as a color space to exchange color signals between devices to execute a color process that places an importance on  gradation (tincture), vividness, color difference, or the like in correspondence with the input/output purpose or application of an image.<br>
As a standard color space used to exchange color signals between devices, sRGB as a monitor color space is known. The gamut of the sRGB color space is narrower than that of an ink-jet printer.  As standard color spaces having broader gamuts, sYCC, bg-sRGB, scRGB, and the like are known. However, these color spaces have broad gamuts beyond the human visible range (visual limit range), but do not define handling of data outside the visual limit range.<br>
The human visible range (visual limit range) indicates a region in the xy chromaticity diagram, which is surrounded in a spectrum locus and a purple boundary, and indicates a color reproduction range which is a visible range of the human.<br>
As for handling of data outside a gamut, Japanese Patent Laid-Open No. 4-186969 discloses an example wherein when a color outside the gamut of an image output device is input, color conversion that attaches an importance on color differences and converts the<br><br>
input color into a color which is closest to the input color (i.e., a color having a minimum color difference) within the gamut of the image output device is executed. However, the technique disclosed in this reference not only does not check whether the input color falls inside or outside the visual limit range, but also does not consider the tincture of original input data since that technique simply converts a color outside the gamut of the image output device into a color having a minimum color difference.<br>
As for handling of extended-gamut digital image data, Japanese Patent Laid-Open No. 2002-27275 obtains a digital image of a preservation space by adjusting the color value of an extended-gamut digital image to fall within a limited gamut, and expressing the limited-gamut digital image within a preservation color space. Then, this technique determines a residual image that indicates the difference between the extended-gamut digital image and limited-gamut digital image to associate them with the digital image of the preservation space - However, in the contents of Japanese Patent Laid-Open No. 2002-27275, a preservation image and residual image are used to preserve a target image, and how to handle color space in an image process between color input/output devices that handle a color image with a broad gamut is not specified.<br><br>
DISCLOSURE OF INVENTION<br>
The present invention has been made to solve the aforementioned problems individually or together, and has as its object to appropriately handle image data outside a gamut.<br>
It is another object of the present invention to allow to set color conversion in consideration of the tincture of image data outside a gamut.<br>
In order to achieve the above objects, a preferred embodiment of the present invention discloses an image processing method of processing image data between devices which input/output an image, comprising the steps of:  inputting image data; determining whether or not the input image data falls outside the human visible range; and converting the image data which is determined to fall outside the range to a color on an inframarginal portion of or inside the range.<br>
It is still another object of the present invention to allow a color image process which independently uses a color expression space and a color space for a color conversion process upon exchanging image data between color image input/output devices or upon executing image processes such as color conversion and the like.<br>
In order to achieve the above object, a preferred<br><br>
embodiment of the present invention discloses an image processing method, comprising the steps of:  inputting a color data represented by a first color space which includes the human visible range; converting the input color data into a second color space for a color conversion process which includes a gamut of a first device; performing the color conversion process on the color data converted into the second color space; and converting the color data, which has undergone the color conversion process, into the first color space, and outputting the color data converted into the first color space.<br>
Other features and merits of the present invention will be apparent from the following description taken in conjunction with the accompanying drawings.<br>
BRIEF DESCRIPTION OF DRAWINGS The accompanying drawings, which are incorporated in and constitute a part of the specification, illustrate embodiments of the invention and, together with the descriptions, serve to explain the principle of the invention.<br>
Fig. 1 is a block diagram showing the arrangement of an image processing apparatus according to an embodiment;<br>
Fig- 2 is a flow chart showing an image process<br><br>
of the image processing apparatus;<br>
Fig. 3 is a flow chart showing a process for reading visual limit range information;<br>
Figs- 4A and 4B show an example of visual limit range information stored in a visual limit range storage unit;<br>
Fig. 5 is a flow chart showing a process for determining whether a color falls inside or outside a visual limit range;<br>
Fig. 6 is a flow chart showing a color conversion process;<br>
Fig. 7 shows a color conversion method setup window as a user interface window used to set a color conversion method;<br>
Fig. 8 is a graph for explaining the color conversion method;<br>
Fig. 9 is a block diagram showing the arrangement of an image processing apparatus according to the second embodiment;<br>
Fig. 10 is a flow chart showing an image process of the image processing apparatus;<br>
Fig. 11 is a flow chart showing a process for reading internal process gamut information;<br>
Figs. 12A and 12B show an example of internal process gamut information, which is stored in an internal process gamut storage unit;<br>
Fig. 13 is a flow chart showing a process for<br><br>
determining whether a color falls inside or outside an internal process gamut;<br>
Fig. 14 is a flow chart showing a color conversion process;<br>
Fig. 15 is a block diagram showing the arrangement of an image processing apparatus according to the third embodiment;<br>
Fig. 16 is a flow chart showing an image process of the image processing apparatus;<br>
Fig. 17 is a flow chart showing a process for mapping an internal process gamut to the gamut of an image output device;<br>
Figs. 18A to 18D are block diagrams of an image processing apparatus according to the fourth embodiment;<br>
Fig. 19 is a flow chart for explaining this flow of processes in the image processing apparatus of the fourth embodiment;<br>
Fig. 20 is a flow chart for explaining the flow of processes in an input-side image processing apparatus of the fourth embodiment;<br>
Fig. 21 is a flow chart for explaining the flow of processes in a display-side image processing apparatus of the fourth embodiment;<br>
Fig. 22 is a flow chart for explaining the flow of processes in an output-side image processing apparatus of the fourth embodiment;<br><br>
Fig. 23 is a flow chart for explaining a range information read process of a color conversion work space;<br>
Fig. 24 is a flow chart for explaining a process for determining whether a color falls inside or outside the color conversion work space range;<br>
Fig. 25 is a flow chart for explaining a color conversion process into the color conversion work space;<br>
Fig. 26 is a view for explaining the color conversion process;<br>
Figs. 27A and 27B show an example of color conversion work space range information;<br>
Fig. 28 is a block diagram of an image processing apparatus according to the fifth embodiment;<br>
Fig. 29 is a flow chart for explaining the flow of processes in the image processing apparatus of the fifth embodiment;<br>
Figs. 30A to 30D are block diagrams of an image processing apparatus according to the sixtti embodiment;<br>
Fig. 31 is a flow chart for explaining the flow of processes in the image processing apparatus of the sixth embodiment;<br>
Fig. 32 shows an example of a user interface in the image processing apparatus of the sixth embodiment; and<br>
Fig. 33 shows an example of image data in the<br><br>
seventh embodiment.<br>
BEST MODE FOR CARRYING OUT THE INVENTION An image processing apparatus and method according to preferred embodiments of the present invention will be described in detail hereinafter with reference to the accompanying drawings.<br>
First Embodiment [Arrangement]<br>
Fig. 1 is a block diagram showing the arrangement of an image processing apparatus 1 of this embodiment.<br>
To the image processing apparatus 1, an image input device 2 such as a digital camera, color scanner, or the like for inputting an image, an image display device 3 such as a CRT, LCD, or the like for displaying an image, and an image output device 4 such as a color printer or the like for outputting an image are connected.<br>
In the image processing apparatus 1, an image input unit 5 is an interface such as a USB, IEEE1394, or the like, which inputs a color signal from the image input device 2. An image display unit 6 is a video interface which generates a color signal to be displayed on the image display device 3. An image output unit 7 is an interface such as IEEE1284, USB, IEEE1394, or the like, which outputs a color signal to<br><br>
the image output device 4.<br>
In an RGB space such as scRGB, which can express a value beyond the visual limit range, digital data such as computer graphics data or the like can be generated irrespective of whether or not it falls within the visual limit range, and often exceeds the visual limit range. Also, in an RGB space such as scRGB, which can express a value beyond ttie visual limit range, when image data which falls within the visual limit range undergoes a process such as an edge emphasis process, saturation-up process, or the like, which increases the saturation or lightness of pixels, the processed image data may often exceed the visual limit range.<br>
A color coordinate conversion unit 8 converts color signal coordinates (color space) among an input color signal, display color signal, output, color signal, and processed color signal- A gamut inside/outside determination unit 9 determines if an input color signal indicates a color inside or outside the visual limit range. A color conversion unit 10 converts a color signal corresponding to a color outside the visual limit range into a color of an inframarginal portion of the visual limit range.<br>
A data buffer 11 is a memory such as a RAM or the like, which temporarily saves data for data processes. A visual limit range storage unit 12 is a nonvolatile<br><br>
memory such as a ROMr hard disk, or the like, which stores the visual limit range in a state wherein the Y values of XYZ values of black and white aire normalized to 0 to 1, and also stores LCh values or RGB values as a three-dimensional (3D) range.<br>
A user interface (UI) unit 13 is an interface which allows the user to operate the image processing apparatus 1. Note that an interface window generated by the UI unit 13 is displayed on the image display device 3 via the image display unit 3. User's operations on the interface window are input to the UI unit 13 via a keyboard and pointing device (not shown) .<br>
Note that the color coordinate conversion unit 8 gamut inside/outside determination unit 9, color conversion unit 10, and UI unit 13 are implemented by supplying a program to a CPU (not shown) of the image processing apparatus 1 although they may be implemented by hardware. [Processing]<br>
Fig. 2 is a flow chart showing the image process of the image processing apparatus 1. This image process is executed by the CPU of the image processing apparatus 1.<br>
When image data is input from the image input device 2 via the image input unit 5, the image data is written in the data buffer 11 (S201). The input image data undergoes color coordinate conversion into XYZ<br><br>
values by the color coordinate conversion unit 8 (S202).  In this embodiment, scRGB is used as color coordinate values of the input image data.  Therefore, color coordinate conversion in step S202 uses:<br><br>
Visual limit range information is read out from the visual limit range storage unit 12 (S203), and the gamut inside/outside determination unit 9 determines whether the image data which has undergone the color coordinate conversion falls inside or outside the visual limit range (S204). If the determination result indicates that the image data falls within the visual limit range, the flow jumps to step S207; otherwise, the flow advances to step S206 (S205).<br>
If it is determined that the image data falls outside the visual limit range, the color conversion unit 10 converts that image data into image data corresponding to a color of an inframarginal portion of the visual limit range, and writes the converted data at a corresponding location on the data buffer 11 (S206).  It is then determined if image data to be processed corresponds to the last pixel of the input<br><br>
image data (S207).  If the image data to be processed does not correspond to the last pixel, the flow returns to step S204.<br>
If the image data corresponds to the last pixel, the color coordinate conversion unit 8 executes color coordinate conversion of the image data stored in the data buffer 11 from XYZ values into output color signal coordinate values (S208). In this embodiment, scRGB is used as output color coordinate values. Therefore, the<br><br>
The image data stored in the data buffer 11 is output to the image display device 3 or image output device 4 via the image display unit 6 or image output unit 7 (S209), thus ending the process. [Visual Limit Range Information]<br>
Fig, 3 is a flow chart showing the process for reading the visual limit range information in step S203.<br>
The XYZ values of black as the lower limit of the visual limit range are read from the visual limit range storage unit 12, and are set in registers Xk, Yk, and<br><br>
Zk (S301). Likewise, the XYZ values of white as the upper limit of the visual limit range are read, and are set in registers Xw, Yw, and Zw (S302). Next, 3D information (LCh values) of the visual limit range are read (S303), thus ending the process.<br>
Figs. 4A and 4B show an example of the visual limit range information stored in the visual limit range storage unit 12, and respectively show the XYZ values of black information and white information of the visual limit range (Fig. 4A) and the LCh values of 3D information of the visual limit range (Fig. 4B). For example, black information is expressed by X = 0.0, Y = 0.0, and Z = 0.0, and white information is expressed by X = 95.05, Y = 100.0, and Z = 108.91 in case of a D65 light source. As the 3D information, equations (5.1) to (5.4) (using D65 as white) and equation (6) are used to calculate LCh values based on XYZ values ranging from (0.0, 0.0, 0.0) to (95.05, 100.0, 108.91) and, for example, C values corresponding to maximum saturation levels in 10-step increments of L and h values are stored. [Inside/outside Determination of Visual Limit Range]<br>
Fig. 5 is a flow chart showing a process for determining whether a color falls inside or outside the visual limit range in step S204.<br>
A gamut inside/outside determination flag OUT is initialized (S401), and it is checked if an X value of<br><br>
image data is smaller than the lower limit value Xk of the visual limit range (S402). Likewise, it is sequentially checked if a Y value is smaller than the lower limit value Yk (S403), if a Z value is smaller than the lower limit value Zk, if the X value is larger than the upper limit value Xw of the visual limit range (S405), if the Y value is larger than the upper limit value Yw (S406), and if the Z value is larger than the upper limit value Zw (S407).  If it is determined in any of these steps that the value of interest is smaller than the lower limit value or is larger than the upper limit value, the flow advances to step S408; otherwise, the process ends.<br>
If it is determined in any of these steps that the value of interest is smaller than the lower limit value or is larger than the upper limit value, ' 1' indicating outside the gamut is set in the gamut inside/outside determination flag OUT (S408), thus ending the process. [Color Conversion]<br>
Fig. 6 is a flow chart showing the color conversion process in step S206, Fig. 7 shows a color conversion method setup window 601 as a user interface window used to set a color conversion method, and Fig. 8 is a graph for explaining the color conversion method.<br>
Since the calculation results of the above<br><br>
equations are scaled so that Y falls within the range from 0 to 1, XYZ values are respectively multiplied by 100 to adjust the scale (S501), and the color conversion unit 8 converts the XYZ values into Lab values (S502) by:<br>
if Y/Yn &gt; 0.56,<br>
L*   =   116(Y/Yn)l/3	. . .(5.1)<br>
if  Y/Yn  
L* = 903.29(Y/Yn)	...(5.2)<br>
where Y: the Y value of a tristimulus value on the XYZ color system<br>
Yn: the Y value based on standard light of a perfect reflecting diffuser<br>
a* = 500[f(X/Xn) - f(Y/Yn)]<br>
b* = 200[f(X/Xn) - f(Z/Zn)]	...(5.3)<br>
for<br>
if X/Xn &gt;	0.56,<br>
f(X/Xn) =	(X/Xn)1/3<br>
if X/Xn 
f(X/Xn) =	7.78(X/Xn) + 16/116<br>
if Y/Yn &gt;	0.56,<br>
f(Y/Yn) =	(Y/Yn)1/3	...(5.4)<br>
if Y/Yn <.></.>
f(Y/Yn) =	7.78(Y/Yn) + 16/116<br>
If Z/Zn &gt;	0.56,<br>
f(Z/Zn) =	(Z/Zn)1/3<br>
if Z/Zn 
 <br>
f(Z/Zn) = 7.78(Z/Zn) + 16/116 where<br>
X, Y, and Z: tristimulus values X, Y, Z on the XYZ color system<br>
Xn, Yn, and Zn: X, Y, and Z values based on standard light of the perfect reflecting diffuser<br>
Note that the conversion in step S502 uses Xn = 95.05, Yn = 100.0, and Zn = 108.91 since D65 is used as white.  Next, the color coordinate conversion unit 8 converts the Lab values into LCh values (S503) using:<br>
L = L*<br>
Cab = v^(a*2 + b*2)	...(6)<br>
hab = tan"1(b*/a*)<br>
A user interface shown in Fig. 7 is presented to make the user set a color conversion method (S504).  A color conversion method setup window 601 includes a basic setup window 602 used to select a basic color conversion method.  When the user wants to set the color conversion method in more detail (to set a preferential conversion method in addition to the basic setup), he or she checks a detailed setup check box 603 and selects a preferential conversion condition using radio buttons on a detailed setup window 604. Note that "hue preservation" is selected as basic color conversion, and "gradation preference" is selected as the conversion condition in the example of Fig. 7.<br>
Upon completion of the setups, the user presses<br><br>
an "OK" button 605.  If the user wants to cancel the setups, he or she presses a "cancel" button 606,<br>
The color conversion unit 10 executes color conversion in accordance with the set color conversion method (and conversion condition) (S505).  Fig. 8 shows the color conversion executed in step S505, and shows a color conversion direction when "hue preservation" is selected as the basic color conversion method. Note that the ordinate plots lightness L, and the abscissa plots saturation C and also a visual limit range 700 read in step S303.<br>
In Fig. 8, when "saturation preference" is selected, an input color 701 is converted into a color on an inframarginal portion 702 of the visual limit range 700 so as not to change saturation.  Likewise, when "color difference preference" is selected, the input color 701 is converted into a color on an inframarginal portion 703 so as to minimize the color difference; when "gradation preference" is selected, the input color 701 is converted into a color on an inframarginal portion 704 so as not to change gradation; or when "lightness preference" is selected, the input color 701 is converted into a color on an inframarginal portion 705 so as not to change lightness.<br>
The color coordinate conversion unit 8 converts the LCh values that have undergone the color conversion<br><br>
into Lab values using an inverse conversion equation of equation (6) (S506), converts the Lab values into XYZ values using inverse conversion equations of equations (5.1) to (5.4) (S507), and divides the XYZ values by 100 to set the original scale (S508), thus ending the process.<br>
As described above, it is checked using black information and white information of the visual limit range whether or not input color data falls inside or outside the visual limit range, and color data outside the visual limit range undergoes color conversion in accordance with the conversion method (and conversion condition) set by the user. Hence, the color outside the visual limit range can be converted into a color on the inframarginal portion of the visual limit range while preserving tincture or the like as much as possible.<br>
Mapping into the visual limit range is .required to convert a pixel having a color outside the visual limit range into that having a color inside the visual limit range, since image data must be finally visually observed by a person.  If mapping of the first embodiment is not made, since a conversion destination within the visual limit range of a color outside the visual limit range is unknown, that color alone is converted into a different color, and connection with surrounding pixels deteriorates, thus considerably<br><br>
impairing the image quality. When the color conversion process of gradation-preferential hue preservation is executed like in the first embodiment, a color outside the visual limit range is processed so as not to change its tincture as much as possible. Hence, connection with surrounding pixels can be prevented from deteriorating.<br>
Second Embodiment<br>
An image processing apparatus according to the second embodiment of the present invention will be described below. Note that the same reference numerals in the second embodiment denote the same parts as in the first embodiment, and a detailed description thereof will be omitted. [Arrangement]<br>
Fig. 9 is a block diagram showing the arrangement of the image processing apparatus 1 of the second embodiment.<br>
An internal process gamut storage unit 14 is a nonvolatile memory such as a ROM, hard disk, or the like, which stores an internal process gamut having three, R, G, and B points as vertices. Note that the internal process gamut storage unit 14 stores the RGB values of black and white, which are normalized to 0 to 1, as will be described in detail later. Also, the unit 14 stores LCh values as a 3D range.<br><br>
[Processing]<br>
Fig. 10 is a flow chart showing the image process of the image processing apparatus 1. This image process is executed by the CPU of the image processing &gt;  apparatus 1.<br>
When image data is input from the image input device 2 via the image input unit 5, the image data is written in the data buffer 11 (S1201). The input image data undergoes color coordinate conversion into internal process RGB values via XYZ values by the color coordinate conversion unit 8 (S1202) .  In this embodiment, scRGB is used as color coordinate values of the input image data.  Therefore, color coordinate conversion in step SI202 uses equations (1) and (2),<br><br>
Note that the converted RGB value may undergo a gamma conversion process as needed.<br>
Gamut information of an internal process color signal is read out from the internal process gamut storage unit 14 (S1203), and the gamut inside/outside determination unit 9 determines whether the image data which has undergone the color coordinate conversion falls inside or outside the internal process gamut (S1204).  If the determination result indicates that<br><br>
the image data falls within the internal process gamut, the flow jumps to step S1207; otherwise, the flow advances to step S1206 (S1205).<br>
If it is determined that the image data falls outside the internal process gamut, the color conversion unit 10 converts that image data into image data corresponding to a color of an inframarginal portion of the internal process gamut, and writes the converted data at a corresponding location on the data buffer 11 (S1206) .  It is then determined if image data to be processed corresponds to the last pixel of the input image data (S1207) -  If the image data to be processed does not correspond to the last pixel, the flow returns to step S1204.<br>
If the image data corresponds to the last pixel, the image data stored in the data buffer 11 is output to the image display device 3 or image output device 4 via the image display unit 6 or image output unit 7 (S1208), thus ending the process. [Internal Process Gamut Information]<br>
Fig. 11 is a flow chart showing the process for reading the internal process gamut information in step S1203.<br>
The RGB values of black as the lower- limit of the internal process gamut are read from the internal process gamut storage unit 12, and cure set in registers Rk, Gk, and Bk (S1301).  Likewise, the RGB values of<br><br>
white as the upper limit of the internal process gamut are read, and are set in registers Rw, Gvf and Bw (S1302). Next, 3D information (LCh values) of the internal process gamut are read (S1303), thus ending the process.<br>
Figs. 12A and 12B show an example of the internal process gamut information stored in the internal process gamut storage unit 14, and respectively show the RGB values of black information and white information of the internal process gamut (Fig. 12A) and the LCh values of 3D information of the internal process gamut (Fig. 12B).  For example, black information is expressed by R = 0.0, B = 0.0, and B = 0.0, and white information is expressed by R = 1.0, G = 1.0, and B = 1.0. As the 3D information, after XYZ values obtained by inverse conversion of equation (7) using the RGB values ranging from (0.0, 0.0, 0.0) to (1.0, 1.0, 1.0) are multiplied by 100, equations (5.1) to (5.4) (using D65 as white) and equation (6) are used to calculate LCh values based on those XYZ values and, for example, C values corresponding to maximum saturation levels in 10-step increments of L and h values are stored.<br>
[Inside/outside Determination of Internal Process Gamut]<br>
Fig. 13 is a flow chart showing the process for determining whether a color falls inside or outside an<br><br>
internal process gamut in step S1204.<br>
A gamut inside/outside determination flag OUT is initialized (S1401), and it is checked if an R value of image data is smaller than the lower limit value Rk of the internal process gamut (S1402). Likewise, it is sequentially checked if a G value is smaller than the lower limit value Gk (S1403), if a B value is smaller than the lower limit value Bk, if the R value is larger than the upper limit value Rw of the internal process gamut (S1405), if the G value is larger than the upper limit value Gw (S1406), and if the B value is larger than the upper limit value Bw (S1407).  If it is determined in any of these steps that the value of interest is smaller than the lower limit value or is larger than the upper limit value, the flow advances to step S1408; otherwise, the process ends.<br>
If it is determined in any of these steps that the value of interest is smaller than the lower limit value or is larger than the upper limit value, '1' indicating outside the gamut is set in the gamut inside/outside determination flag OUT (S1408), thus ending the process. [Color Conversion]<br>
Fig. 14 is a flow chart showing the color conversion process in step S1206.<br>
The color coordinate conversion unit 8 converts the RGB values of the internal process color signal<br><br>
into XYZ values using the inverse conversion equation of equation (7) (S1501). As in the first embodiment, since the calculation results of the above equations are scaled so that Y falls within the range from 0 to 1, XYZ values are respectively multiplied by 100 to adjust the scale (S1502), and the color conversion unit 8 converts the XYZ values into Lab values using equations (5.1) to (5.4) (S1503).  Note that the conversion in step S1503 uses Rn = 95.05, Gn = 100.0, and Bn = 108.91 since D65 is used as white.<br>
Next, the color coordinate conversion unit 8 converts the Lab values into LCh values using equation (6) (S1504), and the user interface shown in Fig. 7 is presented to make the user set a color conversion method (S1505).  Then, the color conversion unit 10 executes color conversion in accordance with the set color conversion method (S1506).<br>
The color coordinate conversion unit 8 converts the LCh values that have undergone the color conversion into Lab values using an inverse conversion equation of equation (6) (S1507), converts the Lab values into XYZ values using inverse conversion equations of equations (5.1) to (5.4) (S1508), and divides the XYZ values by 100 to set the original scale (S1509).<br>
Finally, the color coordinate conversion unit 8 converts the XYZ values into RGB values of the internal process color signal using equation (7), thus ending<br><br>
the process.<br>
In this manner, it is determined using black information and white information of the internal process gamut whether input color data falls inside or outside the internal process gamut, and the color data which falls outside the internal process gamut undergoes color conversion in accordance with the conversion method (and conversion condition) set by the user. Hence, a color that falls outside the internal process gamut can be converted into a color on the inframarginal portion of the internal process gamut while preserving its tincture as much as possible.<br>
Third Embodiment<br>
An image processing apparatus according to the third embodiment of the present invention will be described below. Note that the same reference numerals in the third embodiment denote the same parts as in the first embodiment, and a detailed description thereof will be omitted. [Arrangement]<br>
Fig. 15 is a block diagram showing the arrangement of the image processing apparatus 1 of the third embodiment.<br>
An image processing unit 15 executes image processes such as color correction and the like. A gamut mapping unit 16 maps the internal process gamut<br><br>
to the gamut of the image output device 4. An image output device gamut storage unit 17 stores LCh values as a 3D range, i.e., the gamut of the image output device 4, as will be described in detail later. [Processing]<br>
Fig. 16 is a flow chart showing the image process of the image processing apparatus 1.  This image process is executed by the CPU of the image processing apparatus 1.<br>
When image data is input from the image input device 2 via the image input unit 5, the image data is written in the data buffer 11 (S2201). The input image data undergoes color coordinate conversion into internal process RGB values via XYZ values by the color coordinate conversion unit 8 (S2202}.  In this embodiment, scRGB is used as color coordinate values of the input image data. Therefore, color coordinate conversion in step S2202 uses equations (1), (2), and (7).  Note that the converted RGB value may undergo a gamma conversion process as needed.<br>
As in the second embodiment, gamut information of an internal process color signal is read out from the internal process gcimut storage unit 14 (S2203), and the gamut inside/outside determination unit 9 determines whether the image data which has undergone the color coordinate conversion falls inside or outside the internal process gamut (S2204).  If the determination<br><br>
result indicates that the image data falls within the internal process gamut, the flow jumps to step S2207; otherwise, the flow advances to step S2206 (S2205).<br>
If it is determined that the image data falls outside the internal process gamut, the color conversion unit 10 converts that image data into image data corresponding to a color of an inframarginal portion of the internal process gamut, and writes the converted data at a corresponding location on the data buffer 11 (S2206) .  It is then determined if image data to be processed corresponds to the last pixel of the input image data (S2207).  If the image data to be processed does not correspond to the last pixel, the flow returns to step S2204.<br>
If the image data corresponds to the last pixel, the image processing unit 15 applies image processes such as gradation correction, color correction, and the like to the image data stored in the data buffer 11 (S2208), and the gamut mapping unit 16 maps the internal process gamut to the gamut of the image output device 4 (S2209). Then, the gamut-mapped image data is output to the image output device 4 via the image output unit 7 (S2210), thus ending the process. [Gamut Mapping]<br>
Fig. 17 is a flow chart showing the process for mapping the internal process gamut to the gamut of the image output device in step S2209.<br><br>
Internal process gamut information is read from the internal process gamut storage unit 14 (S2301). This gamut information includes the LCh values of 3D information of the internal process gamut, as has been<br>
5  explained using Figs. 12A and 12B. The 3D information to be read out includes C values corresponding to maximum saturation levels in 10-step increments of L and h values. Although not shown in Figs. 12A and 12B, the RGB values of an internal process color signal<br>
)      corresponding to these LCh values are also stored in the internal process gamut storage unit 14, and are read in step S2301.<br>
The gamut information of the image output device 4 is read from the image output device gamut storage unit 17 (S2302) . This gamut information includes L'C'hf values indicating the gamut of the image output device 4 as in the 3D information of the internal process gamut. The 3D information to be read out includes, for example, C values corresponding to maximum saturation levels in 10-step increments of L' and h' values. Also, the R'G'B' values of an image output color signal corresponding to these L'C'h' values are stored in the image output device gamut storage unit 17, and are read out in step S2302.<br>
The LCh values of the internal process gamut and the L'C'h' values of the gamut of the image output device 4 are obtained for each lightness L value and<br><br>
hue h value- The correspondence among the LCh values, L'C'h' values, RGB values, and R'G'B' values is determined to generate a 3D lookup table (3DLUT) (S2303).<br>
Using the 3DLUT, the gamut of an image to be processed is converted from the internal process gamut to the gamut of the image output device 4 (S2304) , thus ending the process.<br>
In this manner, it is determined using black information and white information of the internal process gamut whether input color data falls inside or outside the internal process gamut, and the color data which falls outside the internal process gamut undergoes color conversion in accordance with the conversion method (and conversion condition) set by the user.  Hence, a color that falls outside the internal process gamut can be converted into a color on the inframarginal portion of the internal process gamut and can be further converted into the gamut of the image output device 4 while preserving its tincture as much as possible.<br>
Modification<br>
In the above embodiments, the color conversion into the XYZ value uses conversion equations with Y which normalized to 0 to 1. However, the present invention is not limited to such specific equations,<br><br>
and Y may be normalized to 0 to 100.<br>
In the above embodiments, the color conversion method displayed on the interface window of Fig. 7 has been explained. However, the present invention is not limited to such specific color conversion method, and any other color conversion methods of user's choice may be used. Fig. 8 shows the conversion direction of each color conversion method, but the present invention is not limited to such specific conversion direction. The color after color conversion is that on the inframarginal portion of the gamut. Alternatively, a color may be converted into a color inside the gamut. Furthermore, the color coordinate system used in color conversion is not limited to the LCh coordinate system, and any other color systems may be used.  In the above embodiments, D65 is used as white, but the present invention is not limited to this.<br>
In the above embodiments, the selection method using buttons has been exemplified as the user interface window shown in Fig. 7. However, the present invention is not limited to such specific selection method, and a user interface window with which the user selects using, e.g., a drop-down menu may be adopted. Also, a user interface window to which the user directly inputs keywords may be used. Furthermore, the user may select a color after color conversion on the color coordinate system. That is, the configuration of<br><br>
the user interface is not particularly limited as long as the user can make setups of his or her choice.<br>
In the above embodiments, the LCh values are stored as gamut information.    However, the present invention is not limited to such specific information, and any other formats that can express a 3D gamut may be used. Also, the gamut information may be stored in accordance with a given format such as an ICC profile or the like.<br>
Fourth Embodiment<br>
Figs. 18A to 18D are block diagrams showing the arrangement of an image processing apparatus according to the fourth embodiment. Reference numeral 1001 denotes an input-side image processing apparatus of the fourth embodiment; 1002, a display-side image processing apparatus of the fourth embodiment; 1003, an output-side image processing apparatus of the fourth embodiment; 1004, an image input device such as a digital camera, color scanner, or the like, which is used to input an image; 1005, an image display device such as a CRT, LCD, or the like, which is used to display an image; and 1006, an image output device such as a color printer or the like, which is used to output an image.<br>
The internal arrangement of the input-side image processing apparatus 1001 will be explained first.<br><br>
Reference numeral 1011 denotes an interface (I/F) unit which is used to exchange data between the input-side image processing apparatus 1001 and other apparatuses; 1012, an image input unit for inputting image data input by the image input device 1004; 1013, a color coordinate conversion unit for performing color conversion between an image input device color space and color conversion work space, and color conversion between the color conversion work space, and a color expression space; 1014, an image compression unit for compressing the input image to reduce the data size upon exchanging the image with other apparatuses; 1015, a color correction unit for performing color correction of the input image; 1016, a gradation conversion unit for performing gradation conversion of the input image; and 1017, a data buffer for temporarily holding image data for image data processes. Note that these apparatus 1001 to 1003 are connected by a communication line 1007 such as a system bus, a local area network (LAN), a serial bus which conforms to or based on IEEE 1394 standards or Universal Serial Bus (USB) standards, or the like.<br>
Next, the internal arrangement of the display-side image processing apparatus 1002 will be explained- Reference numeral 1021 denotes an I/F unit for exchanging data between the display-side image processing apparatus 1002 and other apparatuses; 1022,<br><br>
an image display unit for displaying image data to be displayed on the image display device 1005; 1023, a color coordinate conversion unit for performing color conversion between an image display device color space and color conversion work space, and color conversion between the color conversion work space, and a color expression space; 1024, a color correction unit for performing color correction of the image; 1025, a gradation conversion unit for performing gradation conversion of the image; 1026, a gamut inside/outside determination unit for determining if a color falls inside/outside a gamut; 1027, a gamut compression unit for compressing the gamut; 1028, a data buffer for temporarily holding image data for image data processes; 1029, an image compression/expansion unit for compressing/expanding an image to reduce the data size upon exchanging the image with other apparatuses; 1210, a user interface (UI) unit for allowing the user to make image process operations using the display-side image processing apparatus 1002; and 1211, a range information storage unit for storing range information of the color conversion work space.<br>
The internal arrangement of the output-side image processing apparatus 1003 will be explained below. Reference numeral 1031 denotes an I/F unit for exchanging data between the output-side image processing apparatus 1003 and other apparatuses; 1032,<br><br>
an image output unit for outputting image data to be output by the image output device 1006; 1033, a color coordinate conversion unit for performing color conversion between a color conversion work space and color expression space; 1034, a color correction unit for performing color correction of the image; 1035, a gradation conversion unit for performing gradation conversion of the image; 1036, a color separation unit;<br>
1037,	a gamut inside/outside determination unit for determining if a color falls inside/outside a gamut;<br>
1038,	a gamut compression unit for compressing the gamut; 1039, a data buffer for temporarily holding image data for image data processes; 1310, an output gamut data storage unit for storing gamut information of the image output device 1006; 1311, an image expansion unit for expanding an image input from another apparatus; and 1312, a range information storage unit for storing range information of the color conversion work space.<br>
[Overall Processing]<br>
Fig. 19 is a flow chart of image processes executed by the input-side image processing apparatus 1001, display-side image processing apparatus 1002, and output-side image processing apparatus 1003.  The color conversion processes executed in the input-side image processing apparatus 1001, display-side image processing apparatus 1002, and output-side image<br><br>
processing apparatus 1003 will be described in detail below using the flow chart of Fig. 19-  In step S1201, the input-side image processing apparatus 1001 executes image processes.  In step S1202, the display-side image processing apparatus 1002 executes image processes.  In step S1203, the output-side image processing apparatus 1003 executes image processes, thus ending the processes. [Process in Input-side Image Processing Apparatus]<br>
Fig. 20 is a flow chart for explaining the image processes executed in the input-side image processing apparatus 1001 in step S1201. A detailed explanation will be given below using the flow chart of Fig. 20.<br>
In step S1301, the image input unit 1012 inputs an image using the image input device 100 4.  In step S1302, the input image data is written in the data buffer 1017.  In step S1303, the color coordinate conversion unit 1013 performs color coordinate conversion from an input device color space RiGiBi (RGB values normalized to 0 to 1) into a color conversion work space RIGIBI (RGB values normalized to 0 to 1) used to execute the color conversion process inside the input-side image processing apparatus 1001.  This<br><br>
Rl Gl 51<br>
conversion uses:<br>
all    all    al3<br>
a2l   a22   a23 a3l   a32   a33<br><br>
RL Gi Bi<br><br>
...(H)<br><br>
Note that coefficients all to a33 in equation (11) are determined in advance.<br>
The input device color space RiGiBi includes a color signal having color characteristics unique to the image input device 1004, and the color conversion work space RIGIBI includes a color signal having a gamut that contains those of image input/output devices, and<br><br>
Rl Gl 51<br>
is defined by:<br>
bll bl2 bl3 bll b22 623 Ml b32   b33<br><br>
X Y Z<br><br>
...(12)<br><br>
The color conversion work space may use Rl'Gl'Bl' as values after gamma conversion of RIGIBI.<br>
In step S1304, the gradation conversion unit 1016 executes gradation correction process for correcting gradation characteristics unique to the image input device 1004, and converting input image data into desired gradation characteristic data. In step S1305, the color correction unit 1015 executes color correction processes for correcting color characteristics unique to the image input device 1004, and converting input image data into desixed color characteristic data. In step S1306, the color coordinate conversion unit 1013 performs a color coordinate conversion process from the color conversion work space RIGIBI onto a color expression space scRGB<br>
used to exchange data with other apparatuses.  Note<br><br>
that the color expression space scRGB can express a whole visual range. This conversion uses equations<br><br>
The color expression space scRGB (relative scene RGB color space) given by equation (14) adopts D65 as a white reference point. When the color conversion work space R1G1B1 has a white reference point other than D65, XYZ data undergo a white conversion process to D65<br><br>
In step S1307, the image compression unit 1014 compresses the image data to reduce the transfer load upon exchanging the image with other apparatuses. In step S1308, the I/F unit 1011 outputs the image to other apparatuses, thus ending the process . [Process in Display-side Image Processing Apparatus]<br>
Fig. 21 is a flow chart for explaining the image<br><br>
processes executed in the display-side image processing apparatus 1002 in step S1202. A detailed explanation will be given below using the flow chart of Fig. 21.<br>
In step S2401, the image input unit 1021 inputs an image.  In step S2402, the input image data is written in the data buffer 1028.  In step S2403, the image compression/expansion unit 1029 expands the input compressed image data.  In step S2404, the color coordinate conversion unit 1023 performs color coordinate conversion from the color expression space scRGB into a color conversion work space R1G1B1 (RGB values normalized to 0 to 1) used to execute the color conversion process in the display-side image processing apparatus 1002. This conversion uses equation (12)<br><br>
Note that the color conversion work space may use Rl'Gl'Bl1 as values after gamma conversion of R1G1B1. In step S2405, range information of the color conversion work space is read out from the range information storage unit 1211. The gamut inside/outside determination unit 1026 determines in<br><br>
step S2406 whether the color signal that has undergone color coordinate conversion in step S2404 falls inside or outside the color conversion work space range.  It is checked in step S2407 whether or not the determination result in step S2406 indicates inside the range.  If the determination result indicates inside the range, the flow jumps to step S2409; otherwise, the flow advances to step S2408.<br>
In step S2408, the gamut compression unit 1011 compresses the color signal, which is determined in step S2406 to fall outside the color conversion work space range, to the inframarginal portion of the color conversion work space range.  It is then determined in step S2409 if a pixel to be processed is the last pixel of the input image data.  If the pixel to be processed is not the last pixel, the flow returns to step S2406; otherwise, the flow advances to step S2410.  In step S2410, the gradation conversion unit 1025 and color correction unit 1024 respectively execute the gradation conversion process and color correction process for converting image data into desired gradation characteristic data and desired color characteristic data.  It is checked in step S2411 if the processed image data is to be displayed on the image display device 1005.  If the image data is to be displayed, the flow advances to step S2415; otherwise, the flow advances to step S2412.<br><br>
In step S2412, the color coordinate conversion unit 1023 executes the color coordinate conversion process from the color conversion work space R1G1B1 into the color expression space scRGB used to exchange data with other apparatuses. This conversion uses equations (13) to (15). As described above, the color expression space scRGB given by equation (14) adopts D65 as a white reference point. When the color conversion work space R1G1B1 has a white reference point other than D65, XYZ data undergo a white conversion process to D65 before conversion of equation (14 ) .  In step S2413, the image compression/expansion unit 1029 compresses image data to reduce the transfer load upon exchanging the image with other apparatuses. In step S2414, the I/F unit 1021 outputs the image to other apparatuses, thus ending this process.  In step S2415, the color coordinate conversion unit 1023 executes the color coordinate conversion process from the color conversion work space R1G1B1 into an image display device color space RdGdBd. This conversion<br><br>
In step S2416, the image display unit 1022 displays the image using the image display device 1005, thus ending this process.<br><br>
[Process in Output-side Image Processing Apparatus]<br>
Fig- 22 is a flow chart for explaining the image processes executed in the output-side image processing apparatus 1003 in step S1203. A detailed explanation will be given below using the flow chart of Fig. 22.<br>
In step S2501, the I/F unit 1031 inputs an image. In step S2502, the input image data is written in the data buffer 1039.  In step S2503, the image expansion unit 1311 expands the input compressed image data.  In step S2504, the color coordinate conversion unit 1033 performs color coordinate conversion from the color expression space scRGB into a color conversion work space R1G1B1 (RGB values normalized to 0 to 1) used to execute the color conversion process in the output-side image processing apparatus 1003.  This conversion uses equations (16) to (17), and equation (12).  Note that the color conversion work space may use Rl'Gl'Bl' as values after gamma conversion of R1G1B1.<br>
In step S2505, range information of the color conversion work space is read out from the range information storage unit 1312. The gamut inside/outside determination unit 1037 determines in step S2506 whether the color signal that has undergone color coordinate conversion in step S2504 falls inside or outside the color conversion work space range.  It is checked in step S2507 whether or not the determination result in step S2506 indicates inside the<br><br>
range.  If the determination result indicates inside the range, the flow jumps to step S2509; otherwise, the flow advances to step S2508.  In step S2508, the gamut compression unit 1038 compresses the color signal, which is determined in step S2506 to fall outside the color conversion work space range, to the inframarginal portion of the color conversion work space range.  It is then determined in step S2509 if a pixel to be processed is the last pixel of the input image data. If the pixel to be processed is not the last pixel, the flow returns to step S2506; otherwise, the flow advances to step S2510.<br>
In step S2510, the gradation conversion unit 1035 and color correction unit 1034 respectively execute the gradation conversion process and color correction process for converting image data into desired gradation characteristic data and desired color characteristic data.  In step S2511, the color conversion work space R1G1B1 undergoes gamut compression to an output device color space RoGoBo. The gamut compression uses a conversion table stored in the output gamut data storage unit 1310.  This conversion table is, e.g., a 3D LUT. In step S2512, the color separation unit 1036 separates the output device color space RoGoBo into color signals unique to the output device.  In step S2513, the gradation conversion unit 1035 executes a gradation conversion<br><br>
process such as halftoning or the like.  In step S2514, the image output unit 1032 outputs the image using the image output device 1006, thus ending this process. [Read Range Information of Color Conversion Work Space]<br>
Fig. 23 is a flow chart of the process for reading out the range information of the color conversion work space from the range information storage units 1211 and 1312 in steps S2405 and S2505. A detailed explanation will be given using the flow chart of Fig. 23.<br>
In step S1601, the RGB values of black as the lower limit values of the color conversion work space are read from the range information storage unit 1211 (1312) and are set in Rk, Gk, and Bk.  In step S1602, the RGB values of white as the upper limit values of the color conversion work space are read from the range information storage unit 1211 (1312) and are set in Rw, Gw, and Bw.  In step S1603, 3D information (LCh values) of the color conversion work space are read, thus ending the process.<br>
Figs. 27A and 27B show the RGB values of black information and white information of the color conversion work space and the LCh values of 3D information of the color conversion work space as an example of the color conversion work space information stored in the range information storage units 1211 and 1312.  For example, black information is expressed by R<br><br>
= 0.0, B = 0.0, and B = 0.0, and white information is expressed by R = 1.0, G = 1.0, and B = 1.0.  As the 3D information, after XYZ values obtained by equation (13) using the RGB values ranging from (0.0, 0.0, 0.0) to (1.0, 1.0, 1.0) are multiplied by 100, equations (19.1) to (19.4) (using D65 as white) and equation (20) are used to calculate LCh values based on those XYZ values and, for example, C values corresponding to maximum saturation levels in 10-step increments of L and h values are stored.  As the 3D information, for example, C values corresponding to maximum saturation levels in 10-step increments of L and h values are stored.<br>
if Y/Yn &gt; 0.008856,<br>
L*   =   116(Y/Yn)1/3   -   16	...(19.1)<br>
if  Y/Yn   
L* = 903.29(Y/Yn)	...(19.2)<br>
where Y: the Y value of a tristimulus value on the XYZ color system<br>
Yn: the Y value based on standard light of a perfect reflecting diffuser<br>
a* = 500[f(X/Xn) - f(Y/Yn)]<br>
b* = 200[f(X/Xn) - f(Z/Zn)]	...(19.3)<br>
for<br>
if X/Xn &gt; 0.008856,<br>
f(X/Xn) = (X/Xn)1/3<br>
if X/Xn 
f(X/Xn) = 7.78(X/Xn) + 16/116<br><br>
if Y/Yn &gt; 0.008856,<br>
f(Y/Yn) = (Y/Yn)1/3	. ..(19.4)<br>
if Y/Yn <s></s>
f(Y/Yn) = 7.78(Y/Yn) + 16/116<br>
If Z/Zn &gt; 0.008856,<br>
f(Z/Zn) = (Z/Zn)1/3<br>
if Z/Zn 
f(Z/Zn) = 7.78(Z/Zn) + 16/116<br>
Note that Xn = 95.05, Yn = 100.0, and Zn = 108.91 since D65 is used as white.  Next, the Lab values are converted into LCh values using:<br>
C'ab = /(a*2 + b*2)	...(20)<br>
hab = tan'l(b*/a*) [Inside/outside Determination Process of Color Conversion Work Space Range]<br>
Fig. 24 is a flow chart showing the process executed in the gamut inside/outside determination units 1026 and 1037 to determine in steps S2406 and S2506 whether a color signal falls inside or outside the color conversion work space range. A detailed explanation will be given using the flow chart of Fig. 24.<br>
A gamut inside/outside determination flag OUT is initialized in step S1701.  It is checked in step S1702 if the R value of a pixel to be processed is smaller than the lower limit value Rk of the color conversion work space.  If R 
 <br>
S1708; otherwise, the flow advances to step S1703.  It is checked in step S1703 if the G value of the pixel to be processed is smaller than the lower limit value Gk of the color conversion work space.  If G  Rw, the flow advances to step S1708; otherwise, the flow advances to step S1706.  It is checked in step S1706 if the G value of the pixel to be processed is larger than the upper limit value Gw of the color conversion work space.  If G &gt; Gw, the flow advances to step S1708; otherwise, the flow advances to step S1707.  It is checked in step S1707 if the B value of the pixel to be processed is larger than the upper limit value Bw of the color conversion work space.  If B &gt; Bw, the flow advances to step S1708; otherwise, the process ends.  In step S1708, ' l1 indicating outside the gamut is set in the gamut inside/outside determination flag OUT, thus ending the process. [Color Conversion into Color Conversion Work Space]<br><br>
Fig, 25 is a flow chart of the gamut compression executed by the gamut compression units 1027 and 1038 to convert a color signal which is determined to fall outside the color conversion work space to the inframarginal portion of the color conversion work space in steps S2408 and S2508. A detailed explanation will be given using the flow chart of Fig. 25.<br>
In step S1801, the R1G1B1 values of the color conversion work space color signal are converted into XYZ values using equation (13).  In step S1802, the XYZ values are respectively multiplied by 100 to adjust the scale (since the calculation results of the above equations are scaled so that Y falls within the range from 0 to 1).  In step S1803, the XYZ values are converted into Lab values using equations (19-1) to (19.4).  The conversion in step S1803 uses Rn = 95.05, Gn = 100.0, and Bn = 108.91 since D65 is used as white. In step S1804# the Lab values are converted into LCh values using equation (20).<br>
In step S1805, the user interface shown in Fig. 7 is presented to set a color conversion method. On a color conversion method setup window 601, a basic color conversion method is set using a basic setup window 602 used to select. When the user wants to set the color conversion method in more detail (to set a preferential conversion method in addition to the basic setup), he or she checks a detailed setup check box 603 and makes<br><br>
detailed setups on a detailed setup window 604. Note that "hue preservation conversion" is set as basic color conversion, and "gradation preference" is set as another preferential setup in Fig. 7. Upon completion of the setups, the user presses an OK button 605.  If the user wants to cancel the setups, he or she presses a cancel button 606.<br>
In step S1806, color conversion is performed in accordance with the color conversion method set in step S1805.  Fig. 26 shows the color conversion process executed in step S1806, and shows a color conversion direction when "hue preservation" is selected as the basic color conversion method. Note that the ordinate plots lightness L, and the abscissa plots saturation C and also a color conversion work space 3000 read in steps S2405 and S2505. When "saturation preference" is selected on the detailed setup window 604, an input color 3001 is converted into a color on an infreunarginal portion 3002 of the color conversion work space so as not to change saturation. When "color difference preference" is selected, the input color 3001 is converted into a color on an inf ramarginal portion 3003 of the color conversion work space so as to minimize the color difference. When "gradation preference" is selected, the input color 3001 is converted into a color on an inf ramarginal portion 3004 of the color conversion work space so as not to change<br><br>
gradation. When "lightness preference" is selected, the input color 3001 is converted into a color on an inframarginal portion 3005 of the color conversion work space so as not to change lightness.<br>
In step S1807, the LCh values are converted into Lab values using the inverse conversion equation of equation (20).  In step S1808, the Lab values are converted into XYZ values using the inverse conversion equations of equations (19.1) to (19.4).  In step S1809, the XYZ values are divided by 100 to set the original scale.  In step S1810, the XYZ values are converted into R1G1B1 values of the color conversion work space signal, thus ending the process.<br>
As described above, according to the fourth embodiment, upon exchanging image data among color image input/output devices or in image processes such as color conversion and the like, the color expression space that can express the whole visual range is used to exchange image data between the devices, and the color conversion work space that includes the gamut of the device is independently used in the color conversion process inside the device. Hence, the image input device, image display device, and image output device can exchange data of the visual range, and can execute color conversion suited to each individual device.<br><br>
Fifth Embodiment<br>
Fig. 28 is a block diagram showing the arrangement of the input-side image processing apparatus 1001 and the output-side image processing apparatus 1003 according to the fifth embodiment. Since the names and functions of the respective units are the same as those in the fourth embodiment, a description thereof will be omitted. The difference from the fourth embodiment is that this embodiment comprises only the input-side image processing apparatus 1001 and output-side image processing apparatus 1003. [Overall Processing]<br>
Fig. 29 is a flow chart of image processes executed by the input-side image processing apparatus 1001 and output-side image processing apparatus 1003. The color conversion processes executed in the input-side image processing apparatus 1001 and output-side image processing apparatus 1003 will be described in detail below using the flow chart of Fig. 29. In step S2301, the input-side image processing apparatus 1001 executes image processes.  In step S2302, the output-side image processing apparatus 1003 executes image processes, thus ending the processes. Note that the processing contents in step S2301 are the same as those in step S1201, and the processing contents in step S2302 are the same as those<br><br>
in step S1203.<br>
As described above, according to the fifth embodiment, upon exchanging image data between color image input/output devices or in image processes such as color conversion and the like, the color expression space that can express the whole visual range is used to exchange image data between the devices, and the color conversion work space that includes the gamut of the device is independently used in the color conversion process inside the device. Hence, the image input device and image output device can exchange data of the visual range, and can execute color conversion suited to each individual device.<br>
Sixth Embodiment<br>
Figs. 30A to 30D are block diagrams showing the arrangement of the input-side image processing apparatus 1001, display-side image processing apparatus 1002, and output-side image processing apparatus 1003. A description of units which have the same names and functions as those in the fourth embodiment will be omitted.<br>
The internal arrangement of the input-side image processing apparatus 1001 will be described first. Reference numeral 1018 denotes a color space information setting unit for setting a color conversion work space used inside the input-side image processing<br><br>
apparatus 1001; and 1019, a UI unit for allowing the user to set color space information.<br>
The internal arrangement of the display-side image processing apparatus 1002 will be described below.  Reference numeral 1210 denotes a UI unit for allowing the user to set color space information; and 1212, a color space information setting unit for setting a color conversion work space used inside the display-side image processing apparatus 1002.<br>
The internal arrangement of the output-side image processing apparatus 1003 will be described below. Reference numeral 1313 denotes a color space information setting unit for setting a color conversion work space used inside the output-side image processing apparatus 1003; and 1314, a UI unit for allowing the user to set color space information. [Overall Processing]<br>
Fig. 31 is a flow chart of image processes executed by the input-side image processing apparatus 1001, display-side image processing apparatus 1002, and output-side image processing apparatus 1003. The color conversion processes executed in the input-side image processing apparatus 1001, display-side image processing apparatus 1002, and output-side image processing apparatus 1003 will be described in detail below using the flow chart of Fig. 31.<br>
In step S2501, the color space information<br><br>
setting unit 1018 sets a color expression space used to exchange data with other apparatuses, and a color conversion work space used inside the input-side image processing apparatus 1001.  In step S2502, the input-side image processing apparatus 1001 executes image processes-  In step S2503, the color space information setting unit 1212 sets a color expression space used to exchange data with other apparatuses, and a color conversion work space used inside the display-side image processing apparatus 1002.  In step S2504, the display-side image processing apparatus 1002 executes image processes.  In step S2505, the color space information setting unit 1313 sets a color expression space used to exchange data with other apparatuses, and a color conversion work space used inside the output-side image processing apparatus 1003. In step S2506, the output-side image processing apparatus 1003 executes image processes, thus ending the process. Note that the processing contents in step S2502 are the same as those in step S1201, the processing contents in step S2504 are the same as those in step S1202, and the processing contents in step S2506 are the same as those in step S1203. [Color Space Information Setup User Interface]<br>
Fig. 32 shows an example of a user interface used when the user sets a color expression space used to exchange data with other apparatuses, and a color<br><br>
conversion work space used inside the respective image processing apparatuses using the color space information setting units 1018, 1212, and 1313. On a color expression space setup window 1602, a color expression space used to exchange data with other apparatuses is set.  In this case, as examples of the color expression space, sRGB, scRGB , bg-sRGB, and a color space which can be customized by the user are presented, and scRGB is selected as the color expression space. On a color conversion work space setup window 1603, a color conversion work space used in each image processing apparatus is set.  In this case, as examples of the color conversion work space, sRGB, RGB2, RGB3, RGB4, and RGB5 are presented, and RGB2 is selected as the color conversion work space. Upon completion of the setups, the user presses an OK button 1604.  If the user wants to cancel the setups, he or she presses a cancel button 1605.<br>
As described above, according to the sixth embodiment, upon exchanging image data among color image input/output devices or in image processes such as color conversion and the like, the user can individually set a color expression space used to exchange image data between the devices, and a color conversion work space used in the color conversion process inside the device.<br><br>
Seventh Embodiment<br>
Fig. 33 shows an example of image data to be exchanged among the input-side image processing apparatus 1001, display-side image processing apparatus 1002, and output-side image processing apparatus 1003. The color expression space information and color conversion work space information set in the fourth to sixth embodiments are appended to image data, and the processes in each image processing apparatus use the appended information to execute color conversion processes. As the information to be appended, the color expression space information includes definition equations (14) to (17) or their coefficients, and the color conversion work space information includes definition equations (12) and (13), their coefficients, or information shown in Figs. 27A and 27B.<br>
As described above, according to the seventh embodiment, upon exchanging image data among color image input/output devices or in image processes such as color conversion and the like, a color expression space used to exchange image data between the devices, and a color conversion work space used in the color conversion process inside the device can be individually set by appending them to an image.<br><other embodiment><br>
The present invention can be applied to a system constituted by a plurality of devices (e.g., host<br><br>
computer, interface, reader, printer) or to an apparatus comprising a single device (e.g., copying machine, facsimile machine).<br>
Further, the object of the present invention can also be achieved by providing a storage medium storing program codes for performing the aforesaid processes to a computer system or apparatus (e.g., a personal computer), reading the program codes, by a CPU or MPU of the computer system or apparatus, from the storage medium, then executing the program.<br>
In this case, the program codes read from the storage medium realize the functions according to the embodiments, and the storage medium storing the program codes constitutes the invention.<br>
Further, the storage medium, such as a floppy disk, a hard disk, an optical disk, a magneto-optical disk, CD-ROM, CD-R, a magnetic tape, a non-volatile type memory card, and ROM can be used for providing the program codes.<br>
Furthermore, besides aforesaid functions according to the above embodiments are realized by executing the program codes which are read by a computer, the present invention includes a case where an OS (operating system) or the like working on the computer performs a part or entire processes in accordance with designations of the program codes and realizes functions according to the above embodiments.<br><br>
Furthermore, the present invention also includes a case where, after the program codes read from the storage medium are written in a function expansion card which is inserted into the computer or in a memory provided in a function expansion unit which is connected to the computer, CPU or the like contained in the function expansion card or unit performs a part or entire process in accordance with designations of the program codes and realizes functions of the above embodiments.<br>
As many apparently widely different embodiments of the present invention can be made without departing from the spirit and scope thereof, it is to be understood that the invention is not limited to the specific embodiments thereof except as defined in the claims.<br><br><br><br>
WE CLAIM :<br>
1.	A method of processing image data, comprising the steps of;<br>
inputting image data represented in a colour space that is adapted to represent a value exceeding a visual limit range, wherein the visual limit range is the human visible range;<br>
determining whether or not the input image data falls outside the human visible range based on information of the visual limit range; and<br>
converting image data, which is determined to fall outside the human visible range into image data representing a colour in the visual limit range.<br>
2.	The method according to claim 1, wherein the human visible range is a region in an xy chromaticity diagram, which is surrounded in a spectrum locus and a purple boundary.<br>
3.	The method according to claim 1, comprising the step of setting a conversion method of the converting step.<br>
4.	The method according to claim 3, wherein the conversion method has at least one of colour difference minimization, lightness preservation^ hue preservation and saturation preservation.<br>
5.	An image processing apparatus comprising :<br>
an input unit (5) arranged to input image data represented in a colour space that is adapted to represent a value exceeding a visual limit range, wherein the visual limit range is the human visible range;<br>
a determination unit (9) arranged to determine whether or not the input image data falls outside the u" VIQJMA ranee based on information of the visual limit range; and<br><br>
a conversion unit (10) arranged to convert image data, which is determined to fall outside the human visible range, into image data representing a colour in the visual limit range.<br><br></other></td>
			</tr>
		</table>	
		<br>
		<h3>Documents:</h3>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWFic3RyYWN0LnBkZg==" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-abstract.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWNsYWltcyBkdXBsaWNhdGUucGRm" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-claims duplicate.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWNsYWltcyBvcmlnaW5hbC5wZGY=" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-claims original.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWNvcnJlc3BvbmRuZWNlLW90aGVycy5wZGY=" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-correspondnece-others.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWNvcnJlc3BvbmRuZWNlLXBvLnBkZg==" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-correspondnece-po.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWRlc2NyaXB0aW9uKGNvbXBsZXRlKSBkdXBsaWNhdGUucGRm" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-description(complete) duplicate.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWRlc2NyaXB0aW9uKGNvbXBsZXRlKSBvcmlnaW5hbC5wZGY=" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-description(complete) original.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWRyYXdpbmdzLnBkZg==" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-drawings.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWZvcm0gMS5wZGY=" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-form 1.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWZvcm0gMjYucGRm" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-form 26.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWZvcm0gMy5wZGY=" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-form 3.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LWZvcm0gNS5wZGY=" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-form 5.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LW90aGVyIGRvY3VtZW50cy5wZGY=" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-other documents.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTk2OS1jaGVucC0yMDA0LXBjdC5wZGY=" target="_blank" style="word-wrap:break-word;">1969-chenp-2004-pct.pdf</a></p>
		<br>
		<div class="pull-left">
			<a href="205693-method-and-plant-for-manufacturing-cement-clinker.html">&laquo; Previous Patent</a>
		</div>
		<div class="pull-right">
			<a href="205695-a-method-of-removing-mercury-from-flue-gas.html">Next Patent &raquo;</a>
		</div>			
	</div><!-- /span8 -->
	<div class="span4">
		<div class="well infobox">
			<table class="table table-condensed">
				<tr>
					<th>Patent Number</th>
					<td>205694</td>
				</tr>
				<tr>
					<th>Indian Patent Application Number</th>
					<td>1969/CHENP/2004</td>
				</tr>
				<tr>
					<th>PG Journal Number</th>
					<td>26/2007</td>
				</tr>
				<tr>
					<th>Publication Date</th>
					<td>29-Jun-2007</td>
				</tr>
				<tr>
					<th>Grant Date</th>
					<td>09-Apr-2007</td>
				</tr>
				<tr>
					<th>Date of Filing</th>
					<td>03-Sep-2004</td>
				</tr>
				<tr>
					<th>Name of Patentee</th>
					<td>M/S. CANON KABUSHIKI KAISHA</td>
				</tr>
				<tr>
					<th>Applicant Address</th>
					<td>3-30-2, Shimomaruko, Ohta-ku, Tokyo 146-8501</td>
				</tr>
				<tr>
					<td colspan=2>
								<h5>Inventors:</h5>
								<table class="table">
									<tr>
										<th>#</th>
										<th>Inventor's Name</th>
										<th>Inventor's Address</th>
									</tr>

										<tr>
											<td>1</td>
											<td>YAMADA, Osamu</td>
											<td>c/o CANON KABUSHIKI KAISHA, 3-30-2, Shimomaruko, Ohta-ku, Tokyo 146-8501.</td>
										</tr>
								</table>
					</td>
				</tr>
				<tr>
					<th>PCT International Classification Number</th>
					<td>G0 6K 9/00</td>
				</tr>
				<tr>
					<th>PCT International Application Number</th>
					<td>PCT/JP2003/011047</td>
				</tr>
				<tr>
					<th>PCT International Filing date</th>
					<td>2003-08-29</td>
				</tr>
				<tr>
					<td colspan=2>
						<h5>PCT Conventions:</h5>
						<table class="table">
							<tr>
								<th>#</th>
								<th>PCT Application Number</th>
								<th>Date of Convention</th>
								<th>Priority Country</th>
							</tr>

								<tr>
									<td>1</td>
									<td>2002-255244</td>
									<td>2002-08-30</td>
								    <td>Japan</td>
								</tr>
								<tr>
									<td>2</td>
									<td>2002-279371</td>
									<td>2002-09-25</td>
								    <td>Japan</td>
								</tr>

						</table>
					</td>
				</tr>
			</table>
		</div><!-- /well -->
	</div><!-- /span4 -->
</div><!-- /row-fluid -->

        </div>

      </div><!--/row-->

      <footer class="footer">

        <style>
        .allindianpatents-footer { width: 320px; height: 50px; }
        @media(min-width: 500px) { .allindianpatents-footer { width: 468px; height: 60px; } }
        @media(min-width: 800px) { .allindianpatents-footer { width: 728px; height: 90px; } }
        </style>
        <center>
        </center>

        <p>&copy; All Indian Patents, 2013-2021.</p>
        <p>Patent data available in the public domain from Indian Patents Office, Department of Industrial Policy and Promotions, Ministry of Commerce and Industry, Government of India.</p>
      </footer>

    </div> <!-- /container -->

    <!-- Javascripts
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/application-95f297ff0d8d2015987f04b30593c800.js" type="text/javascript"></script>

    <!-- Start of StatCounter Code for Default Guide -->
    <script type="text/javascript">
    var sc_project=8902313; 
    var sc_invisible=1; 
    var sc_security="3c1f8147"; 
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write("<sc"+"ript type='text/javascript' src='" +
    scJsHost+
    "statcounter.com/counter/counter.js'></"+"script>");
    </script>
    <noscript><div class="statcounter"><a title="web stats"
    href="http://statcounter.com/free-web-stats/"
    target="_blank"><img class="statcounter"
    src="http://c.statcounter.com/8902313/0/3c1f8147/1/"
    alt="web stats"></a></div></noscript>
    <!-- End of StatCounter Code for Default Guide -->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-244143-31', 'allindianpatents.com');
      ga('send', 'pageview');

    </script>

  </body>

<!-- Mirrored from www.allindianpatents.com/patents/205694-image-processing-apparatus-and-method by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Apr 2024 06:54:22 GMT -->
</html>
