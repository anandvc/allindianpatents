<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from www.allindianpatents.com/patents/257043-knocking-state-determination-device by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Apr 2024 08:53:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Patents. 257043:&quot;KNOCKING STATE DETERMINATION DEVICE&quot;</title>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="cYcP52B8zyTWKbLwby2YPh9z/gvY/RLjWOwY4YXkiXg=" name="csrf-token" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js" type="text/javascript"></script>
    <![endif]-->

    <link href="../assets/application-e80cf34975c5b1730c80b2f7170e7d26.css" media="all" rel="stylesheet" type="text/css" />

  </head>
  <body>

    <div class="navbar navbar-fluid-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../index.html">Indian Patents</a>
          <div class="container-fluid nav-collapse">
            <ul class="nav">
              <li><a href="../recently-granted.html">Recently Granted Patents</a></li>
              <li><a href="../recently-published.html">Recently Published Patents</a></li>
            </ul>
            <form id="gform" class="navbar-search pull-right" action="https://www.google.com/search" method="get" target="_blank" onsubmit="document.getElementById('gform').q.value='site:http://www.allindianpatents.com '+document.getElementById('gform').q.value">
                <input type="text" name="q" id="q" class="search-query" placeholder="Search" onclick="this.value=''" autocomplete="off">
            </form>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span12">

          <style>
          .allindianpatents-top { width: 320px; height: 50px; }
          @media(min-width: 500px) { .allindianpatents-top { width: 468px; height: 60px; } }
          @media(min-width: 800px) { .allindianpatents-top { width: 728px; height: 90px; } }
          </style>
          <center>
          </center>
          
          <div class="row-fluid">
	<div class="span8">

		<table class="table">
			<tr>
				<th>Title of Invention</th>
				<td><h1 style="font-size:large;">&quot;KNOCKING STATE DETERMINATION DEVICE&quot;</h1></td>
			</tr>
			<tr>
				<th>Abstract</th>
				<td>An engine ECU executes a program including the steps of: calculating a correlation coefficient K based on the result of comparing a vibration waveform of an engine and a knock waveform model stored previously; calculating a magnitude value LOG(V) from the magnitude V detected based on a signal transmitted from a knock sensor (S200); creating frequency distribution of magnitude values LOG(V) by using magnitude values LOG(V) in an ignition cycle in which the correlation coefficient K larger than a threshold K(l) is calculated (S204); and counting knock proportion KC by using the created frequency distribution (S216). If the vibration waveform includes a waveform of vibration of noise components, the correlation coefficient K is calculated to be smaller comparing with a case of not including it.</td>
			</tr>
		</table>

					<style>
					.allindianpatents-post-abstract { width: 320px; height: 50px; }
					@media(min-width: 880px) { .allindianpatents-post-abstract { width: 468px; height: 60px; } }
					@media(min-width: 1267px) { .allindianpatents-post-abstract { width: 728px; height: 90px; } }
					</style>
					<center>
					<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- AllIndianPatents-post-abstract -->
					<ins class="adsbygoogle allindianpatents-post-abstract"
					     style="display:inline-block"
					     data-ad-client="ca-pub-7914358224572760"
					     data-ad-slot="9152759240"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>					
					</center>

		<table class="table">
			<tr>
				<th>Full Text</th>
				<td>DESCRIPTION Knocking State Determination Device<br>
Technical Field<br>
The present invention relates to a knocking state determination device and particularly to a technique of determining a knocking occurrence state based on a waveform of vibration generated in an internal combustion engine.<br>
Background Art<br>
Conventionally, there have been proposed various methods of determining whether knocking (knock) is present or absent.   A knock control device of an internal combustion engine described in Japanese Patent Laying-Open No. 2003-021032 includes a knock sensor for detecting a knock of the internal combustion engine, a statistical processing portion for statistically processing an output signal detected by the knock sensor, a first temporary determination portion for determining whether or not the knock has occurred based on a processing result by the statistical processing portion, a second temporary determination portion for determining whether or not the knock has occurred based on a waveform of the output signal detected by the knock sensor, and a final knock determination portion for finally determining whether or not the knock has occurred based on the results of the knock temporary determination by the first temporary determination portion and the knock temporary determination by the second temporary determination portion.   The final knock determination portion finally determines that whether or not the knock has occurred when both the first temporary determination portion and the second temporary determination portion determine that the knock has occurred.<br>
With the knock control device described in this official gazette, the knock temporary determination by a statistical processing program and the knock temporary<br>
determination by a waveform program are used and it is finally determined that the knock has occurred only when it is determined that the knock has occurred in the respective temporary determinations.   Thus, with regard also to an output signal based on which knocking was detected erroneously by knocking determination using only one of the statistical processing program and the waveform program, it is possible to accurately determine whether or not the knocking has occurred.<br>
However, in the knock control device described in Japanese Patent Laying-Open No. 2003-021032, the knocking determination by the statistical processing and the knocking determination by a shape of the waveform are performed independently of each other.   Therefore, accuracy of each determination method is not improved and deterioration of the accuracy by a noise component is not resolved in each determination method.   Therefore, the device is susceptible to further improvement so as to accurately determine whether the knocking is present or absent.<br>
Disclosure of the Invention<br>
It is an object of the present invention to provide a knocking state determination device capable of determining a knocking occurrence state with high accuracy.<br>
A knocking state determination device according to the present invention includes: a first detecting portion for detecting a waveform of vibration caused in the internal combustion engine at a predetermined interval for a crank angle; a memory portion for previously storing a waveform of vibration of the internal combustion engine; a second detecting portion for detecting magnitude values relating to magnitude of vibration caused in the internal combustion engine in a plurality of ignition cycles; an extracting portion for extracting magnitude values satisfying a predetermined condition among a plurality of magnitude values based on the result of comparing a detected waveform with a stored waveform; and" a determining portion for determining a knocking occurrence state based on the magnitude values extracted.<br>
According to the present invention, a waveform of vibration caused in the<br>
internal combustion engine is detected as a predetermined interval for a crank angle, and the detected waveform is compared with a waveform previously stored as a waveform of vibration caused by knocking for example.   Further, magnitude values relating to the magnitude of vibration caused in the internal combustion engine are detected in a plurality of ignition cycles, and magnitude values satisfying predetermined conditions are extracted based on the result of comparing the detected waveform with the stored waveform among a plurality of magnitude values detected.   Thereby, without extracting magnitude values in an ignition cycle in which a waveform same as or similar to the waveform of vibration caused by the vibration of noise components such as vibration due to seating of an intake/exhaust valve or fuel injection from an injector, other magnitude values can be extracted.   That is, it is possible to remove magnitude values of vibration due to vibration of noise components.   Based on such magnitude values, a knocking occurrence state is determined.   Therefore, it is possible to determine the knocking occurrence state by suppressing effects of noise components. As a result, it is possible to provide a knocking state determination device capable of determining a knocking occurrence state with high accuracy.<br>
It is preferable that the knocking state determination device further include: a knock magnitude calculating portion for calculating a knock magnitude relating to the magnitude of vibration caused by knocking, based on the result of comparing the stored waveform and the detected waveform and the magnitude of vibration caused in the internal combustion engine at the predetermined interval for the crank angle; and a knocking determining portion for determining whether knocking has occurred in the internal combustion engine for each ignition cycle based on the result of comparing the knock magnitude and a predetermined determination value.<br>
According to the present invention, the knock magnitude relating to the magnitude of vibration caused by knocking is calculated based on the result of comparing the stored waveform and the detected waveform and the magnitude of vibration caused in the internal combustion engine at a predetermined interval for the<br>
crank angle.   Thereby, the knock magnitude as a value used for determining knocking can be obtained while considering the waveform and the magnitude of vibration. Based on the result of comparing the knock magnitude and the predetermined determination value, it is determined whether knocking has occurred in the internal combustion engine for each ignition cycle.   Thereby, in addition to the knocking determination based on the magnitude values detected in a plurality of ignition cycles, knocking determination can be performed for each ignition cycle.   Therefore, a knocking occurrence state can be determined while considering both of the vibration state in the past ignition cycles and the vibration state in one ignition cycle. Consequently, it is possible to determine knocking occurrence state with high accuracy.<br>
It is more preferable that the predetermined determination value be set based on at least one of the number of rotations of the internal combustion engine and the amount of air taken in the internal combustion engine.<br>
According to the present invention, a determination value used for determining whether knocking has occurred for each cycle is set based on at least one of the number of rotations of the internal combustion engine and the amount of air taken in the internal combustion engine.   Thereby, an appropriate determination value corresponding to the operational state of the internal combustion engine can be obtained. Therefore, it is possible to determine the knocking occurrence state with high accuracy.<br>
It is more preferable that the knocking state determination device further include a correcting portion for correcting the predetermined determination value based on the determination result by the determining portion.<br>
According to the present invention, a determination value used for determining whether knocking has occurred for each cycle is corrected based on the determination result of determining a knocking occurrence state by using the magnitude value extracted from the detected magnitude values in a plurality of ignition cycles.   Thereby, in the case where the knocking occurrence frequency is said to be high considered from the vibration state of the past ignition cycles, it is possible to make it easy to determine<br>
that knocking has occurred in knocking determination for each ignition cycle by correcting the determination value in order that retardation of ignition timing when knocking occurs can be performed more frequently.   In contrast, in the case where knocking occurrence frequency is said to be low considered from the vibration state of the past ignition cycles, it is possible to make it difficult to determine that knocking has occurred in knocking determination for each ignition cycle by correcting the determination value in order that advance of ignition timing when knocking does not occur can be performed more frequently.   Therefore, it is possible to make ignition tuning appropriate by making the determination value in knocking determination for each ignition cycle to be an appropriate value.<br>
It is more preferable that the knocking state determination device further include a correcting portion for correcting the determination value based on the frequency that knocking is determined to have occurred in the internal combustion engine by using the knock magnitude.<br>
According to the present invention, the determination value used for determining whether knocking has occurred for each ignition cycle is corrected based on the frequency that knocking is determined to have occurred in the internal combustion engine by using the knock magnitude.   Thereby, in the case where the knocking occurrence frequency is said to be high, it is possible to determine that knocking has occurred in knocking determination for each ignition cycle by correcting the determination value in order that retardation of ignition timing when knocking occurs can be performed more frequently.   In contrast, in the case where the knocking occurrence frequency is said to be low, it is possible to make it difficult to determine that knocking has occurred in knocking determination for each ignition cycle by correcting the determination value in order that advance of ignition timing when knocking does not occur can be performed more frequently.   Therefore, it is possible to make ignition timing appropriate by making the determination value in knocking determination for each ignition cycle to be an appropriate value.<br>
It is more preferable that the knocking state determination device further include: a first correcting portion for correcting the predetermined determination value based on a determination result by the determining portion; and a second correcting portion for correcting the determination value by the correction amount different from that of the first correcting portion, based on the frequency in which knocking is determined to have occurred in the internal combustion engine by using the knock magnitude.<br>
According to the present invention, a determination value used for determining whether knocking has occurred for each cycle is corrected based on the determination result of determining a knocking occurrence state by using the magnitude values extracted from the detected magnitude values in a plurality of ignition cycles.   Further, the determination value used for determining whether knocking has occurred for each ignition cycle is corrected based on the frequency that knocking is determined to have occurred in the internal combustion engine by using the knock magnitude.   Thereby, in the case where the knocking occurrence frequency is said to be high, it is possible to determine that knocking has occurred in knocking determination for each ignition cycle by correcting the determination value in order that retardation of ignition timing when knocking occurs can be performed more frequently.   In contrast, in the case where knocking occurrence frequency is said to be low, it is possible to make it difficult to determine that knocking has occurred in knocking determination for each ignition cycle by correcting the determination value in order that advance of ignition timing when knocking does not occur can be performed more frequently.   Here, comparing the case of correcting the determination value based on the result of determining the knocking occurrence state by using the magnitude value based on the magnitude values detected in a plurality of ignition cycles with the case of correcting the determination value based on the frequency that knocking is determined to have occurred in the internal combustion engine by using the knock magnitude, the correction amounts are different. For example, in the case of correcting the determination value based on the frequency<br>
that knocking is determined to have occurred in the internal combustion engine by using the knock magnitude, the determination value is corrected by the larger correction amount than the case of correcting the determination value based on the result of determining the knocking occurrence state by using the magnitude value based on the magnitude values detected in a plurality of ignition cycles.   Thereby, it is possible to determine that the knocking occurrence frequency is high from knocking determination for each ignition cycle, the determination value can be corrected promptly.   Therefore, it is possible to make ignition timing appropriate by making the determination value in knocking determination for each ignition cycle to be an appropriate value.<br>
It is more preferable that the second correcting portion correct the determination value by a correction amount larger than that of the first correcting portion.<br>
According to the present invention, in the case of correcting the determination value based on the frequency that knocking is determined to have occurred in the internal combustion engine by using the knock magnitude, the determination value is corrected by the correction amount larger than the case of correcting the determination value based on the result of determining the knocking occurrence state by using the magnitude values based on the magnitude values detected in a plurality of ignition cycles.   Thereby, if it is possible to determine that the knocking occurrence frequency is high from the knocking determination for each ignition cycle, the determination value can be corrected promptly.   Therefore, it is possible to make ignition timing appropriate by making the determination value in knocking determination for each ignition cycle to be an appropriate value.<br>
It is more preferable that the knocking state determination device further include a deviation calculating portion for calculating a value relating to a deviation between the detected waveform and the stored waveform.   The knock magnitude calculating portion calculates the knock magnitude based on the value relating to the deviation and the magnitude of vibration caused in the internal combustion engine at the predetermined interval for the crank angle.<br>
According to the present invention, a value relating to the deviation between the detected waveform and the stored waveform is calculated.   Thereby, it is possible to objectively determine whether it is a waveform of vibration caused by knocking for example, by quantifying the different points between the detected waveform and the stored waveform.   Based on the value relating to the deviation and the magnitude of vibration, the knock magnitude is calculated.   Thereby, the knock magnitude in which a difference from the waveform of vibration caused by knocking is reflected appropriately as a numeric value can be obtained.   Therefore, it is possible to determine whether knocking has occurred with high accuracy.<br>
It is more preferable that the knocking state determination device further include an integrating portion for calculating an integrated value in which the magnitude of vibration caused in the internal combustion engine at the predetermined interval for the crank angle is integrated by the predetermined interval for the crank angle.   The knock magnitude calculating portion calculates the knock magnitude based on the product of a value relating to the deviation and the integrated value.<br>
According to the present invention, an integrated value is calculated in which the magnitude of vibration caused in the internal combustion engine at the predetermined interval for the crank angle is integrated by the predetermined interval for the crank angle.   The vibration caused by knocking is attenuated gradually, and vibration caused by a noise component is attenuated quickly.   Therefore, the integrated value of the magnitude of vibration due to knocking and the integrated value of the magnitude of vibration caused by a noise component are largely different.   Based on the product of the integrated value and the value relating to the deviation, a knock magnitude is calculated.   Thereby, a knock magnitude in which the difference between knocking and noise is large can be obtained.   Based on such a knock magnitude, it is determined whether knocking has occurred in one cycle.   Therefore, it is possible to determine whether knocking has occurred with high accuracy.<br>
It is more preferable that the deviation calculating portion calculate values<br>
relating to the deviation smaller if the waveforms detected include a waveform of vibration caused by operations of predetermined parts of the internal combustion engine, comparing with the case of not including them.   The predetermined condition is a condition that they are magnitude values in an ignition cycle in which values relating to a deviation larger than the predetermined value are calculated.<br>
According to the present invention, values relating to the deviation are calculated smaller if the waveforms detected includes a waveform of vibration caused by operations of predetermined parts of the internal combustion engine (vibration of noise components), comparing with the case of not including them.   Magnitude values satisfying the condition that they are magnitude values in the ignition cycle in which values relating to the deviation larger than the predetermined value are calculated are extracted from the magnitude values detected in a plurality of ignition cycles.   Thereby, it is possible to suppress a state where magnitude values in the ignition cycle in which a waveform including vibration of noise components are detected are mixed with the magnitude values extracted.   That is, magnitude values excluding vibration of noise components can be extracted.   Therefore, it is possible to determine a knocking occurrence state while suppressing effects of noise components.   As a result, it is possible to determine the knocking occurrence state with high accuracy.<br>
It is more preferable that the predetermined value be a maximum value of a value relating to a deviation calculated in a state where the internal combustion engine is operated such that vibration due to the operation of the predetermined part is caused at a predetermined interval.<br>
According to the present invention, magnitude values are extracted which satisfy a condition that they are magnitude values in the ignition cycle in which a value, relating to a deviation satisfying a condition that it is larger than the maximum value of a value relating to the deviation when a waveform of vibration including noise components is detected, is calculated.   Thereby, it is possible to exclude magnitude values considered as magnitude values of vibration of noise components and extract<br>
magnitude values.   Therefore, based on the magnitude values considered as not magnitude values of vibration of noise components, knocking occurrence state can be determined.   As a result, it is possible to determine a knocking occurrence state with high accuracy while suppressing effects of noise components.<br>
It is more preferable that the predetermined part is at least one of a piston, an injector, a suction valve, and an exhaust valve.<br>
According to the present invention, it is possible to suppress the noise component generated due to at least one of the piston, the injector, the intake valve, and the exhaust valve to accurately determine the knocking occurrence state.<br>
It is more preferable that the knocking state determination device further include a deviation calculating portion for calculating a value relating to a deviation between the detected waveform and the stored waveform based on the result of comparing the detected waveform with the stored waveform.   The deviation calculating portion calculates a value relating to the deviation smaller if the detected waveform includes a waveform of vibration caused by operations of predetermined parts of the internal combustion engine, compared with a case of not including it.   The predetermined condition is a condition that they are magnitude .values in-an ignition cycle in which a value relating to a deviation larger than a predetermined value is calculated.<br>
According to the present invention, a value relating to the deviation between the detected waveform and the stored waveform is calculated based on the result of comparing the detected waveform and the stored waveform.   A value relating to the deviation is calculated smaller if the waveform detected includes a waveform of vibration caused by operations of predetermined parts of the internal combustion engine (vibration of noise components), comparing with the case of not including them. Magnitude values satisfying the condition that they are magnitude values in the ignition cycle in which a value relating to the deviation larger than the predetermined value is calculated are extracted from the magnitude values detected in a plurality of ignition cycles.   Thereby, it is possible to suppress a state where magnitude values in the<br>
ignition cycle in which a waveform including vibration of noise components is detected are mixed with the magnitude value extracted.   That is, magnitude values excluding vibration of noise components can be extracted.   Therefore, it is possible to determine a knocking occurrence state while suppressing effects of noise components.   As a result, it is possible to determine a knocking occurrence state with high accuracy.<br>
It is more preferable that the predetermined value be a maximum value of a value relating to a deviation calculated in a state where the internal combustion engine is operated such that vibration by the operation of the predetermined part is caused at a predetermined interval.<br>
According to the present invention, magnitude values are extracted which satisfy a condition that they are magnitude values in the ignition cycle in which a value, relating to a deviation satisfying a condition that it is larger than the maximum value of a value relating to the deviation when a waveform of vibration including noise components is detected, is calculated.   Thereby, it is possible to exclude magnitude values considered as magnitude values of vibration of noise components, and extract magnitude values.   Therefore, based on the magnitude values considered as not magnitude values of vibration of noise components, a knocking occurrence state can be determined.   As a result, it is possible to determine a knocking occurrence state with high accuracy while suppressing effects of noise components.<br>
It is more preferable that the predetermined part is at least one of a piston, an injector, a suction valve, and an exhaust valve.<br>
According to the present invention, it is possible to suppress the noise component generated due to at least one of the piston, the injector, the intake valve, and the exhaust valve to accurately determine the knocking occurrence state.<br>
It is more preferable that the knocking state determination device further include a level calculating portion for calculating a knock determination level based on the extracted magnitude values.   The determining portion determines a knocking occurrence state based on the result of comparing the extracted magnitude values with<br>
the knock determination level.<br>
According to the present invention, the knock determination level is calculated based on the extracted magnitude value.   In this way, it is possible to obtain the knock determination level on which the magnitude value in the past ignition cycle is reflected. Therefore, it is possible to obtain the knock determination level in consideration of influences of the operation state and individual specificity of the internal combustion engine on the magnitude value.   Based on the result of comparing the knock determination level and the extracted magnitude value, a knocking occurrence state is determined.   Thereby, it is possible to determine the knocking occurrence state with high accuracy corresponding to the operating state of the internal combustion engine and individual differences.<br>
It is more preferable that the level calculating portion calculate the knock determination level when a plurality of magnitude values not less than the predetermined number are extracted.<br>
According to the present invention, the knock determination level is calculated when a plurality of magnitude values not less than the predetermined number are extracted.   Thereby, the knock determination level can be calculated based on magnitude values for the number of ignition cycles appropriate for determining the knocking occurrence state.   Therefore, it is possible to obtain the knock determination level while appropriately considering effects affected on the magnitude values by the operating state of the internal combustion engine and individual differences.<br>
It is more preferable that the determining portion determine the knocking occurrence frequency based on the result of comparing the extracted magnitude values and the knock determination level.<br>
According to the present invention, the knocking occurrence frequency is determined.   Here, presence or non-presence of knocking causing a sound audible by passengers of the vehicle has a correlation with the knocking occurrence frequency. Therefore, it is possible to determine presence or non-presence of knocking causing a<br>
sound audible by passengers of the vehicle by determining the knocking occurrence frequency.<br>
It is more preferable that the determining portion determine frequency that magnitude values larger than the knock determination level are extracted, among the extracted magnitude values, as the knocking occurrence frequency.<br>
According to the present invention, frequency that magnitude values larger than the knock determination level are extracted is determined as the knocking occurrence frequency.   Here, presence or non-presence of knocking causing a sound audible by passengers of the vehicle has a correlation with the knocking occurrence frequency. Therefore, it is possible to determine presence or non-presence of knocking causing a sound audible by passengers of the vehicle by determining the knocking occurrence frequency.<br>
It is more preferable that the level calculating portion calculate the knock determination level by adding a product of a standard deviation in the extracted magnitude values and a predetermined coefficient to a median value of the extracted magnitude values.<br>
According to the present invention, the knock determination level is calculated by adding the product of the standard deviation in the extracted magnitude value and the predetermined coefficient to the median value in the extracted magnitude value.   In this way, it is possible to obtain the knock determination level on which the magnitude value in the past ignition cycle is reflected.   Therefore, it is possible to obtain the knock determination level in consideration of influences of the operation state and individual specificity of the internal combustion engine on the magnitude value.   The knocking occurrence state is determined based on the result of comparing the knock determination level and the extracted magnitude values.   Therefore, it is possible to determine the knocking occurrence state with high accuracy corresponding to the operating state of the internal combustion engine and individual differences.<br>
It is more preferable that the predetermined coefficient be 3.<br>
According to the present invention, the knock determination level is calculated based on the product of the standard deviation calculated from the extracted magnitude value and the coefficient "3".   Considering from data obtained through experiments and knowledge, magnitude values larger than the knock determination level calculated from the coefficient multiplied by the standard deviation being "3" are said to be magnitude values in the ignition cycle in which knocking has occurred actually. Therefore, by calculating the knock determination level based on the product of the standard deviation calculated from the extracted magnitude value and the coefficient "3", it is possible to determine the knocking occurrence state with high accuracy.<br>
It is more preferable that the level calculating portion calculate the knock determination level by adding the product of the standard deviation hi magnitude values of not more than the smallest magnitude value among magnitude values in which the extracted frequency shows a peak and a predetermined coefficient, to the smallest magnitude value among the magnitude values where the extracted frequency shows the peak.<br>
According to the present invention, the product of the standard deviation in magnitude values of not more than the smallest magnitude value among magnitude values in which the extracted frequency shows a peak and a predetermined coefficient is added to the smallest magnitude value among-the magnitude values where the extracted frequency shows the peak, and the knock determination level is calculated. Here, in the frequency distribution of magnitude values, the smallest magnitude value among the magnitude values where the extracted frequency shows the peak is often the almost same value irrespective or presence or non-presence of a magnitude value of vibration of a noise component.   Thereby, even if the magnitude values detected by the effect of noise components (extracted magnitude values) become high, it is possible to suppress the knock determination level calculated becoming high beyond necessity. Consequently, it is possible to determine the knocking occurrence state with high accuracy.<br>
It is more preferable that the predetermined coefficient be 3.<br>
According to the present invention, the knock determination level is calculated based on the product of the standard deviation calculated from the extracted magnitude value and the coefficient "3".   Considering from data obtained through experiments and knowledge, magnitude values larger than the knock determination level calculated from the coefficient multiplied by the standard deviation being "3" are said to be magnitude values in the ignition cycle in which knocking has occurred actually. Therefore, by calculating the knock determination level based on the product of the standard deviation calculated from the extracted magnitude value and the coefficient "3", it is possible to determine the knocking occurrence state with high accuracy.<br>
It is more preferable that the level calculating portion calculate the knock determination level by adding the product of a standard deviation in magnitude values of not more than a smallest magnitude value among magnitude values which are magnitude values in which the extracted frequency is higher than predetermined frequency and the extracted frequency shows a peak and a predetermined coefficient, to the smallest magnitude value among the magnitude values in which the extracted frequency is higher than the predetermined frequency and the extracted frequency shows the peak.<br>
According to the present invention, the product of a standard deviation in magnitude values of not more than the smallest magnitude value among magnitude values which are magnitude values in which the extracted frequency is higher than the predetermined frequency and the extracted frequency shows a peak and a predetermined coefficient is added to the smallest magnitude value among the magnitude values in which the extracted frequency is higher than the predetermined frequency and the extracted frequency shows the peak, and the knock determination level is calculated. Here, in the frequency distribution of magnitude'values, the smallest magnitude value among the magnitude values where the extracted frequency shows the peak is often the almost same value irrespective of presence or non-presence of magnitude values of<br>
vibration of noise components.   However, depending on the vibration occurrence state in the internal combustion engine, dispersion of extracted magnitude values becomes large, so there is a case where a peak is shown at lower frequency than usual in lower magnitude values than usual.    In view of this, the knock determination level is calculated by using the smallest magnitude value, as a reference, among magnitude values that the extracted frequency is higher than the predetermined frequency and the extracted frequency shows a peak.   Thereby, even if the magnitude values detected due to the effects of noise components (extracted magnitude value) become high, it is possible to suppress the knock determination level calculated becoming high beyond necessity.   Further, even if the dispersion of extracted magnitude values becomes large, it is possible to suppress the knock determination level calculated becoming low beyond necessity.   Consequently, it is possible to determine the knocking occurrence state with high accuracy.<br>
It is more preferable that the predetermined coefficient be 3.<br>
According to the present invention, the knock determination level is calculated based on the product of the standard deviation calculated from the extracted magnitude value and the coefficient "3".   Considering from data obtained through experiments and knowledge, magnitude values larger than the knock determination level calculated from the coefficient multiplied by the standard deviation being "3" are said to be magnitude values in the ignition cycle in which knocking'has occurred actually. Therefore, by calculating the knock determination level based on the product of the standard deviation calculated from the extracted magnitude values and the coefficient "3", it is possible to determine the knocking occurrence state with high accuracy.<br>
It is more preferable that the waveform of vibration be a waveform in which waveforms of vibration of a plurality of frequency bands caused in the internal combustion engine are synthesized.<br>
According to the present invention, waveforms of vibration of a plurality of frequency bands caused in the internal combustion engine are synthesized.    Thereby, it<br>
is possible to obtain a waveform using for knocking determination by synthesizing waveforms of vibration of frequency bands particular at the time of knocking. Therefore, a waveform in which waveforms of vibration of noise components are suppressed can be obtained.   Consequently, it is possible to determine the knocking 5        occurrence state with high accuracy while suppressing effects of vibration of noise components.<br>
Brief Description of the Drawings<br>
Fig. 1 is a schematic configuration diagram showing an engine controlled by an 10        engine ECU which is a knocking state determination device according to a first embodiment of the present invention.<br>
Fig. 2 is a chart showing a frequency band of vibration generated in the engine at the time of knocking.<br>
Fig. 3 is a control block diagram showing the engine ECU in Fig. 1.<br>
	Fig. 4 is a chart showing a waveform of the vibration in the engine.<br>
Fig. 5 is a chart showing a knock waveform model stored in memory of the engine ECU.<br>
Fig. 6 is a chart for comparing the vibration waveform and the knock waveform model.<br>
	Fig. 7 is a chart showing a map of a determination value V(KX) stored in the<br>
memory of the engine ECU.<br>
Fig. 8 is a chart (No. 1) showing frequency distribution of magnitude values LOG(V).<br>
Fig. 9 is a chart (No. 2) showing frequency distribution of magnitude values 25         LOG(V).<br>
Fig. 10 is a chart showing magnitude values LOG(V) used for forming the frequency distribution of the magnitude values LOG(V). .<br>
Fig. 11 is a chart showing magnitude values LOG(V) in setting a threshold<br>
value V(l).<br>
Fig. 12 is a chart showing magnitude values LOG(V) in setting a threshold value K(l).<br>
Fig. 13 is a flowchart (No. 1) showing a control structure of the program 5        executed by the engine ECU in Fig. 1.<br>
Fig. 14 is a flowchart (No. 2) showing the control structure of the program executed by the engine ECU in Fig. 1.<br>
Fig. 15 is a chart (No. 3) showing frequency distribution of magnitude values LOG(V).<br>
	Fig. 16 is a chart (No. 4) showing frequency distribution of magnitude values<br>
LOG(V).<br>
Fig. 17 is a chart (No. 5) showing frequency distribution of magnitude values LOG(V).<br>
Fig. 18 is a chart showing progressions of V(KD) and V(MAX);<br>
	Fig. 19 is a chart (No. 6) showing frequency distribution of magnitude values<br>
LOG(V).<br>
Fig. 20 is a chart (No. 1) showing a relationship between an audible knock magnitude and a knock proportion.<br>
Fig. 21 is a chart (No. 2) showing the relationship between the audible knock 20         magnitude and the knock proportion.<br>
Fig. 22 is a chart (No. 1) showing an integrated value at the time of knocking and an integrated value by noise.<br>
Fig. 23 is a chart (No. 2) showing an integrated value at the time of knocking and an integrated value by noise.<br>
	Fig. 24 is a flowchart (No. 3) showing a control structure of a program executed<br>
by the engine ECU shown in Fig. 1.<br>
Fig. 25 is a chart (No. 7) showing frequency distribution of magnitude values LOG(V).<br>
Fig. 26 is a chart (No. 8) showing frequency distribution of magnitude values LOG(V).<br>
Fig. 27 is a chart (No. 9) showing frequency distribution of magnitude values LOG(V).<br>
Best Modes for Carrying Out the Invention<br>
Embodiments of the present invention will be described below with reference to the drawings.   In the following description, the same parts are provided with the same reference numerals.   They have the same names and functions.   Therefore, detailed description of the same parts is not repeated. First Embodiment<br>
With reference to Fig. 1, an engine 100 of a vehicle mounting a knocking state determination device according to a first embodiment of the present invention will be described.   The knocking state determination device according to the present embodiment is realized by a program executed by an engine ECU (Electronic Control Unit) 200 for example.<br>
Engine 100 is an internal combustion engine in which an air-fuel mixture of air drawn in from an air cleaner 102 and fuel injected from an injector 104 is ignited by a spark plug 106 and burnt in a combustion chamber.<br>
When the air-fuel mixture is burnt, a piston 108 is pushed down by combustion pressure and a crankshaft 110 is rotated.    The air-fuel mixture after combustion (exhaust gas) is cleaned by three-way catalysts 112 and exhausted outside a car.   An amount of air drawn into engine 100 is regulated by a throttle valve 114.<br>
Engine 100 is controlled by engine ECU 200.    Connected to engine ECU 200 are a knock sensor 300, a water temperature sensor 302, a crank position sensor 306 provided to face a timing rotor 304, a sensor 308 of an opening position of throttle, a vehicle speed sensor 310, an ignition switch 312, and an air flow meter 314.<br>
Knock sensor 300 is provided to a cylinder block of engine 100.   Knock sensor<br>
300 is formed of a piezoelectric element.   Knock sensor 300 generates voltage in response to vibration of engine 100.   Magnitude of the voltage corresponds to magnitude of the vibration.   Knock sensor 300 sends a signal representing voltage to engine ECU 200.   Water temperature sensor 302 detects temperature of cooling water in a water jacket of engine 100 and sends a signal representing a detection result to engine ECU 200.<br>
Timing rotor 304 is provided to crankshaft 110 and rotates with crankshaft 110. On an outer periphery of timing rotor 304, a plurality of protrusions are provided at predetermined intervals.   Crank position sensor 306 is provided to face the protrusions of the timing rotor 304.   When timing rotor 304 rotates, an air gap between the protrusion of timing rotor 304 and crank position sensor 306 changes and, as a result, magnetic flux passing through a coil portion of crank position sensor 306 increases and decreases to generate electromotive force in the coil portion.   Crank position sensor 306 sends a signal representing the electromotive force to engine ECU 200.   Engine ECU 200 detects a crank angle based on the signal sent from crank position sensor 306.<br>
Sensor 308 of the opening position of throttle detects an opening position of throttle and sends a signal representing a detection result to engine ECU 200.   Vehicle speed sensor 310 detects the number of rotations of a wheel (not shown) and sends a signal representing a detection result to engine ECU 200.   Engine ECU 200 calculates a vehicle speed based on the number of rotations of the wheel.   Ignition switch 312 is turned on by a driver in starting of engine 100.   Air flow meter 314 detects the intake air amount into engine 100 and sends a signal representing a detection result to engine ECU 200.<br>
Engine ECU 200 performs computation based on signals sent from the respective sensors and ignition switch 312 and a map and the program stored in memory 202 and controls the devices so as to bring engine 100 into a desired operation state.<br>
In the present embodiment, engine ECU 200 detects a waveform of vibration<br>
(hereafter referred to as "vibration waveform") of engine 100 in a knock detection gate (a section between a predetermined first crank angle and a predetermined second crank angle) based on the signal and the crank angle sent from knock sensor 300 and determines whether or not knocking has occurred in engine 100 based on the detected vibration waveform.   The knock detection gate in the embodiment is from a top dead center (0°) to 90° in a combustion stroke.   The knock detection gate is not limited to it.<br>
When knocking occurs, vibration at a frequency near a frequency shown in a solid line in Fig. 2 is generated in engine 100.   The frequency of the vibration generated due to the knocking is not constant and varies hi a certain range of frequencies.    Therefore, in the embodiment, as shown in Fig. 2, vibrations included in a first frequency band A, a second frequency band B, and a third frequency band C, are detected.   In Fig. 2, CA designates the crank angle.   The number of frequency bands of vibrations generated due to the knocking is not restricted to three.<br>
With reference to Fig. 3, engine ECU 200 will be further described.    Engine ECU 200 includes an A/D (analog/digital) converter 400,.a band-pass filter (1) 410, a band-pass filter (2) 420, a band-pass filter (3) 430, and an integrating portion 450.<br>
A/D converter 400 converts an analog signal sent from knock sensor 300 into a digital signal.   Band-pass filter (1) 410 allows passage of only signals in first frequency band A out of signals sent from knock sensor 300.   In other words, by bandpass filter (1)410, only vibrations in first frequency band A are extracted from vibrations detected by knock sensor 300.<br>
Band-pass filter (2) 420 allows passage of only signals in second frequency band B out of signals sent from knock sensor 300.   In other words, by band-pass filter (2) 420, only vibrations in second frequency band B are extracted from vibrations detected by knock sensor 300.<br>
Band-pass filter (3) 430 allows passage of only signals in third frequency band C out of signals sent from knock sensor 300.   In other words, by band-pass filter (3) 430, only vibrations hi third frequency band C are extracted from vibrations detected by<br>
knock sensor 300.<br>
Integrating portion 450 integrates signals selected by the band-pass filters (1) 410 to (3) 430, i.e., magnitudes of vibrations for a crank angle of 5° at a time.   The integrated value will hereafter be referred to as an integrated value.   The integrated value is calculated in each frequency band.   By this calculation of the integrated value, the vibration waveform in each frequency band is detected.<br>
Furthermore, the calculated integrated values hi the first to third frequency bands A to C are added to correspond to the crank angles.   In other words, the vibration waveforms of the first to third frequency'bands A to C are synthesized.<br>
As a result, as shown in Fig. 4, a vibration waveform of engine 100 is detected. In other words, the synthesized waveform of the first to third frequency bands A to C are used as the vibration waveform of engine 100.<br>
The detected vibration waveform is compared with a knock waveform model stored in memory 202 of engine ECU 200 as shown in Fig. 5.    The knock waveform model is formed in advance as a model of a vibration waveform when the knocking occurs in engine 100.<br>
In the knock waveform model, the magnitudes of the vibrations are expressed as dimensionless numbers in a range of 0 to 1 and the magnitude of the vibration does not univocally correspond to the crank angle.   In other words, in the knock waveform model in the embodiment, it is determined that the magnitude of the vibration decreases as the crank angle increases after a peak value of the magnitude of the vibration, but a crank angle at which the magnitude of the vibration becomes the peak value is not determined.<br>
The knock waveform model in the embodiment corresponds to the vibration after the peak value of the magnitude of the vibration generated due to the knocking. It is also possible to store a knock waveform model corresponding to vibration after a rising edge of the vibration caused by the knocking.<br>
The knock waveform model is formed and stored in advance based on a<br>
vibration waveform of engine 100 detected when knocking is forcibly generated experimentally.<br>
The knock waveform model is formed by using engine 100 with dimensions of engine 100 and an output value, of knock sensor 300 which are median values of dimensional tolerance and tolerance of the output value of knock sensor 300 (hereafter referred to as "median characteristic engine").   In other words, the knock waveform model is a vibration waveform in a case in which the knocking is forcibly generated in the median characteristic engine.<br>
A method of forming the knock waveform model is not limited to it and it is also possible to form the model by simulation.   Engine ECU 200 compares the detected waveform and the stored knock waveform model with each other and determines whether or not the knocking has occurred in engine 100.<br>
In comparison between the detected waveform and the knock waveform model, as shown in Fig. 6, a normalized waveform and the knock waveform model are compared with each other.   Here, normalization means to express the magnitude of the vibration as a dimensionless number in a range of 0 to 1 by dividing each integrated value by a maximum value of the integrated value in the detected vibration waveform, for example.   However, a method of normalization is not limited to it.<br>
Li the embodiment, engine ECU 200 calculates a correlation coefficient K which is a value related to a deviation of the normalized vibration waveform and the knock waveform model from each other.   With timing at which the magnitude of the vibration becomes a maximum value in the vibration waveform after the normalization and timing at which the magnitude of the vibration becomes a maximum value in the knock waveform model synchronized, an absolute value (deviation amount) of the deviation of the vibration waveform after the normalization and the knock waveform model from each other is calculated at every 5° of crank angle to thereby calculate correlation coefficient K.<br>
If the absolute value of the deviation of the vibration waveform after the<br>
normalization and the knock waveform model from each other at each crank angle is AS (I) (I is a natural number) and a value (an area of the knock waveform model) obtained by integrating the magnitude of the vibration in the knock waveform model by the crank angle is S, correlation coefficient K is calculated by an equation, K = (S -ZAS(I))/S, where ZAS(I) is the total of AS(I).   In the embodiment, the closer a shape of the vibration waveform to a shape of the knock waveform model, the greater value correlation coefficient K is calculated as.   Therefore, if a waveform of vibration caused by factors other than the knocking is included in the vibration waveform, correlation coefficient K is calculated as a small value.   A method of calculating correlation coefficient K is not limited to it.<br>
Furthermore, engine ECU 200 calculates a knock magnitude N based on correlation coefficient K and the maximum value (peak value) of the integrated value. If the maximum value of the integrated value is P and a value representing the magnitude of engine 100 when the knocking is not generated in engine 100 is BGL (Back Ground Level), knock magnitude N is calculated by an equation, N = P x K/BGL. BGL is stored in memory 202.    A method of calculating knock magnitude N is not limited to it.<br>
In the embodiment, engine ECU 200 compares calculated knock magnitude N and a determination value V(KX) stored in memory 202 to thereby determine whether or not knocking has occurred in engine 100 for every ignition cycle.   As show in Fig. 7, determination values V(KX) are stored as a map using an engine speed NE and an intake air amount KL as parameters.<br>
As an initial value of determination value V(KX),'a value determined in advance by experiment or the like is used.   However, a magnitude of the same vibration occurring in engine 100 may be detected as different values due to variation in the output values and degradation of knock sensor 300.   In this case, it is necessary to correct determination value V(KX) and to determine whether or not knocking has occurred by using determination value V(KX) corresponding to the magnitude detected<br>
actually.<br>
Therefore, in the embodiment, as shown in Fig. 8, each determination value V(KX) is corrected by using frequency distribution representing a relationship between a magnitude value LOG(V) which is a value obtained by logarithmically converting magnitudes V for the predetermined number of ignition cycles (e.g., 200 cycles) and a frequency (the number of times, a probability) of detection of each magnitude value LOG(V).<br>
The frequency distribution of magnitude values (LOG)(V) is formed for each range in which engine speed NE and the intake air amount KL are used as parameters and corresponding determination value V(KX) is corrected.   Magnitude V used for calculating magnitude value LOG(V) is a peak value (peak value of integrated values at every 5°) of magnitudes between predetermined crank angles.<br>
In the frequency distribution, median value V(50) at which the accumulative sum of frequencies of magnitudes LOG(V) from the minimum value reaches 50% is calculated.   Furthermore, standard deviations a at magnitude values LOG(V) equal to or smaller than median value V(50) are calculated.   A value obtained by adding the product of a coefficient U (U is a constant and U = 3, for example) and standard deviation o to median value V(50) is a knock determination level V(KD).    Frequency of magnitude values LOG(V) larger than the knock determination level V(KD) is determined as frequency that knocking occurred.<br>
Note that coefficient U is a coefficient calculated from data obtained through experiments or the like and knowledge.   The magnitude value LOG(V) larger than the knock determination level V(KD) where U = 3 almost coincides with the magnitude value LOG(V) in an ignition cycle in which knocking occurred actually.   Note that a value other than "3" may be used for coefficient U.<br>
In the frequency distribution of magnitude values LOG(V), as shown in Fig. 9, if magnitude values LOG(V) of vibrations which are noise components are mixed in magnitude values LOG(V), a frequency with which large magnitude values LOG(V) are<br>
calculated becomes high and the frequency distribution becomes biased in shape.   In this case, a range of distribution (a difference between the minimum value and the maximum value) of magnitude values LOG(V) may become narrow and magnitude values LOG(V) greater than knock determination level V(KD) may become extremely few in some cases.   As a result, there is a fear that the number of times that knocking has occurred cannot be determined accurately.<br>
Therefore, in the embodiment, as magnitude values LOG(V) used for forming the frequency distribution, magnitude values LOG(V) in a range surrounded with a broken line in Fig. 10 are used.   Fig. 10 is a chart in which calculated magnitude values LOG(V) are plotted for each correlation coefficient K in a cycle in which magnitude values LOG(V) are obtained.<br>
As shown in Fig. 10, the frequency distribution is formed after excluding magnitude values LOG(V) greater than a threshold value V(l) and calculated in ignition cycles in which correlation coefficient K is smaller than a threshold value K(l). In other words, magnitude values LOG(V) satisfying a condition that they are smaller than threshold value V(l) and magnitude values LOG(V) calculated in the ignition cycles in which correlation coefficients K satisfying a condition that they are greater than threshold value K(l) are extracted to form the frequency distribution.<br>
With reference to Fig. 11, threshold value V(l) will be further described.   Fig. 11 shows magnitude values LOG(V) when engine 100 is operated so that magnitudes V of vibrations due to factors (noise components) other than knocking are not taken in when magnitudes V used for calculating magnitude values LOG(V) are detected.<br>
As the vibrations due to the noise components, vibrations due to piston slap, vibrations due to actuation of an injector 104 (arid especially a direct injector), vibrations due to seating of an intake valve 116 or an exhaust valve 118, and the like are conceivable.<br>
In the gate (between predetermined crank angles) for taking in magnitudes V, engine 100 is operated so that the piston slap does not occur and engine 100 is operated<br>
so that injector 104, intake valve 116, and exhaust valve 118 are stopped to thereby calculate magnitude values LOG(V) shown in Fig. 11.<br>
A median value of magnitude values LOG(V) calculated in this manner is set as threshold value V(l).   The median value is set as threshold value V(l) because magnitude values of the vibrations due to the noise components are considered to be greater than the median value.   It is also possible to set a value (e.g., a value smaller than the median value) other than the median value as threshold value V(l).<br>
With reference to Fig. 12, threshold value K(l) will be further described.   Fig. 12 shows magnitude values LOG(V) when engine 100 is operated so that a noise waveform is included in vibration waveform in the ignition cycle in which magnitude values LOG(V) are calculated.<br>
In the knock detection gate, engine 100 is operated so that the piston slap occurs and engine 100 is operated so that injector 104, intake valve 116, and exhaust valve 118 are actuated to thereby calculate magnitude values LOG(V) shown in Fig. 12.<br>
A maximum value of correlation coefficients K in magnitude values LOG(V) calculated in this manner is set as threshold value K(l).   It is also possible to set a value (e.g., a value greater than the maximum value) other than the maximum value as threshold value K(l).<br>
Thus, by using magnitude values LOG(V) smaller than threshold value V(l) and magnitude values LOG(V) in the ignition cycle in which correlation coefficient K is greater than threshold value K(l), the frequency distribution is formed.   In other words, while excluding magnitude values LOG(V) which are considered to be magnitude values LOG(V) of the vibrations of the noise components, the frequency distribution is formed.<br>
With reference to Fig. 13, description will be given for the control structure of a program executed for determining whether knocking occurred for each ignition cycle by engine ECU 200 which is the knocking state determination device according to the present embodiment.<br>
In step 100 (hereafter "step" will be abbreviated to "S"), engine ECU 200 detects engine speed ME based on a signal sent from crank position sensor 306 and detects intake air amount KL based on a signal sent from air flow meter 314.<br>
In S102, engine ECU 200 detects magnitude of vibration of engine 100 based on a signal sent from knock sensor 300.   The magnitude of the vibration is expressed as an output voltage of knock sensor 300.   The magnitude of the vibration may be expressed as a value corresponding to the output voltage of knock sensor 300. Detection of the magnitude is carried out between the top dead center and 90° (a crank angle of 90°) in a combustion stroke.<br>
In SI04, engine ECU 200 calculates a value (integrated value) obtained by integrating output voltages (values representing magnitudes of vibrations) of knock sensor 300 for every 5° (for 5°). of crank angle.   The integrated value is calculated for vibrations in each of first to third frequency bands A to C.   Moreover, integrated values in the first to third frequency bands A to C are added to correspond to the crank angles to thereby detect a vibration waveform of engine 100.<br>
In SI06, engine ECU 200 calculates the largest integrated value (peak value) out of integrated values in a synthesized waveform (vibration waveform of engine 100) of the first to third frequency bands A to C.<br>
In SI08, engine ECU 200 normalizes the vibration waveform of engine 100. Here, normalization means to express the magnitude of the vibration as a dimensionless number in a range of 0 to 1 by dividing each integrated value by the calculated peak value.<br>
In SI 10, engine ECU 200 calculates correlation coefficient K which is a value related to the deviation of the normalized vibration waveform and the knock waveform model from each other.<br>
In S112, engine ECU 200 calculates the knock magnitude N.   If the calculated peak value is P and a value representing the magnitude of the vibration of engine 100 when the knocking is not generated in engine 100 is BGL (Back Ground Level), knock<br>
magnitude N is calculated by an equation, N = P x K/BGL.   BGL is stored in memory 202.   A method of calculating knock magnitude N is not limited to it.<br>
In S114, engine ECU 200 determines whether or not knock magnitude N is greater than the predetermined determination value.   If knock magnitude N is greater than the predetermined determination value (YES in SI 14), the processing moves to SI 16.   Otherwise (NO in SI 14), the processing moves to S120.<br>
In SI 16, engine ECU 200 determines that knocking has occurred in engine 100. In S118, engine ECU 200 retards the ignition timing.   In S120, engine ECU 200 determines that knocking has not occurred in engine 100.   In SI22, engine ECU 200 advances the ignition timing.<br>
With reference to Fig. 14, description will be given for the control structure of a program executed for correcting the determination value V(KX) for determining whether knocking occurred for each ignition cycle, by engine ECU 200 which is the knocking state determination device according to the present embodiment.<br>
In S200, engine ECU 200 calculates magnitude value LOG(V) from magnitude V detected based on the signal sent from knock sensor 300.   Here, magnitude V is a peak value (peak value of integrated values at every 5°) between predetermined crank angles.<br>
In S202, engine ECU 200 determines whether or not magnitude values LOG(V) for N cycles (N is a natural number and N = 200, for example) have been calculated. Engine ECU 200 determines that magnitude values LOG(V) for N cycles have been calculated when N or more magnitude values LOG(V) in the above-described range surrounded with a broken line in Fig. 10 have been calculated.   If magnitude values LOG(V) for N cycles are calculated (YES hi S202), the processing moves to S204. Otherwise (NO in S202), the processing returns to S200.<br>
In S204, engine ECU 200 forms frequency distribution of magnitude values LOG(V).   In S206, engine ECU 200 determines a maximum value V(MAX) of magnitude values LOG(V).<br>
In S208, engine ECU 200 calculates a median value V(50) and a standard deviation a of magnitude values LOG(V) equal to or smaller than maximum value V(MAX).   In S210, engine ECU 200 calculates knock determination level V(KD) based on median value V(50) and standard deviation a.<br>
In S212, engine ECU 200 determines whether or not knock determination level V(KD) is smaller than maximum value V(MAX).   If knock determination level V(KD) is smaller than maximum value V(MAX) (YES in S212), the processing moves to S214.   Otherwise (NO in S212), the processing moves to S218.<br>
In S214, engine ECU 200 removes V(MAX) determined in S206 from the frequency distribution.   In S216, engine ECU 200 counts the sum of the frequency of the removed maximum values V(MAX) as knock proportion KC.   Then, the processing returns to S206.<br>
In S218, engine ECU 200 determines whether or not knock proportion KC is greater than a threshold value KC(0).   If knock proportion KC is greater than threshold value KC(0) (YES in S218), the processing moves to S220.   Otherwise (NO in S218), the processing moves to S222.   In S220, engine ECU 200 decreases determination value V(KX).   In S222, engine ECU 200 increases determination value V(KX).<br>
Description will be given for operation of engine ECU 200 which is the knocking state determination device according to the present embodiment, based on the structure and the flowchart described above.<br>
When a driver turns ignition switch 312 on to start engine 100, engine speed NE is detected based on the signal sent from crank position sensor 306 and intake air amount KL is detected based on the signal sent from air flow meter 314 (S100). Moreover, based on the signal sent from knock sensor 300, a magnitude of vibration of engine 100 is detected (S102).<br>
Between the top dead center and 90° in the combustion stroke, the integrated value for every 5° of vibrations in each of the first to third frequency bands A to C is calculated (S104). The calculated integrated values in the first to third frequency<br>
bands A to C are added to correspond to the crank angles to thereby detect the above-described vibration waveform of engine 100 as shown in Fig. 4.<br>
As an integrated value for every five degree is used to detect a vibration waveform, it becomes possible to detect a vibration waveform of which delicate variations are suppressed.    Therefore, it becomes easy to compare the detected vibration waveform and the knock waveform model with each other.<br>
Based on the calculated integrated values, peak value P of the integrated values in the synthesized waveform (vibration waveform of engine 100) of the first to third frequency bands A to C is calculated (SI06).<br>
The integrated value in the vibration waveform of engine 100 is divided by the calculated peak value P to thereby normalize the vibration waveform (S108).   By normalization, the magnitudes of the vibrations in the vibration waveform are expressed as dimensionless numbers in a range of 0 to 1.   In this manner, it is possible to compare the detected vibration waveform and the knock waveform model with each other irrespective of the magnitude of the vibration.   Therefore, it is unnecessary to store the large number of knock waveform models corresponding to the magnitudes of the vibrations to thereby facilitate forming of the knock waveform model.<br>
With timing at which the magnitude of the vibration becomes a maximum value in the vibration waveform after the normalization and timing at which the magnitude of the vibration becomes a maximum value in the knock waveform model synchronized (see Fig. 6), an absolute value AS (I) of the deviation of the vibration waveform after the normalization and the knock waveform model from each other at each crank angle is calculated.   Based on the total of AS(I) and value S obtained by integrating the magnitude of the vibration in the knock waveform model by the crank angle, correlation coefficient K is calculated by K = (S - HAS(I))/S (S 110).   In this manner, it is possible to convert a degree of agreement between the detected vibration waveform and the knock waveform model into a number to objectively determine the degree. Furthermore, by comparing the vibration waveform and the knock waveform model<br>
with each other, it is possible to analyze whether or not the vibration is a vibration at the time of knocking from behavior of the vibration such as an attenuating trend of the vibration.<br>
By dividing the product of correlation coefficient K calculated as described above and peak value P by BGL, knock magnitude N is calculated (S112).   In this manner, it is possible to more closely analyze whether or not the vibration of engine 100 is a vibration caused by knocking based on the magnitude of the vibration in addition to the degree of agreement between the detected vibration waveform and the knock waveform model.<br>
When knock magnitude N is greater than the predetermined determination value (YES in SI 14), it is determined that knocking has occurred (SI 16) and the ignition timing is retarded (S 118).   As a result, occurrence of knocking is suppressed.<br>
On the other hand, when knock magnitude N is not greater than the predetermined determination value (NO in SI 14), it is determined that knocking has not occurred (SI20) and the ignition timing is advanced (SI22).<br>
In this way, by comparing knock magnitude N and determination value V(KX) with each other, it is determined whether or not knocking has occurred in each ignition cycle and the ignition timing is retarded or advanced.<br>
As described above, even when the same vibrations occur in engine 100, detected magnitudes may be different due to variation in the output value and degradation of knock sensor 300.   In this case, it is necessary to correct determination value V(KX) and to determine whether or not knocking has occurred by using determination value V(KX) corresponding to the actually-detected magnitude.<br>
Therefore, the magnitude value LOG(V) is calculated from the magnitude V detected based on a signal transmitted from knock .sensor.300 (S200).<br>
When the magnitude values LOG(V) for N cycles are calculated (YES in S202), frequency distribution of the calculated magnitude values LOG(V) is prepared (S204), and the maximum value V(MAX) of the magnitude values LOG(V) in the frequency<br>
distribution is decided (S206).   Further, the median value V(50) and the standard deviation c in the frequency distribution of the magnitude values LOG(V) not more than the maximum value V(MAX) are calculated (S208), and based on the median value V(50) and the standard deviation a, the knock determination level V(KD) is calculated (S210).<br>
If knocking did not occur in the engine 100, the frequency distribution becomes normal distribution as shown in Fig. 15, and the maximum value V(MAX) and the knock determination level V(KD) coincide with each other.   On the other hand, when knocking occurred, the magnitude V detected becomes larger, and when a large magnitude value LOG(V) is calculated, the maximum value V(MAX) becomes larger than the knock determination level V(KD), as shown in Fig. 16.<br>
Further, if the frequency of occurrence of knocking increases or mechanical vibration of the engine 100 itself increases, the maximum value V(MAX) becomes much larger as shown in Fig. 17.   At this time, the median value V(50) and the standard deviation a increase in accordance with the maximum value V(MAX). Therefore, the knock determination level V(KD) becomes larger.<br>
Magnitude values LOG(V) smaller than the knock determination level V(KD) are not determined as magnitude values LOG(V) in the cycle in which knocking occurred.   Therefore, as the knocking determination level V(KD) becomes larger, the frequency that knocking is determined not to occur increases even though knocking occurred.<br>
In order to suppress an increase in the knock determination level V(KD) as described above, if the knock determination level V(KD) is smaller than the maximum value V(MAX) (YES in S212), the maximum value V(MAX) is removed from the frequency distribution (S214).   The total of the frequencies of removed maximum values V(MAX) is counted as knock occupancy KC (S216).<br>
In the frequency distribution in which the maximum value V(MAX) has been removed, a maximum value V(MAX) is decided again (S206).   That is, the maximum<br>
value V(MAX) is corrected to be smaller.<br>
Further, in the frequency distribution after the maximum value V(MAX) has been removed, a knock determination level V(KD) is again calculated (S210).   That is, a knock determination level V(KD) in the frequency distribution for magnitude values LOG(V) smaller than the maximum value V(MAX) decided again is calculated again. As long as the knock determination level V(KD) is smaller than the maximum value V(MAX) (YES in S21), processing from S206 to S216 is repeated.<br>
If a knock determination level V(KD) is recalculated after removing maximum values V(MAX), the knock determination level V(KD) becomes larger as the removed number of maximum values V(MAX) increases (as the maximum value V(MAX) in frequency distribution becomes smaller).   Since the reduction rate of the maximum value V(MAX) is larger than the reduction rate of knock determination level V(KD), there is a point where the both coincide.<br>
As described above, in frequency distribution where knocking is not generated, the maximum value V(MAX) and the knock determination level V(KD) coincide. Therefore, as shown in Fig. 19, in the case where the maximum value V(MAX) and the knock determination level V(KD) coincide (NO in S212), this knock determination level V(KD) is said to simulates a knock determination level V(KD) in frequency distribution where knocking is not generated.<br>
Therefore, the total of frequencies of magnitude values LOG(V) larger than the knock determination level V(KD) (maximum value V(MAX)) in the case that the maximum value V(MAX) and the knock determination level V(KD) coincide, that is, the total of frequencies of maximum values V(MAX) removed until the maximum value V(MAX) and the knock determination level V(KD) coincide, is counted as knock occupancy KC (frequency of knocking being caused) (S216).<br>
Fig. 20 shows a transition of occupancy KC when the knock occupancy KC is counted by using the knock determination level V(RD) calculated without removing the maximum value V(MAX).   In this case, the knock occupancy KC increases as the<br>
audible knock magnitude (magnitude level that passengers can sense by listening) increases from the state of no knocking.   However, since the knock determination level V(KD) increases as the maximum value V(MAX) increases, if the audible knock magnitude is too large, the knock occupancy decreases in turn.<br>
On the other hand, as shown in Fig. 12, if the knock determination level V(KD) is recalculated by removing maximum values V(MAX) until the maximum value V(MAX) and the knock determination level V(KD) coincide, the knock occupancy KC increases as the audible knock magnitude becomes larger.   Thereby, it is possible to detect the knock occupancy with high accuracy.<br>
When the knock occupancy KC is larger than the threshold KC(0) (YES in S218), it is said that knocking occurs at frequency larger than acceptable frequency.    In such a case, in order to make determination of knocking being caused to be done easily, the determination value V(KX) is made to be smaller (S220).   Thereby, it is possible to increase the frequency that knocking is determined to have occurred, and to retard spark to thereby suppress occurrence of knocking.<br>
On the other hand, if the knock occupancy KC is smaller than the threshold KC(0) (NO in S218), it is said that knocking occurrence frequency is within the allowable value.   In this case, it is said that output of the engine 100 can be further increased.<br>
Therefore, the determination value V(KX) is made to be larger (S222). Thereby, frequency that knocking is determined to have occurred is suppressed, and spark is retarded so as to increase output of engine 100.<br>
As described above, the engine ECU which is the knocking state determination device according to the present embodiment creates frequency distribution by using a magnitude value LOG(V) in an ignition cycle in which the correlation coefficient K is larger than the threshold K(l), and determines the knock occupancy KC, that is, the knocking occurrence frequency (number of times).   The threshold K(l) is the maximum value of correlation coefficient K calculated in the case where the engine is<br>
operated such that vibration waveforms of noise components are included in vibration waveforms in an ignition cycle in which the magnitude value LOG(V) is calculated. Thereby, in the frequency distribution of magnitude values LOG(V), it is possible to suppress magnitude values LOG(V) considered as magnitude values LOG(V) of vibration of noise components.   Therefore, by suppressing effects of vibration of noise components, the number that knocking occurred can be determined.   As a result, it is possible to determine the number that knocking occurred with high accuracy.<br>
As shown in Fig. 22, when magnitude of vibration due to noise is large, the difference between the maximum value of the integrated values at the time of knocking and the maximum value of the integrated values due to noise is small and it may be difficult to distinguish between knocking and noise from knocking magnitude N. Therefore, as shown in Fig. 23, it is also possible to calculate knock magnitude N by using the sum of the integrated values in the vibration waveform (a value obtained by integrating all output voltages of knock sensor 300 in the knock detection gate) instead of the peak value P of the integrated values.   In other words, it is also possible to calculate knock magnitude N by dividing the product of correlation coefficient K and the sum of the integrated values in the vibration waveform by BGL.<br>
As shown in Fig. 23, because a period in which vibrations due to noise occur is shorter than a period in which vibrations due to knocking occur, a difference between the sum of integrated values of knocking and that of noise may be large.    Therefore, by calculating knock magnitude N based on the sum of the integrated values, it is possible to obtain a large difference between knock magnitude N calculated at the time of knocking and knock magnitude N calculated as a result of noise.   Thus, it is possible to clearly distinguish between vibration due to knocking and vibration due to noise. Second Embodiment<br>
Hereinafter, a second embodiment of the present invention will be described. The present embodiment is different from the first embodiment described above in that the determination value V(KX) is corrected when the frequency that knocking is<br>
determined to have occurred is high in knocking determination for each ignition cycle, in addition to frequency distribution of magnitude value LOG(V).    Other configurations are same as those of the first embodiment described above, and functions thereof are also same.   Therefore, detailed description thereof is not repeated here.<br>
With reference to Fig. 24, a control structure of a program executed by engine ECU 200 which is the knocking state determination device according to the present embodiment will be described.   Note that the program described below is executed in addition to the program of the first embodiment described above.<br>
In S300, engine ECU 200 judges whether an air fuel mixture is ignited.   Since engine ECU 200 itself has decided whether to ignite an air fuel mixture, whether the air fuel mixture has been ignited is judged inside engine ECU 200.   If the air fuel mixture has been ignited (YES in S300), the processing moves to S302.   If not (NO is S300), the processing returns to S300.   In S302, engine ECU 200 increments the ignition counter.<br>
In S304, engine ECU 200 judges whether knocking is determined to have occurred in the knocking determination of each ignition cycle.   If knocking is determined to have occurred (YES in S304), the processing moves to S306.   If not (NO in S304), the processing moves to S308.   In S306, engine ECU 200 increments the knocking counter.<br>
In S308, engine ECU 200 judges whether a value calculated by dividing the count number of the knock counter by the count number of the ignition counter is not less than the threshold.   That is, it is determined whether proportion (frequency) of ignition cycles where knocking has occurred (hereinafter also referred to as a knock cycle) is not less than the threshold in total ignition cycles.   If the proportion of knock cycles is not less than the threshold (YES in S308), the processing moves to S310.   If not (NO in S308), the processing moves to S314.<br>
In S310, engine ECU 200 makes the determination value V(KX) used for<br>
determining whether knocking has occurred for each ignition cycle smaller.   The correction amount at this time is larger than the correction amount of the case where the determination value V(KX) is made smaller by using frequency distribution of magnitude values LOG(V).<br>
In S312, engine ECU 200 judges whether the determination value V(KX) has been corrected by using the frequency distribution of magnitude values LOG(V).   If the determination value V(KX) has been corrected by using the frequency distribution of magnitude values LOG(V) (YES in S312), the processing moves to S314.    If not (NO in S312), the processing returns to S300.   In S314, engine ECU 200 resets the ignition counter and the knock counter.   Then, this processing ends.<br>
Description will be given for operation of engine ECU 200 of the knocking state determination device according to the present embodiment, based on the structure and the flowchart described above.<br>
When the air fuel mixture is ignited (YES in S300), the ignition counter is incremented (S302).   In this ignition cycle, if knocking is determined to have occurred (YES in S304), the knock counter is incremented (S306).   If knocking is determined no to have occurred (NO in S304), the knock counter is not incremented.<br>
During the period in which proportion of knock cycles occupied in the total ignition cycles is smaller than the threshold (NO in S308) and correction of the determination value V(KX) using frequency distribution of magnitude values LOG(V) is not carried out (NO in S312), that is, during the period in which magnitude values LOG(V) extracted for creating the frequency distribution do not meet the number for N cycles, processing from S300 to S306 is repeated.<br>
On the other hand, when the proportion of knock cycles is the threshold or more (YES in S308), the determination value V(KX) is made smaller by the correction amount larger than the correction amount of the case where the determination value V(KX) is made smaller using the frequency distribution of magnitude values LOG(V) (S310).<br>
Thereby, it is possible to easily determine that knocking has occurred in knocking determination for each ignition cycle when the knocking generating frequency is large without depending on frequency distribution of magnitude values LOG(V), that is, even before magnitude values LOG(V) for N cycles are not extracted.   Therefore, it is possible to increase frequency of retarding spark so as to suppress occurrence of knocking.<br>
Further, at this time, the determination value V(KX) is made smaller by the correction amount larger than the correction amount of the case where the determination value V(KX) is made smaller using frequency distribution of magnitude values LOG(V).   Thereby, even in the case where knocking cannot be suppressed by making the determination value V(KX) smaller using the frequency distribution of magnitude values LOG(V), it is possible to suppress occurrence of knocking promptly.<br>
When the determination value V(KX) is corrected (YES in S310, S312), the ignition counter and the knock counter are reset, and processing after S300 is repeated again.<br>
As described above, engine ECU which is the knocking state determination device according to the present embodiment makes the determination value V(KX) smaller by the large correction amount if the proportion of ignition cycle determined as knocking having occurred through knocking determination for each ignition cycle, to the number of total ignition cycles, is larger than the threshold.   Thereby, in the case of knocking generation frequency being high, it is possible to suppress occurrence of knocking by making determination that knocking has occurred to be done easily so as to increase frequency of spark being retarded. Other Embodiments<br>
In the first embodiment and the second embodiment described above, the knock<br>
determination level V(KD) is done by using the median value of magnitude values LOG(V).   However, when vibration of large magnitude occurs, calculated magnitude value LOG(V) becomes larger, whereby the shape of frequency distribution is collapsed and the calculated median value may be larger than necessity as shown by the solid line in Fig. 25.<br>
However, even in the case of the shape of frequency distribution being collapsed, the smallest magnitude value LOG(V), among magnitude values LOG(V) where frequency of magnitude values LOG(V) shows a peak (change rate of frequency becomes 0), is often the same value as the median value V(50) of the frequency distribution where knocking is not caused.<br>
In view of the above, the knock determination level V(KD) may be calculated by using the smallest magnitude value LOG(V) among magnitude values LOG(V) where frequency of magnitude values LOG(V) shows a peak, instead of the median value V(50).<br>
That is, the product of the standard deviation and the coefficient U in magnitude values not more than the smallest magnitude value LOG(V), among magnitude values LOG(V) where the calculated frequency shows a peak, may be added to the smallest magnitude value LOG(V) among magnitude values LOG(V) where the calculated frequency shows a peak, to thereby calculate the knock determination level V(KD). Thereby, even when the magnitude value LOG(V) becomes high due to the effects of noise components, it is possible to suppress an increase in the calculated knock determination level V(KD) beyond necessity.<br>
Further, as shown in Fig. 27, there is a case where dispersion of magnitude values LOG(V) to be extracted becomes larger, so a peak is shown at lower frequency than general in magnitude values LOG(V) lower than general, depending on a state of<br>
vibration caused in engine 100 .    Therefore, as shown in Fig. 27, the knock determination level V(KD) may be calculated by using the smallest magnitude value LOG(V), among magnitude values LOG(V) calculated at higher frequency than predetermined frequency (e.g., a third of the frequency maximum value) and the frequency of the magnitude values LOG(V) shows a peak.   Thereby, even when dispersion of magnitude values LOG(V) becomes large, it is possible to suppress a decrease in the calculated knock determination level V(KD) beyond necessity.<br>
Note that in the case where the knock determination level V(KD) is calculated by using magnitude values LOG(V) that the frequency of the magnitude values LOG(V) shows a peak instead of the median value V(50), the knock determination level V(KD) may be calculated without performing processing for removing maximum values V(MAX) larger than the knock determination level V(KD).<br>
Although the present invention has been described and illustrated in detail, it is clearly understood that the same is by way of illustration and example only and is not to be taken by way of limitation, the spirit and scope of the present invention being limited only by the terms of the appended claims.<br><br><br><br><br><br><br>
We claim:<br>
1. A knocking state determination device in an internal combustion engine (loo), comprising:<br>
a first detecting portion (200) for detecting a waveform of vibration caused in said internal<br>
combustion engine (100) at a predetermined interval for a crank angle;<br>
a second detecting portion (200) for detecting magnitude values relating to magnitude of<br>
vibration caused in said internal combustion engine (100) in a plurality of ignition cycles;<br>
an extracting portion (200) for extracting a magnitude value satisfying a predetermined<br>
condition among said plurality of magnitude values based on a result of comparing said<br>
detected waveform with said stored waveform;<br>
a determining portion (200) for determining a knocking occurrence state based on said<br>
magnitude value extracted;<br>
characterized by<br>
a memory portion (202) for previously storing a waveform of vibration of said internal<br>
combustion engine (100); and<br>
a level calculating portion (200) for calculating a knock determination level based on said<br>
extracted magnitude value; wherein<br>
said determining portion (200) determines a knocking occurrence state based on a result of<br>
comparing said extracted magnitude value with said knock determination level.<br>
2. The knocking state determination device as claimed in claim 1, comprising:<br>
a knock magnitude calculating portion (200) for calculating a knock magnitude relating to a<br>
magnitude of vibration caused by knocking, based on the result of comparing said stored<br>
waveform and the detected waveform and a magnitude of vibration caused in said internal<br>
combustion engine (100) at said predetermined interval for the crank angle; and<br>
a ignition cycle knocking determining portion (200) for determining whether knocking has<br>
occurred in said internal combustion engine (100) for each ignition cycle based on a result of<br>
comparing said knock magnitude and a predetermined determination value.<br>
3. The knocking state determination device as claimed in claim 2, wherein<br>
said predetermined determination value is set based on at least one of a number of<br>
rotations of said internal combustion engine (100) and an amount of air taken in said<br>
internal combustion engine (100).<br>
4. The knocking state determination device as claimed in claim 2, comprising:<br>
a correcting portion (200) for correcting said predetermined determination value based on a<br>
determination result by said determining portion (200).<br>
5. The knocking state determination device as claimed in claim 2, comprising:<br>
a correcting portion (200) for correcting said determination value based on frequency that<br>
knocking is determined to have occurred in said internal combustion engine (100) by using<br>
said knock magnitude.<br>
6. The knocking state determination device as claimed in claim 2, comprising:<br>
a first correcting portion (200) for correcting said predetermined determination value based<br>
on a determination result by said determining portion (200); and<br>
a second correcting portion (200) for correcting said determination value by a correction<br>
amount different from that of said first correcting portion (200), based on frequency in<br>
which knocking is determined to have occurred in said internal combustion engine (100) by<br>
using said knock magnitude.<br>
7. The knocking state determination device as claimed in claim 6, wherein<br>
said second correcting portion (200) corrects said determination value by a correction<br>
amount larger than that of said first correcting portion (200).<br>
8. The knocking state determination device as claimed in claim 2, comprising:<br>
a deviation calculating portion (200) for calculating a value relating to a deviation between<br>
said detected waveform and said stored waveform, wherein<br>
said knock magnitude calculating portion (200) calculates said knock magnitude<br>
based on the value relating to said deviation and a magnitude of vibration caused in said<br>
internal combustion engine (100) at said predetermined interval for the crank angle.<br>
9. The knocking state determination device as claimed in claim 8, comprising:<br>
an integrating portion (200) for calculating an integrated value in which a magnitude of<br>
vibration caused in said internal combustion engine (100) at said predetermined interval for<br>
the crank angle is integrated by said predetermined interval for the crank angle, wherein<br>
said knock magnitude calculating portion (200) calculates said knock magnitude based on a<br>
product of the value relating to said deviation and said integrated value.<br>
10. The knocking state determination device as claimed in claim 8, wherein<br>
said deviation calculating portion (200) calculates the value relating to said deviation smaller<br>
when said waveform detected include a waveform of vibration caused by an operation of a<br>
specific part (104,108,116,1 18)o f said internal combustion engine (loo),c omparing with a<br>
case of not including it, and<br>
said predetermined condition is a condition that it is a magnitude value in an ignition cycle in<br>
which a value relating to a deviation larger than a predetermined value is calculated.<br>
The knocking state determination device as claimed in claim 10, wherein<br>
said predetermined value is a maximum value of a value relating to a deviation calculated in<br>
a state where said internal combustion engine (100) is operated such that vibration due to<br>
the operation of the specific part (104, 108, 116, 118) is caused at the predetermined<br>
interval.<br>
The knocking state determination device as claimed in claim 10, wherein<br>
the specific part (104, 108, 116, 118) is at least one of a piston (log), an injector (104)) an<br>
intake valve (116) and an exhaust valve (118).<br>
The knocking state determination device as claimed in claim 1, comprising:<br>
a deviation calculating portion (200) for calculating a value relating to a deviation between<br>
said detected waveform and said stored waveform based on a result of comparing said<br>
detected waveform with said stored waveform, wherein<br>
said deviation calculating portion (200) calculates the value relating to said deviation smaller<br>
when said detected waveform includes a waveform of vibration caused by an operation of a<br>
specific part (104, 108,116,118) of said internal combustion engine (100), compared with a<br>
case of not including it, and<br>
said predetermined condition is a condition that it is a magnitude value in an ignition cycle in<br>
which a value relating to a deviation larger than a predetermined value is calculated.<br>
The knocking state determination device as claimed in claim 13, wherein<br>
said predetermined value is a maximum value of a value relating to a deviation calculated in<br>
a state where said internal combustion engine (100) is operated such that vibration by the<br>
operation of said specific part (104,108,116,118is) caused at said predetermined interval.<br>
The knocking state determination device as claimed in claim 13, wherein<br>
said specific part (104,1 08, 116, 118) is at least one of a piston (log),a n injector (104),a n<br>
intake valve (116) and an exhaust valve (118).<br>
The knocking state determination device as claimed in claim 1, wherein<br>
said level calculating portion (200) calculates said knock determination level when a plurality<br>
of magnitude values not less than the predetermined number are extracted.<br>
17. The knocking state determination device as claimed in claim 16, wherein<br>
said determining portion (200) determines knocking occurrence frequency based on the<br>
result of comparing said extracted magnitude value and said knock determination level.<br>
18. The knocking state determination device as claimed in claim 17, wherein<br>
said determining portion (200) determines frequency that magnitude values larger than said<br>
knock determination level are extracted, among said magnitude values extracted, as<br>
knocking occurrence frequency.<br>
19. The knocking state determination device as claimed in claim 1, wherein<br>
said level calculating portion (200) calculates said knock determination level by adding a<br>
product of a standard deviation in said magnitude values extracted and a predetermined<br>
coefficient to a median value of said magnitude values extracted.<br>
20. The knocking state determination device as claimed in claim 19, wherein<br>
said predetermined coefficient is 3.<br>
21. The knocking state determination device as claimed in claim 1, wherein<br>
said level calculating portion (200) calculates said knock determination level by adding a<br>
product of a standard deviation in magnitude values of not more than a smallest magnitude<br>
value among magnitude values in which extracted frequency shows a peak and a<br>
predetermined coefficient, to the smallest magnitude value among the magnitude values, in<br>
which the extracted frequency shows the peak.<br>
22. The knocking state determination device as claimed in claim 21, wherein<br>
said predetermined coefficient is 3.<br>
23. The knocking state determination device as claimed in claim 1, wherein<br>
said level calculating portion (200) calculates said knock determination level by adding a<br>
product of a standard deviation in magnitude values of not more than a smallest magnitude<br>
value among magnitude values which are magnitude values in which extracted frequency is<br>
higher than predetermined frequency and the extracted frequency shows a peak and a<br>
predetermined coefficient, to the smallest magnitude value among the magnitude values in<br>
which the extracted frequency is higher than the predetermined frequency and the<br>
extracted frequency shows the peak.<br>
24. The knocking state determination device as claimed in claim 23, wherein<br>
said predetermined coefficient is 3.<br>
25. The knocking state determination device as claimed in claim 1, wherein<br>
said waveform of vibration is a waveform in which waveforms of vibration of a plurality of<br>
frequency bands caused in said internal combustion engine (100) are synthesized.<br>
26. The knocking state determination device as claimed in one of claims 1 - 25, comprising a<br>
ECU (200) including said first detecting portion, said memory portion, said second detecting<br>
portion, said extracting portion, said determining portion and said level calculating portion.</td>
			</tr>
		</table>	
		<br>
		<h3>Documents:</h3>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1hYnN0cmFjdC5wZGY=" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-abstract.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1hc3NpZ25tZW50LnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-assignment.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1DbGFpbXMtKDE5LTAzLTIwMTMpLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-Claims-(19-03-2013).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1jbGFpbXMucGRm" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-claims.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1Db3JyZXNwb25kZW5jZS1PdGhlcnMtKDAxLTAyLTIwMTMpLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-Correspondence-Others-(01-02-2013).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1Db3JyZXNwb25kZW5jZS1PdGhlcnMtKDE5LTAzLTIwMTMpLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-Correspondence-Others-(19-03-2013).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1Db3JyZXNwb25kZW5jZS1PdGhlcnMtKDIyLTEwLTIwMTIpLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-Correspondence-Others-(22-10-2012).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1jb3JyZXNwb25kZW5jZS1vdGhlcnMtMS5wZGY=" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-correspondence-others-1.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1jb3JyZXNwb25kZW5jZS1vdGhlcnMucGRm" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-correspondence-others.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1kZXNjcmlwdGlvbiAoY29tcGxldGUpLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-description (complete).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1kcmF3aW5ncy5wZGY=" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-drawings.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1mb3JtLTEucGRm" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-form-1.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1mb3JtLTE4LnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-form-18.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1Gb3JtLTItKDE5LTAzLTIwMTMpLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-Form-2-(19-03-2013).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1mb3JtLTIucGRm" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-form-2.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1Gb3JtLTMtKDAxLTAyLTIwMTMpLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-Form-3-(01-02-2013).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1mb3JtLTMucGRm" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-form-3.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1mb3JtLTUucGRm" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-form-5.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1HUEEtKDAxLTAyLTIwMTMpLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-GPA-(01-02-2013).pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1wY3QtMTAxLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-pct-101.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1wY3QtMjEwLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-pct-210.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1wY3QtMzAxLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-pct-301.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1wY3QtMzA0LnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-pct-304.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1wY3QtMzA2LnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-pct-306.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1wY3QtMzA4LnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-pct-308.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1wY3QtMzMyLnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-pct-332.pdf</a></p>
				<p><a href="http://ipindiaonline.gov.in/patentsearch/GrantedSearch/pdfviewer.aspx?AppNo=MTAwODAtZGVsbnAtMjAwNy1wY3QtNDA5LnBkZg==" target="_blank" style="word-wrap:break-word;">10080-delnp-2007-pct-409.pdf</a></p>
		<br>
		<div class="pull-left">
			<a href="257042-chair-having-synchronous-movement-of-back-and-seat-assemblies.html">&laquo; Previous Patent</a>
		</div>
		<div class="pull-right">
			<a href="257044-an-algae-production-system.html">Next Patent &raquo;</a>
		</div>			
	</div><!-- /span8 -->
	<div class="span4">
		<div class="well infobox">
			<table class="table table-condensed">
				<tr>
					<th>Patent Number</th>
					<td>257043</td>
				</tr>
				<tr>
					<th>Indian Patent Application Number</th>
					<td>10080/DELNP/2007</td>
				</tr>
				<tr>
					<th>PG Journal Number</th>
					<td>35/2013</td>
				</tr>
				<tr>
					<th>Publication Date</th>
					<td>30-Aug-2013</td>
				</tr>
				<tr>
					<th>Grant Date</th>
					<td>29-Aug-2013</td>
				</tr>
				<tr>
					<th>Date of Filing</th>
					<td>26-Dec-2007</td>
				</tr>
				<tr>
					<th>Name of Patentee</th>
					<td>TOYOTA JIDOSHA KABUSHIKI KAISHA,</td>
				</tr>
				<tr>
					<th>Applicant Address</th>
					<td>1, TOYOTA-CHO, TOYOTA-SHI, AICHI-KEN, 471-8571, JAPAN.</td>
				</tr>
				<tr>
					<td colspan=2>
								<h5>Inventors:</h5>
								<table class="table">
									<tr>
										<th>#</th>
										<th>Inventor's Name</th>
										<th>Inventor's Address</th>
									</tr>

										<tr>
											<td>1</td>
											<td>KANEKO RIHITO</td>
											<td>C/O TOYOTA JIDOSHA KABUSHIKI KAISHA,OF 1, TOYOTA-CHO, TOYOTA-SHI, AICHI-KEN, 471-8571 JAPAN.</td>
										</tr>
										<tr>
											<td>2</td>
											<td>TAKEMURA YUICHI</td>
											<td>C/O DENSO CORPORATION, OF 1-1 SHOWA-CHO KARIYA-SHI, AICHI-KEN, 448-8661 JAPAN.</td>
										</tr>
										<tr>
											<td>3</td>
											<td>ASO KOJI</td>
											<td>C/O TOYOTA JIDOSHA KABUSHIKI KAISHA, TOYOTA-CHO, TOYOTA-SHI, AICHI-KEN, 471-8571 JAPAN.</td>
										</tr>
										<tr>
											<td>4</td>
											<td>KASASHIMA KENJI</td>
											<td>C/O TOYOTA JIDOSHA KABUSHIKI KAISHA, OF 1, TOYOTA-CHO, TOYOTA-SHI, AICHI-KEN, 471-8571 JAPAN.</td>
										</tr>
										<tr>
											<td>5</td>
											<td>YOSHIHARA MASATOMO</td>
											<td>C/O TOYOTA JIDOSHA KABUSHIKI KAISHA, OF 1, TOYOTA-CHO, TOYOTA-SHI, AICHI-KEN, 471-8571 JAPAN.</td>
										</tr>
										<tr>
											<td>6</td>
											<td>SENDA KENJI</td>
											<td>C/O TOYOTA JIDOSHA KABUSHIKI KAISHA, OF 1, TOYOTA-CHO, TOYOTA-SHI, AICHI-KEN, 471-8571 JAPAN.</td>
										</tr>
										<tr>
											<td>7</td>
											<td>KAMIO SHIGERU</td>
											<td>C/O DENSO CORPORATION, OF 1-1 SHOWA-CHO KARIYA-SHI, AICHI-KEN, 448-8661 JAPAN.</td>
										</tr>
								</table>
					</td>
				</tr>
				<tr>
					<th>PCT International Classification Number</th>
					<td>G01L 23/22</td>
				</tr>
				<tr>
					<th>PCT International Application Number</th>
					<td>PCT/JP2006/313171</td>
				</tr>
				<tr>
					<th>PCT International Filing date</th>
					<td>2006-06-26</td>
				</tr>
				<tr>
					<td colspan=2>
						<h5>PCT Conventions:</h5>
						<table class="table">
							<tr>
								<th>#</th>
								<th>PCT Application Number</th>
								<th>Date of Convention</th>
								<th>Priority Country</th>
							</tr>

								<tr>
									<td>1</td>
									<td>2005-188346</td>
									<td>2005-06-28</td>
								    <td>Japan</td>
								</tr>

						</table>
					</td>
				</tr>
			</table>
		</div><!-- /well -->
	</div><!-- /span4 -->
</div><!-- /row-fluid -->

        </div>

      </div><!--/row-->

      <footer class="footer">

        <style>
        .allindianpatents-footer { width: 320px; height: 50px; }
        @media(min-width: 500px) { .allindianpatents-footer { width: 468px; height: 60px; } }
        @media(min-width: 800px) { .allindianpatents-footer { width: 728px; height: 90px; } }
        </style>
        <center>
        </center>

        <p>&copy; All Indian Patents, 2013-2021.</p>
        <p>Patent data available in the public domain from Indian Patents Office, Department of Industrial Policy and Promotions, Ministry of Commerce and Industry, Government of India.</p>
      </footer>

    </div> <!-- /container -->

    <!-- Javascripts
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/application-95f297ff0d8d2015987f04b30593c800.js" type="text/javascript"></script>

    <!-- Start of StatCounter Code for Default Guide -->
    <script type="text/javascript">
    var sc_project=8902313; 
    var sc_invisible=1; 
    var sc_security="3c1f8147"; 
    var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
    document.write("<sc"+"ript type='text/javascript' src='" +
    scJsHost+
    "statcounter.com/counter/counter.js'></"+"script>");
    </script>
    <noscript><div class="statcounter"><a title="web stats"
    href="http://statcounter.com/free-web-stats/"
    target="_blank"><img class="statcounter"
    src="http://c.statcounter.com/8902313/0/3c1f8147/1/"
    alt="web stats"></a></div></noscript>
    <!-- End of StatCounter Code for Default Guide -->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-244143-31', 'allindianpatents.com');
      ga('send', 'pageview');

    </script>

  </body>

<!-- Mirrored from www.allindianpatents.com/patents/257043-knocking-state-determination-device by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Apr 2024 08:53:32 GMT -->
</html>
